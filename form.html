<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTE/IR Form Log & Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary': '#1D4ED8', // Blue-700
                        'brand-secondary': '#FBBF24', // Amber-400
                        'danger': '#EF4444', // Red-500
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        };
    </script>
    <style>
        /* Custom styles for the responsive table and modal */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3ff6;
        }

        /* Responsive Table */
        @media (max-width: 768px) {
            .responsive-table tr {
                border-bottom: 3px solid #dee2e6;
                display: block;
                margin-bottom: .625em;
            }

            .responsive-table td {
                /* Behave like a row */
                border-bottom: 1px solid #dee2e6;
                display: block;
                font-size: .8em;
                text-align: right;
                padding-left: 50%;
                position: relative;
            }

            .responsive-table td::before {
                /* Now like a table header */
                position: absolute;
                /* Top/left values mimic padding */
                top: 0;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                /* Label the data */
                content: attr(data-label);
                font-weight: bold;
                text-align: left;
            }
        }

        /* Style for the A4-like preview in the iframe */
        .page-preview {
            width: 100%;
            max-width: 8.5in;
            aspect-ratio: 1 / 1.294;
            /* Approximate A4 ratio: 1 / 1.414. Adjusting for padding/margin */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: white;
            margin: 20px auto;
            border-radius: 4px;
            overflow: hidden;
        }

        .page-preview iframe {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body class="p-8">

    <div id="app" class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
            <i data-feather="file-text" class="mr-3 text-brand-primary"></i>
            NTE/IR Form Log & Generator
        </h1>

        <div id="message-container" class="mb-4"></div>

        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <a href="#" onclick="showTab('log')" id="tab-log"
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    Form Log
                </a>
                <a href="#" onclick="showTab('preview')" id="tab-preview"
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    Form Preview
                </a>
            </nav>
        </div>

        <div id="content-log" class="tab-content py-6">
            <div class="flex justify-end mb-4">
                <button onclick="openFormModal()"
                    class="bg-brand-primary hover:bg-blue-800 text-white font-bold py-2 px-4 rounded flex items-center shadow-lg">
                    <i data-feather="plus-circle" class="w-4 h-4 mr-2"></i>
                    Create New Form
                </button>
            </div>

            <div class="bg-white shadow-xl rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-200 responsive-table">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Ref. No.</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Form Type</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Employee</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date Issued</th>
                            <th scope="col"
                                class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Status</th>
                            <th scope="col"
                                class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody id="form-log-body" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
                <div id="empty-log-message" class="p-6 text-center text-gray-500" style="display: none;">
                    No forms have been logged yet. Click 'Create New Form' to start.
                </div>
            </div>
        </div>

        <div id="content-preview" class="tab-content py-6 hidden">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Template Preview (IR & NTE)</h2>
            <div id="preview-content" class="flex flex-wrap -mx-4">
                </div>
        </div>

    </div>

    <div id="form-modal"
        class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl">
            <div class="flex justify-between items-center pb-3">
                <h3 class="text-2xl font-semibold text-gray-800">New Form Record</h3>
                <button onclick="closeFormModal()" class="text-gray-400 hover:text-gray-600">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            <form id="new-form-record">
                <div class="mb-4">
                    <label for="formType" class="block text-sm font-medium text-gray-700">Form Type</label>
                    <select id="formType" name="formType" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary sm:text-sm">
                        <option value="IR">Incident Report (IR)</option>
                        <option value="NTE">Notice to Explain (NTE)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="refNo" class="block text-sm font-medium text-gray-700">Reference Number</label>
                    <input type="text" id="refNo" name="refNo" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary sm:text-sm"
                        placeholder="e.g., IR-2025-001 or NTE-2025-001">
                </div>
                <div class="mb-4">
                    <label for="employeeName" class="block text-sm font-medium text-gray-700">Employee Name</label>
                    <input type="text" id="employeeName" name="employeeName" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary sm:text-sm"
                        placeholder="e.g., Juan Dela Cruz">
                </div>
                <div class="mb-4">
                    <label for="dateIssued" class="block text-sm font-medium text-gray-700">Date Issued</label>
                    <input type="date" id="dateIssued" name="dateIssued" required
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary sm:text-sm">
                </div>
                <div class="mb-4">
                    <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                    <select id="status" name="status"
                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-primary focus:border-brand-primary sm:text-sm">
                        <option value="Pending">Pending</option>
                        <option value="Reviewed">Reviewed</option>
                        <option value="Closed">Closed</option>
                    </select>
                </div>
                <div class="pt-4 flex justify-end">
                    <button type="submit"
                        class="bg-brand-primary hover:bg-blue-800 text-white font-bold py-2 px-4 rounded shadow-lg">
                        Log Record
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script>
        const LOGO_URL = 'https://digitalmindsbpo.com/storage/2021/11/cropped-Digital_Minds_Logo_Original.png';
        let records = JSON.parse(localStorage.getItem('formRecords')) || [];

        // --- TEMPLATE HTML CONTENT (IR) ---
        const irHtml = `
            <!DOCTYPE html>
            <html>
            <head>
                <style>
                    /* A4 print-style for the preview */
                    body { font-family: Arial, sans-serif; margin: 0; padding: 1in; box-sizing: border-box; font-size: 10pt; line-height: 1.4; }
                    .page { max-width: 6.5in; margin: 0 auto; }
                    .header { text-align: center; margin-bottom: 25px; }
                    .logo { max-width: 200px; height: auto; margin-bottom: 10px; }
                    .title { font-size: 18pt; font-weight: bold; margin-bottom: 5px; }
                    .company { font-size: 11pt; margin-bottom: 15px; }
                    .field-group { margin-bottom: 15px; border: 1px solid #ccc; padding: 10px; }
                    .field { margin-bottom: 8px; display: flex; justify-content: space-between; flex-wrap: wrap; }
                    .field label { font-weight: bold; margin-right: 5px; white-space: nowrap; }
                    .field span { flex-grow: 1; border-bottom: 1px solid #000; padding: 0 5px; min-height: 1.2em; }
                    .narration-box { min-height: 150px; border: 1px solid #000; padding: 10px; margin-top: 5px; white-space: pre-wrap; }
                    .table-like { width: 100%; border-collapse: collapse; margin-top: 10px; }
                    .table-like td, .table-like th { padding: 5px; border: 1px solid #ccc; font-size: 9pt; text-align: left; }
                    .table-like th { background-color: #f0f0f0; }
                    .signature-block { width: 48%; display: inline-block; text-align: center; margin-top: 20px; }
                    .signature-line { height: 1px; background: #000; margin-top: 40px; }
                    .label-text { font-size: 9pt; text-align: center; margin-top: 5px; }
                </style>
            </head>
            <body>
                <div class="page">
                    <div class="header">
                        <img class="logo" src="${LOGO_URL}" alt="Digital Minds Logo">
                        <div class="company">BRO SERVICES INCORPORATED</div>
                        <div class="title">INCIDENT REPORT</div>
                        <div style="font-size: 10pt; margin-top: 5px;">IR CODE NUMBER: <span style="border-bottom: 1px solid #000; padding: 0 5px; min-width: 150px; display: inline-block;">[IR_CODE_NUMBER]</span></div>
                    </div>

                    <div class="field-group">
                        <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                            <div class="field" style="width: 50%;"><label>Name of Employee:</label><span>[EMPLOYEE_NAME]</span></div>
                            <div class="field" style="width: 45%;"><label>Employee Number:</label><span>[EMPLOYEE_NUMBER]</span></div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                            <div class="field" style="width: 50%;"><label>Date of Incident:</label><span>[DATE_OF_INCIDENT]</span></div>
                            <div class="field" style="width: 45%;"><label>Date:</label><span>[REPORT_DATE]</span></div>
                        </div>
                        <div class="field"><label>Department/Campaign:</label><span>[DEPARTMENT_CAMPAIGN]</span></div>
                        <div class="field"><label>Place of Incident:</label><span>[PLACE_OF_INCIDENT]</span></div>
                    </div>

                    <div class="field-group">
                        <label style="font-weight: bold; display: block;">Narration of Incident: (Kindly provide a proof as exhibits in a separate sheet)</label>
                        <div class="narration-box">
                            [NARRATION_DETAILS]
                        </div>
                    </div>

                    <div class="field-group">
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Witnesses:</label>
                        <table class="table-like">
                            <thead><tr><th style="width: 40%;">Name</th><th style="width: 30%;">Position</th><th style="width: 15%;">Signature</th><th style="width: 15%;">Date</th></tr></thead>
                            <tbody>
                                <tr><td>[WITNESS_NAME_1]</td><td>[WITNESS_POSITION_1]</td><td></td><td></td></tr>
                                <tr><td>[WITNESS_NAME_2]</td><td>[WITNESS_POSITION_2]</td><td></td><td></td></tr>
                                <tr><td></td><td></td><td></td><td></td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div style="text-align: center; overflow: auto; padding-bottom: 10px;">
                        <div class="signature-block" style="float: left;">
                            <div class="signature-line"></div>
                            <div class="label-text">Prepared By (Signature Over Printed Name)</div>
                            <div class="label-text">Name: <span style="border-bottom: 1px solid #000; padding: 0 5px; display: inline-block; min-width: 150px;">[PREPARER_NAME]</span></div>
                            <div class="label-text">Position: <span style="border-bottom: 1px solid #000; padding: 0 5px; display: inline-block; min-width: 150px;">[PREPARER_POSITION]</span></div>
                        </div>
                    </div>
                </div>
            </body>
            </html>
        `;

        // --- TEMPLATE HTML CONTENT (NTE) ---
        const nteHtml = `
            <!DOCTYPE html>
            <html>
            <head>
                <style>
                    /* A4 print-style for the preview */
                    body { font-family: Arial, sans-serif; margin: 0; padding: 1in; box-sizing: border-box; font-size: 10pt; line-height: 1.5; }
                    .page { max-width: 6.5in; margin: 0 auto; }
                    .header { text-align: center; margin-bottom: 25px; }
                    .logo { max-width: 200px; height: auto; margin-bottom: 10px; }
                    .title { font-size: 18pt; font-weight: bold; margin-bottom: 5px; }
                    .company { font-size: 11pt; margin-bottom: 15px; }
                    .date-ref { text-align: right; margin-bottom: 20px; }
                    .recipient-info { margin-bottom: 20px; }
                    .info-line { border-bottom: 1px solid #000; min-height: 1.2em; margin-bottom: 5px; width: 60%; }
                    .salutation { margin-bottom: 15px; }
                    .body-text { margin-bottom: 15px; text-align: justify; }
                    .violation-list { list-style-type: decimal; padding-left: 20px; margin-bottom: 15px; }
                    .violation-list li { margin-bottom: 10px; }
                    .violation-placeholder { border-bottom: 1px solid #000; display: block; min-height: 1.2em; margin-top: 3px; }
                    .signature-block { margin-top: 50px; text-align: center; width: 50%; float: right; }
                    .signature-line { height: 1px; background: #000; margin-top: 40px; }
                    .label-text { font-size: 9pt; text-align: center; margin-top: 5px; }
                    .acknowledgment { clear: both; margin-top: 60px; border: 1px solid #ccc; padding: 15px; page-break-before: auto; }
                </style>
            </head>
            <body>
                <div class="page">
                    <div class="header">
                        <img class="logo" src="${LOGO_URL}" alt="Digital Minds Logo">
                        <div class="company">BRO SERVICES INCORPORATED</div>
                        <div class="title">NOTICE TO EXPLAIN</div>
                    </div>
                    
                    <div class="date-ref">
                        NTE REFERENCE CODE: <span style="border-bottom: 1px solid #000; padding: 0 5px; min-width: 150px; display: inline-block;">[NTE_REFERENCE_CODE]</span><br>
                        Date: <span style="border-bottom: 1px solid #000; padding: 0 5px; min-width: 150px;">[DATE_OF_ISSUANCE]</span>
                    </div>

                    <div class="recipient-info">
                        <div class="info-line">[EMPLOYEE_NAME]</div>
                        <div class="info-line">[POSITION]</div>
                        <div class="info-line">[DEPARTMENT]</div>
                    </div>

                    <div class="salutation">
                        Dear Mr./Ms. [EMPLOYEE_NAME_SALUTATION]
                    </div>

                    <div class="body-text">
                        This Notice is being issued to require you to explain in writing why no disciplinary action should be imposed on you for the following violations:
                    </div>
                    
                    <ol class="violation-list">
                        <li>Violation 1: <div class="violation-placeholder">[VIOLATION_DETAILS_1]</div></li>
                        <li>Violation 2: <div class="violation-placeholder">[VIOLATION_DETAILS_2]</div></li>
                        <li>Violation 3: <div class="violation-placeholder">[VIOLATION_DETAILS_3]</div></li>
                    </ol>

                    <div class="body-text">
                        You are hereby directed to submit your written explanation regarding the above-mentioned matters **within five (5) working days from receipt of this Notice**. You may also submit any supporting evidence to substantiate your explanation.
                    </div>
                    
                    <div class="body-text">
                        You may be invited to attend an administrative hearing to ensure that due process is observed, in accordance with existing labor laws.
                    </div>
                    
                    <div class="body-text" style="font-weight: bold;">
                        Failure to submit your written explanation within the prescribed period will be considered a waiver of your right to be heard, and the Company shall proceed to evaluate the case based on the information available.
                    </div>
                    
                    <div class="body-text">
                        Please be advised that, depending on the outcome of the investigation, you may be subject to disciplinary action, **up to and including termination of employment**, in accordance with company policies and the Labor Code of the Philippines.
                    </div>

                    <div class="signature-block">
                        <div class="signature-line"></div>
                        <div class="label-text">Immediate Supervisor Signature Over Printed Name</div>
                    </div>

                    <div class="acknowledgment">
                        <div style="font-weight: bold; text-align: center; margin-bottom: 10px;">ACKNOWLEDGMENT OF RECEIPT OF THE NOTICE TO EXPLAIN</div>
                        <p>I, <span style="border-bottom: 1px solid #000; padding: 0 5px; display: inline-block; min-width: 200px;">[EMPLOYEE_NAME_ACK]</span>, confirm that I have received the Notice to Explain dated <span style="border-bottom: 1px solid #000; padding: 0 5px; display: inline-block; min-width: 100px;">[DATE_RECEIVED]</span>, and that I am given a period of **five (5) working days** from today to submit my written explanation.</p>
                        <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                            <div style="width: 45%;">
                                Date and Time of Receipt: <span style="border-bottom: 1px solid #000; display: block; min-height: 1.2em; margin-top: 5px;">[DATETIME_OF_RECEIPT]</span>
                            </div>
                            <div style="width: 45%; text-align: center;">
                                <div style="border-bottom: 1px solid #000; min-height: 1.2em; margin-top: 5px;"></div>
                                <div class="label-text">Employee's Signature Over Printed Name:</div>
                            </div>
                        </div>
                    </div>
                </div>
            </body>
            </html>
        `;


        // --- APPLICATION LOGIC (UNCHANGED) ---

        function saveRecords() {
            localStorage.setItem('formRecords', JSON.stringify(records));
        }

        function loadRecords() {
            const tbody = document.getElementById('form-log-body');
            tbody.innerHTML = '';
            const emptyMessage = document.getElementById('empty-log-message');

            if (records.length === 0) {
                emptyMessage.style.display = 'block';
                return;
            } else {
                emptyMessage.style.display = 'none';
            }

            records.forEach((record, index) => {
                const row = tbody.insertRow();
                row.className = 'hover:bg-gray-100';

                row.innerHTML = `
                    <td data-label="Ref. No." class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${record.refNo}</td>
                    <td data-label="Form Type" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.formType}</td>
                    <td data-label="Employee" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.employeeName}</td>
                    <td data-label="Date Issued" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.dateIssued}</td>
                    <td data-label="Status" class="px-6 py-4 whitespace-nowrap text-sm text-center">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(record.status)}">
                            ${record.status}
                        </span>
                    </td>
                    <td data-label="Actions" class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium flex justify-center space-x-2">
                        <button onclick="deleteRecord(${index})" class="text-danger hover:text-red-700" title="Delete">
                            <i data-feather="trash-2" class="w-4 h-4"></i>
                        </button>
                    </td>
                `;
            });
            feather.replace(); // Re-render icons after DOM update
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Pending':
                    return 'bg-yellow-100 text-yellow-800';
                case 'Reviewed':
                    return 'bg-blue-100 text-blue-800';
                case 'Closed':
                    return 'bg-green-100 text-green-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }

        function addRecord(e) {
            e.preventDefault();
            const form = e.target;
            const newRecord = {
                id: Date.now(),
                formType: form.formType.value,
                refNo: form.refNo.value.trim(),
                employeeName: form.employeeName.value.trim(),
                dateIssued: form.dateIssued.value,
                status: form.status.value,
            };

            // Simple validation to prevent duplicate Ref. No.
            if (records.some(r => r.refNo === newRecord.refNo)) {
                showMessage(`Error: Reference number ${newRecord.refNo} already exists.`, 'error');
                return;
            }

            records.push(newRecord);
            saveRecords();
            loadRecords();
            closeFormModal();
            showMessage(`New ${newRecord.formType} record (${newRecord.refNo}) logged successfully.`, 'success');
        }

        function deleteRecord(index) {
            if (confirm("Are you sure you want to delete this record? This action cannot be undone.")) {
                const refNo = records[index].refNo;
                records.splice(index, 1);
                saveRecords();
                loadRecords();
                showMessage(`Record (${refNo}) deleted successfully.`, 'success');
            }
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('message-container');
            let bgColor = 'bg-blue-100 border-blue-400 text-blue-700';
            let icon = 'info';

            if (type === 'success') {
                bgColor = 'bg-green-100 border-green-400 text-green-700';
                icon = 'check-circle';
            } else if (type === 'error') {
                bgColor = 'bg-red-100 border-red-400 text-red-700';
                icon = 'alert-triangle';
            }

            const alertHtml = `
                <div class="${bgColor} border px-4 py-3 rounded relative" role="alert">
                    <strong class="font-bold mr-2"><i data-feather="${icon}" class="w-4 h-4 inline-block align-text-bottom"></i></strong>
                    <span class="block sm:inline">${message}</span>
                </div>
            `;
            container.innerHTML = alertHtml;
            feather.replace();

            // Auto-hide message after 5 seconds
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // --- UI / MODAL / TABS (UNCHANGED) ---

        function openFormModal() {
            document.getElementById('form-modal').classList.remove('hidden');
            document.getElementById('new-form-record').reset();
        }

        function closeFormModal() {
            document.getElementById('form-modal').classList.add('hidden');
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-brand-primary', 'text-brand-primary', 'border-gray-300', 'text-gray-500', 'hover:text-gray-700');
                button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            });

            document.getElementById(`content-${tabId}`).classList.remove('hidden');
            const activeTab = document.getElementById(`tab-${tabId}`);
            activeTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            activeTab.classList.add('border-brand-primary', 'text-brand-primary');

            if (tabId === 'preview') {
                generatePreview();
            }
        }

        // --- PREVIEW GENERATION (CORE LOGIC UNCHANGED, USES NEW TEMPLATES) ---
        function generatePreview() {
            const previewContentDiv = document.getElementById('preview-content');

            try {
                // Set up the structure
                previewContentDiv.innerHTML = `
                    <div class="page-preview flex-col w-full md:w-1/2 p-4">
                        <iframe id="irPage" class="w-full h-full border-none" srcdoc='${irHtml.replace(/'/g, '&#39;')}'></iframe>
                        <div class="text-center text-gray-500 text-xs p-1">Page 1: Incident Report (IR) Template</div>
                    </div>
                    <div class="page-preview flex-col w-full md:w-1/2 p-4">
                        <iframe id="ntePage" class="w-full h-full border-none" srcdoc='${nteHtml.replace(/'/g, '&#39;')}'></iframe>
                        <div class="text-center text-gray-500 text-xs p-1">Page 2: Notice to Explain (NTE) Template</div>
                    </div>
                `;
            } catch (error) {
                console.error("Error generating preview:", error);
                previewContentDiv.innerHTML = `<p class="text-center text-danger py-12">Failed to load preview: ${error.message}</p>`;
                showMessage(`Failed to generate preview: ${error.message}`, 'error');
            }
        }
        
        // Custom confirm for better UX
        function confirm(message) {
            return window.confirm(message);
        }

        // --- INIT ---
        window.onload = () => {
            document.getElementById('new-form-record').addEventListener('submit', addRecord);
            loadRecords();
            showTab('log'); // Default to Log view
            feather.replace();
        };

    </script>
</body>

</html>