<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customer Success Process Flow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Styles -->
  <style>
    :root {
      --bg: #0f172a;         /* slate-900 */
      --panel: #111827;      /* gray-900 */
      --card: #0b1020;       /* deep navy */
      --muted: #94a3b8;      /* slate-400 */
      --text: #e5e7eb;       /* gray-200 */
      --primary: #22d3ee;    /* cyan-400 */
      --accent: #a78bfa;     /* violet-400 */
      --ok: #34d399;         /* green-400 */
      --warn: #f59e0b;       /* amber-400 */
      --danger: #fb7185;     /* rose-400 */
      --link: #60a5fa;       /* blue-400 */
      --border: #1f2937;     /* gray-800 */
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 15% 10%, #0b132f 0%, var(--bg) 60%);
      color: var(--text);
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    a {
      color: var(--link);
      text-decoration: none;
    }
    a:hover { text-decoration: underline }

    /* Layout */
    .app {
      display: grid;
      grid-template-columns: 320px 1fr 360px;
      grid-template-rows: auto 1fr auto;
      gap: 16px;
      min-height: 100vh;
      padding: 20px;
    }
    header, footer {
      grid-column: 1 / -1;
      background: linear-gradient(180deg, #0c1429 0%, #0a0f1f 100%);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 14px 18px;
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: 0.2px;
    }
    header p {
      margin: 6px 0 0;
      color: var(--muted);
    }
    .sidebar, .canvas, .detail {
      background: linear-gradient(180deg, var(--panel) 0%, #0b1224 100%);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      padding: 14px;
    }
    .section-title {
      font-weight: 600;
      margin: 0 0 10px;
      letter-spacing: 0.3px;
    }
    .filter-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .input, .select, .btn {
      background: #0c1326;
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
    }
    .input:focus, .select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(167,139,250,0.2);
    }
    .btn {
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.12s ease, border-color 0.12s ease;
    }
    .btn:hover { transform: translateY(-1px) }
    .btn.primary {
      background: linear-gradient(180deg, #0e1a34 0%, #0b1326 100%);
      border-color: #233055;
    }
    .btn.primary:hover { border-color: var(--primary) }

    .legend {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px;
      border: 1px dashed var(--border);
      border-radius: 10px;
    }
    .dot {
      width: 10px; height: 10px; border-radius: 999px;
    }

    /* Canvas */
    .canvas {
      display: grid;
      grid-template-rows: 44px 1fr;
    }
    .toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      border-bottom: 1px solid var(--border);
      background: #0d152a;
    }
    .zoom-group .btn { padding: 8px 10px }
    .svg-wrap {
      position: relative;
      overflow: auto;
    }
    svg {
      min-width: 900px;
      min-height: 560px;
      width: 100%;
      height: 100%;
      background: radial-gradient(550px 360px at 70% 20%, rgba(167,139,250,0.06) 0%, transparent 60%);
    }
    .node {
      cursor: pointer;
      transition: filter 0.14s ease, transform 0.08s ease;
    }
    .node:hover { filter: brightness(1.2) }
    .node rect {
      stroke: #1f2937;
      stroke-width: 1.2px;
      filter: drop-shadow(0 2px 10px rgba(0,0,0,0.35));
    }
    .node text {
      font-size: 12.5px;
      font-weight: 600;
      fill: var(--text);
      pointer-events: none;
    }
    .edge {
      stroke: #334155;
      stroke-width: 1.6px;
      marker-end: url(#arrow);
      opacity: 0.9;
    }
    .edge-label {
      fill: var(--muted);
      font-size: 11px;
      font-weight: 500;
    }
    .active rect { stroke: var(--accent) }
    .completed rect { stroke: var(--ok) }
    .blocked rect { stroke: var(--danger) }
    .pending rect { stroke: var(--warn) }

    /* Detail panel */
    .detail {
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    .detail-header {
      padding: 14px;
      border-bottom: 1px solid var(--border);
      background: #0d152a;
    }
    .detail-content {
      padding: 14px;
      overflow: auto;
      display: grid;
      gap: 12px;
    }
    .detail-footer {
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      background: #0d152a;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      background: #0e1834;
      border: 1px solid #243055;
      color: var(--text);
      padding: 6px 10px;
      border-radius: 999px;
    }
    .status-dot {
      width: 8px; height: 8px; border-radius: 999px; display: inline-block;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(2,6,23,0.72);
      display: none; align-items: center; justify-content: center; z-index: 50;
    }
    .modal {
      width: 560px; max-width: 92vw;
      background: linear-gradient(180deg, var(--panel) 0%, #0b1324 100%);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .modal h3 { margin: 0 0 8px }
    .modal .actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 14px }
    .hidden { display: none !important }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 18px; left: 50%; transform: translateX(-50%);
      background: #0e1834;
      border: 1px solid #243055;
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 60;
    }

    /* External links list */
    .links-list {
      display: grid;
      gap: 10px;
    }
    .link-item {
      display: grid;
      gap: 6px;
      padding: 10px;
      border: 1px dashed var(--border);
      border-radius: 10px;
      background: #0c1326;
    }
    .link-actions {
      display: flex;
      gap: 8px;
    }
    .link-actions .btn { font-size: 12px; padding: 6px 10px }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Customer Success Process Flow</h1>
      <p>Interactive flow with clickable stages, context details, and safe external link viewing.</p>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
      <h3 class="section-title">Controls</h3>
      <div class="filter-row">
        <input id="search" class="input" type="search" placeholder="Search stage..." />
        <select id="statusFilter" class="select">
          <option value="">All statuses</option>
          <option value="active">Active</option>
          <option value="completed">Completed</option>
          <option value="pending">Pending</option>
          <option value="blocked">Blocked</option>
        </select>
        <button id="resetBtn" class="btn">Reset</button>
      </div>

      <div class="legend">
        <div class="legend-item">
          <span class="dot" style="background: var(--accent)"></span>
          <span>Active</span>
        </div>
        <div class="legend-item">
          <span class="dot" style="background: var(--ok)"></span>
          <span>Completed</span>
        </div>
        <div class="legend-item">
          <span class="dot" style="background: var(--warn)"></span>
          <span>Pending</span>
        </div>
        <div class="legend-item">
          <span class="dot" style="background: var(--danger)"></span>
          <span>Blocked</span>
        </div>
      </div>

      <div style="margin-top: 14px">
        <button id="openModal" class="btn primary">Open checklist</button>
      </div>
    </aside>

    <!-- Canvas -->
    <main class="canvas">
      <div class="toolbar">
        <div class="zoom-group">
          <button class="btn" id="zoomOut">-</button>
          <button class="btn" id="zoomReset">Reset</button>
          <button class="btn" id="zoomIn">+</button>
        </div>
        <div style="flex:1"></div>
        <button class="btn" id="exportJSON">Export flow JSON</button>
      </div>

      <div class="svg-wrap">
        <svg id="flow" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet">
          <defs>
            <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="#334155"></path>
            </marker>
            <linearGradient id="gradActive" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#18264a"/>
              <stop offset="100%" stop-color="#0b1326"/>
            </linearGradient>
            <linearGradient id="gradCompleted" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#153a2c"/>
              <stop offset="100%" stop-color="#0b1f1a"/>
            </linearGradient>
            <linearGradient id="gradPending" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#3a2b15"/>
              <stop offset="100%" stop-color="#1f160a"/>
            </linearGradient>
            <linearGradient id="gradBlocked" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#3a1520"/>
              <stop offset="100%" stop-color="#1a0b12"/>
            </linearGradient>
          </defs>

          <!-- Edges -->
          <g class="edges">
            <line class="edge" x1="140" y1="120" x2="360" y2="120" />
            <text class="edge-label" x="250" y="105">handoff</text>

            <line class="edge" x1="460" y1="120" x2="680" y2="120" />
            <text class="edge-label" x="570" y="105">activation</text>

            <line class="edge" x1="680" y1="160" x2="680" y2="260" />
            <text class="edge-label" x="700" y="210">adoption</text>

            <line class="edge" x1="460" y1="300" x2="680" y2="300" />
            <text class="edge-label" x="570" y="285">outcomes</text>

            <line class="edge" x1="360" y1="160" x2="360" y2="260" />
            <text class="edge-label" x="380" y="210">risk review</text>

            <line class="edge" x1="140" y1="300" x2="360" y2="300" />
            <text class="edge-label" x="250" y="285">renewal</text>
          </g>

          <!-- Nodes -->
          <g id="n1" class="node active" data-id="n1" transform="translate(60,80)">
            <rect width="160" height="80" rx="12" fill="url(#gradActive)"></rect>
            <text x="80" y="45" text-anchor="middle">Sales handoff</text>
          </g>

          <g id="n2" class="node pending" data-id="n2" transform="translate(380,80)">
            <rect width="160" height="80" rx="12" fill="url(#gradPending)"></rect>
            <text x="80" y="45" text-anchor="middle">Onboarding</text>
          </g>

          <g id="n3" class="node blocked" data-id="n3" transform="translate(700,80)">
            <rect width="160" height="80" rx="12" fill="url(#gradBlocked)"></rect>
            <text x="80" y="45" text-anchor="middle">First value</text>
          </g>

          <g id="n4" class="node completed" data-id="n4" transform="translate(380,260)">
            <rect width="160" height="80" rx="12" fill="url(#gradCompleted)"></rect>
            <text x="80" y="45" text-anchor="middle">QBR</text>
          </g>

          <g id="n5" class="node pending" data-id="n5" transform="translate(700,260)">
            <rect width="160" height="80" rx="12" fill="url(#gradPending)"></rect>
            <text x="80" y="45" text-anchor="middle">Outcome review</text>
          </g>

          <g id="n6" class="node completed" data-id="n6" transform="translate(60,260)">
            <rect width="160" height="80" rx="12" fill="url(#gradCompleted)"></rect>
            <text x="80" y="45" text-anchor="middle">Renewal</text>
          </g>
        </svg>
      </div>
    </main>

    <!-- Detail panel -->
    <aside class="detail">
      <div class="detail-header">
        <div class="pill">
          <span class="status-dot" id="detailStatusDot" style="background: var(--accent)"></span>
          <span id="detailStatusText">Active</span>
        </div>
        <h3 id="detailTitle" style="margin: 8px 0 0">Sales handoff</h3>
        <p id="detailSubtitle" style="margin: 6px 0 0; color: var(--muted)">Transition from AE to CSM. Confirm context, stakeholders, and success plan.</p>
      </div>

      <div class="detail-content" id="detailContent">
        <div class="card">
          <strong>Overview:</strong>
          <p id="detailOverview" style="margin: 6px 0 0">
            Align on customer goals, scope, timelines, and define the engagement model.
          </p>
        </div>

        <div class="card">
          <strong>Key actions:</strong>
          <ul id="detailActions" style="margin: 6px 0 0; padding-left: 18px">
            <li>Read AE notes, confirm stakeholders</li>
            <li>Schedule kickoff call</li>
            <li>Draft success plan and milestones</li>
          </ul>
        </div>

        <div class="card">
          <strong>External links:</strong>
          <div class="links-list" id="detailLinks">
            <!-- Filled dynamically -->
          </div>
        </div>
      </div>

      <div class="detail-footer">
        <div style="display:flex; gap:8px">
          <button class="btn" id="markCompleted">Mark completed</button>
          <button class="btn" id="flagBlocked">Flag blocked</button>
          <button class="btn" id="copyPermalink">Copy stage link</button>
        </div>
      </div>
    </aside>

    <footer>
      <small style="color: var(--muted)">
        Tip: Click any stage to view details. External links open in a new tab with rel="noopener noreferrer" for safety.
      </small>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <h3>Stage checklist</h3>
      <div class="card">
        <ul style="margin: 6px 0 0; padding-left: 18px">
          <li><strong>Handoff:</strong> Confirm success criteria, risks, and stakeholders</li>
          <li><strong>Onboarding:</strong> Provision, access, training, first 30/60/90 plan</li>
          <li><strong>First value:</strong> Define MVP use case and measure impact</li>
          <li><strong>QBR:</strong> Metrics, ROI, upcoming initiatives</li>
          <li><strong>Outcome review:</strong> Executive summary and decision log</li>
          <li><strong>Renewal:</strong> Align on value realized and next-term objectives</li>
        </ul>
      </div>
      <div class="actions">
        <button class="btn" id="modalClose">Close</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Data + Logic -->
  <script>
    const stages = {
      n1: {
        title: "Sales handoff",
        status: "active",
        subtitle: "Transition from AE to CSM. Confirm context, stakeholders, and success plan.",
        overview: "Align on customer goals, scope, timelines, and define the engagement model.",
        actions: [
          "Read AE notes, confirm stakeholders",
          "Schedule kickoff call",
          "Draft success plan and milestones",
        ],
        links: [
          { label: "Handoff template (Google Doc)", url: "https://docs.google.com" },
          { label: "Discovery notes (Confluence)", url: "https://www.atlassian.com/software/confluence" },
          { label: "Success plan example", url: "https://success.microsoft.com/" }
        ]
      },
      n2: {
        title: "Onboarding",
        status: "pending",
        subtitle: "Provision access, training plan, and first milestone.",
        overview: "Ensure the customer can use the product. Confirm key integrations and training schedule.",
        actions: [
          "Provision accounts and SSO",
          "Deliver training workshop",
          "Configure integrations"
        ],
        links: [
          { label: "Onboarding tracker (Sheet)", url: "https://www.google.com/sheets/about/" },
          { label: "Integration docs", url: "https://developer.microsoft.com/" },
          { label: "Training catalog", url: "https://learn.microsoft.com/" }
        ]
      },
      n3: {
        title: "First value",
        status: "blocked",
        subtitle: "Prove value with an MVP use case.",
        overview: "Select a quick-win use case, deploy, and measure outcome.",
        actions: [
          "Define KPI and baseline",
          "Launch MVP",
          "Measure and report impact"
        ],
        links: [
          { label: "KPI guide", url: "https://www.investopedia.com/terms/k/key-performance-indicators-kpi.asp" },
          { label: "MVP playbook", url: "https://martinfowler.com/bliki/MVP.html" },
          { label: "Dashboard example", url: "https://datastudio.google.com/" }
        ]
      },
      n4: {
        title: "QBR",
        status: "completed",
        subtitle: "Quarterly business review with metrics and roadmap.",
        overview: "Share outcomes, ROI, and agree on next quarter initiatives.",
        actions: [
          "Prepare deck with metrics",
          "Facilitate exec review",
          "Document decisions"
        ],
        links: [
          { label: "QBR deck sample", url: "https://slides.google.com/" },
          { label: "ROI calculator", url: "https://www.calculator.net/roi-calculator.html" }
        ]
      },
      n5: {
        title: "Outcome review",
        status: "pending",
        subtitle: "Validate outcomes and executive sign-off.",
        overview: "Summarize value delivered, risks, and decisions to proceed.",
        actions: [
          "Compile exec summary",
          "Confirm adoption metrics",
          "Log decisions and next steps"
        ],
        links: [
          { label: "Executive summary template", url: "https://www.template.net/" },
          { label: "Adoption metrics guide", url: "https://www.productplan.com/glossary/product-adoption/" }
        ]
      },
      n6: {
        title: "Renewal",
        status: "completed",
        subtitle: "Align on next-term value and contract.",
        overview: "Negotiate renewal based on realized outcomes and roadmap.",
        actions: [
          "Share renewal proposal",
          "Align on roadmap",
          "Finalize contract"
        ],
        links: [
          { label: "Renewal playbook", url: "https://www.gainsight.com/" },
          { label: "Contract best practices", url: "https://www.meridianpartners.com/blog/contract-best-practices" }
        ]
      }
    };

    // Helpers
    const statusColors = {
      active: "var(--accent)",
      completed: "var(--ok)",
      pending: "var(--warn)",
      blocked: "var(--danger)"
    };
    function setDetail(stageId) {
      const s = stages[stageId];
      if (!s) return;
      document.querySelectorAll(".node").forEach(n => n.classList.remove("selected"));
      const node = document.getElementById(stageId);
      if (node) node.classList.add("selected");

      // Header
      document.getElementById("detailTitle").textContent = s.title;
      document.getElementById("detailSubtitle").textContent = s.subtitle;
      document.getElementById("detailStatusText").textContent = s.status[0].toUpperCase() + s.status.slice(1);
      document.getElementById("detailStatusDot").style.background = statusColors[s.status];

      // Content
      document.getElementById("detailOverview").textContent = s.overview;

      const actionsEl = document.getElementById("detailActions");
      actionsEl.innerHTML = "";
      s.actions.forEach(a => {
        const li = document.createElement("li");
        li.textContent = a;
        actionsEl.appendChild(li);
      });

      const linksEl = document.getElementById("detailLinks");
      linksEl.innerHTML = "";
      s.links.forEach(link => {
        const item = document.createElement("div");
        item.className = "link-item";
        const title = document.createElement("div");
        title.innerHTML = `<strong>${link.label}</strong><br/><small style="color: var(--muted)">${link.url}</small>`;
        const actions = document.createElement("div");
        actions.className = "link-actions";

        const openBtn = document.createElement("a");
        openBtn.className = "btn";
        openBtn.textContent = "Open link";
        openBtn.href = link.url;
        openBtn.target = "_blank";
        openBtn.rel = "noopener noreferrer";

        const copyBtn = document.createElement("button");
        copyBtn.className = "btn";
        copyBtn.textContent = "Copy URL";
        copyBtn.addEventListener("click", () => {
          navigator.clipboard.writeText(link.url)
            .then(() => showToast("Link copied to clipboard"))
            .catch(() => showToast("Unable to copy link"));
        });

        actions.appendChild(openBtn);
        actions.appendChild(copyBtn);
        item.appendChild(title);
        item.appendChild(actions);
        linksEl.appendChild(item);
      });

      // Update node status classes
      document.querySelectorAll(".node").forEach(n => {
        n.classList.remove("active", "completed", "pending", "blocked");
        const id = n.getAttribute("data-id");
        const st = stages[id]?.status || "pending";
        n.classList.add(st);
      });
    }

    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(() => (t.style.display = "none"), 1800);
    }

    // Zoom logic
    let zoom = 1;
    const svgWrap = document.querySelector(".svg-wrap");
    const svg = document.getElementById("flow");
    function applyZoom() {
      svg.style.transformOrigin = "0 0";
      svg.style.transform = `scale(${zoom})`;
    }

    // Events: node click
    document.querySelectorAll(".node").forEach(node => {
      node.addEventListener("click", () => {
        const id = node.getAttribute("data-id");
        setDetail(id);
      });
    });

    // Controls
    document.getElementById("zoomIn").addEventListener("click", () => {
      zoom = Math.min(2, zoom + 0.1);
      applyZoom();
    });
    document.getElementById("zoomOut").addEventListener("click", () => {
      zoom = Math.max(0.6, zoom - 0.1);
      applyZoom();
    });
    document.getElementById("zoomReset").addEventListener("click", () => {
      zoom = 1;
      applyZoom();
      svgWrap.scrollTo({ left: 0, top: 0, behavior: "smooth" });
    });

    // Search + filter
    const search = document.getElementById("search");
    const statusFilter = document.getElementById("statusFilter");
    function updateVisibility() {
      const q = search.value.trim().toLowerCase();
      const f = statusFilter.value;
      document.querySelectorAll(".node").forEach(n => {
        const id = n.getAttribute("data-id");
        const s = stages[id];
        const matchesText = !q || s.title.toLowerCase().includes(q);
        const matchesStatus = !f || s.status === f;
        n.style.opacity = (matchesText && matchesStatus) ? 1 : 0.18;
      });
    }
    search.addEventListener("input", updateVisibility);
    statusFilter.addEventListener("change", updateVisibility);
    document.getElementById("resetBtn").addEventListener("click", () => {
      search.value = "";
      statusFilter.value = "";
      updateVisibility();
    });

    // Detail footer actions
    document.getElementById("markCompleted").addEventListener("click", () => {
      const title = document.getElementById("detailTitle").textContent;
      const id = Object.keys(stages).find(k => stages[k].title === title);
      if (!id) return;
      stages[id].status = "completed";
      setDetail(id);
      showToast("Stage marked as completed");
    });
    document.getElementById("flagBlocked").addEventListener("click", () => {
      const title = document.getElementById("detailTitle").textContent;
      const id = Object.keys(stages).find(k => stages[k].title === title);
      if (!id) return;
      stages[id].status = "blocked";
      setDetail(id);
      showToast("Stage flagged as blocked");
    });
    document.getElementById("copyPermalink").addEventListener("click", () => {
      const title = document.getElementById("detailTitle").textContent;
      const id = Object.keys(stages).find(k => stages[k].title === title);
      const url = new URL(window.location.href);
      url.searchParams.set("stage", id);
      navigator.clipboard.writeText(url.toString())
        .then(() => showToast("Permalink copied"))
        .catch(() => showToast("Unable to copy permalink"));
    });

    // Modal
    const modalBackdrop = document.getElementById("modalBackdrop");
    document.getElementById("openModal").addEventListener("click", () => {
      modalBackdrop.style.display = "flex";
    });
    document.getElementById("modalClose").addEventListener("click", () => {
      modalBackdrop.style.display = "none";
    });
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) modalBackdrop.style.display = "none";
    });

    // Export JSON
    document.getElementById("exportJSON").addEventListener("click", () => {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(stages, null, 2));
      const dl = document.createElement("a");
      dl.setAttribute("href", dataStr);
      dl.setAttribute("download", "customer_success_flow.json");
      dl.click();
    });

    // Deep linking
    const params = new URLSearchParams(window.location.search);
    const stageParam = params.get("stage");
    if (stageParam && stages[stageParam]) {
      setDetail(stageParam);
    } else {
      setDetail("n1");
    }

    // Keyboard navigation
    const order = ["n1","n2","n3","n4","n5","n6"];
    document.addEventListener("keydown", (e) => {
      const current = document.getElementById("detailTitle").textContent;
      const idx = order.findIndex(k => stages[k].title === current);
      if (e.key === "ArrowRight") {
        const next = order[Math.min(order.length - 1, idx + 1)];
        setDetail(next);
      } else if (e.key === "ArrowLeft") {
        const prev = order[Math.max(0, idx - 1)];
        setDetail(prev);
      }
    });
  </script>
</body>
</html>
