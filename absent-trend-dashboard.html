<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Absenteeism Trend Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* small custom styling to match the sample theme */
    .card-shadow { box-shadow: 0 10px 30px rgba(2,6,23,0.08); }
    .trend-label { font-size: 12px; color: #6B7280; }
    .small-muted { font-size: 13px; color: #6B7280; }
    /* make Chart.js tooltip more compact */
    .chartjs-tooltip { font-size: 12px !important; }
  </style>
</head>

<body class="bg-gray-100 text-gray-800">

<!-- Header Banner -->
<div class="relative h-44 bg-gradient-to-r from-blue-600 via-blue-700 to-blue-800 overflow-hidden">
  <div class="absolute inset-0 bg-black/18"></div>
  <div class="max-w-[1440px] mx-auto px-10">
    <nav class="relative z-10 flex items-center justify-between py-6">
      <h1 class="text-white text-2xl font-bold">Digital Minds BPO</h1>
      <ul class="flex space-x-6 text-white items-center">
        <li><a href="#" class="hover:underline">Home</a></li>
        <li><a href="#" class="hover:underline">Reports</a></li>

        <!-- Month Dropdown -->
        <li>
          <select id="monthSelector"
                  class="bg-white/10 text-white px-3 py-2 rounded-md border border-white/30 focus:outline-none focus:ring-2 focus:ring-blue-400">
            <option value="" disabled selected class="bg-white text-gray-800">Select Month</option>
            <option value="1" class="bg-white text-gray-800">January</option>
            <option value="2" class="bg-white text-gray-800">February</option>
            <option value="3" class="bg-white text-gray-800">March</option>
            <option value="4" class="bg-white text-gray-800">April</option>
            <option value="5" class="bg-white text-gray-800">May</option>
            <option value="6" class="bg-white text-gray-800">June</option>
            <option value="7" class="bg-white text-gray-800">July</option>
            <option value="8" class="bg-white text-gray-800">August</option>
            <option value="9" class="bg-white text-gray-800">September</option>
            <option value="10" class="bg-white text-gray-800">October</option>
            <option value="11" class="bg-white text-gray-800">November</option>
            <option value="12" class="bg-white text-gray-800">December</option>
          </select>
        </li>

        <!-- Roster Dropdown -->
        <li>
          <select id="rosterSelector"
                  class="bg-white/10 text-white px-3 py-2 rounded-md border border-white/30 focus:outline-none focus:ring-2 focus:ring-blue-400">
            <option value="" class="bg-white text-gray-800">All Teams</option>
            <option value="Team A" class="bg-white text-gray-800">Team A</option>
            <option value="Team B" class="bg-white text-gray-800">Team B</option>
          </select>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Main Content -->
<div class="max-w-[1200px] mx-auto px-8 -mt-14 relative z-20">

  <!-- Top KPIs -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white rounded-2xl card-shadow p-6">
      <div class="flex items-start justify-between">
        <div>
          <h3 class="text-sm text-gray-500">Avg Absenteeism (Days)</h3>
          <div id="kpi-days" class="text-3xl font-bold text-slate-900">0</div>
          <div id="kpi-days-delta" class="small-muted mt-1">—</div>
        </div>
        <div class="flex items-center">
          <i data-feather="bar-chart-2" class="text-pink-500"></i>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl card-shadow p-6">
      <div class="flex items-start justify-between">
        <div>
          <h3 class="text-sm text-gray-500">Absenteeism Rate</h3>
          <div id="kpi-rate" class="text-3xl font-bold text-red-600">0%</div>
          <div id="kpi-rate-delta" class="small-muted mt-1">—</div>
        </div>
        <div class="flex items-center">
          <i data-feather="trending-down" class="text-red-500"></i>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl card-shadow p-6">
      <div class="flex items-start justify-between">
        <div>
          <h3 class="text-sm text-gray-500">6-year Change</h3>
          <div id="kpi-change" class="text-3xl font-bold text-emerald-600">—</div>
          <div id="kpi-change-delta" class="small-muted mt-1">from 2017 → 2022</div>
        </div>
        <div class="flex items-center">
          <i data-feather="clock" class="text-blue-500"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Trend Card -->
  <div class="bg-white rounded-2xl card-shadow p-6 mb-8">
    <div class="flex items-center justify-between mb-3">
      <div>
        <h2 class="text-xl font-semibold">Absenteeism Over the Last 6 Years</h2>
        <div class="trend-label mt-1">Shows absenteeism in days (left axis) and rate % (right axis)</div>
      </div>
      <div class="text-right small-muted">
        <div>Data source: HR attendance summary</div>
        <div>Period: 2017 — 2022</div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2">
        <canvas id="absenteeChart" height="160"></canvas>
      </div>

      <div class="bg-gray-50 p-4 rounded-lg">
        <h4 class="text-sm font-semibold mb-2">Trend Summary</h4>
        <p id="trend-summary" class="text-sm small-muted mb-4">—</p>

        <div class="space-y-3">
          <div>
            <div class="text-xs text-gray-500">Highest Absenteeism (days)</div>
            <div id="highest-days" class="font-semibold">—</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Lowest Absenteeism Rate</div>
            <div id="lowest-rate" class="font-semibold">—</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Action</div>
            <div class="text-sm">Focus targeted wellbeing & attendance campaigns in years with spikes, strengthen supervisor follow-up.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Campaign Summary (existing style kept) -->
  <div class="bg-white rounded-2xl card-shadow p-6 mb-8">
    <h3 class="text-lg font-semibold mb-4">Quick Campaign Snapshot</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="p-4 border rounded-lg">
        <div class="text-sm text-gray-500">Current Month Absent</div>
        <div id="snap-absent" class="text-2xl font-bold text-red-600">—</div>
      </div>
      <div class="p-4 border rounded-lg">
        <div class="text-sm text-gray-500">Current Month Tardiness</div>
        <div id="snap-late" class="text-2xl font-bold text-yellow-600">—</div>
      </div>
      <div class="p-4 border rounded-lg">
        <div class="text-sm text-gray-500">Average Attendance Score</div>
        <div id="snap-score" class="text-2xl font-bold text-green-600">—</div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-6 py-6 bg-gray-50 border-t rounded-lg">
    <div class="text-sm text-gray-500 text-center">
      &copy; 2025 Digital Minds BPO — Absenteeism Trend Dashboard
    </div>
  </footer>

</div>

<script>
  feather.replace();

  // Sample historical absenteeism data (matches the sample visual you provided)
  const years = ['2017','2018','2019','2020','2021','2022'];
  const absenteeDays = [8.8, 8.5, 8.3, 8.0, 7.9, 7.7];   // left axis
  const absenteeRate = [4.0, 3.5, 3.3, 3.7, 3.0, 2.9];  // right axis (percent)

  // Render Chart.js dual-axis line chart
  const ctx = document.getElementById('absenteeChart').getContext('2d');
  // create gradient for filled area under rate line (soft pink)
  const gradient = ctx.createLinearGradient(0, 0, 0, 160);
  gradient.addColorStop(0, 'rgba(239, 68, 68, 0.18)'); // light red
  gradient.addColorStop(1, 'rgba(239, 68, 68, 0.02)');

  const absenteeChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: years,
      datasets: [
        {
          label: 'Absenteeism in Days',
          data: absenteeDays,
          yAxisID: 'yDays',
          tension: 0.28,
          borderWidth: 2,
          borderColor: 'rgba(219, 39, 119, 0.95)', // pinkish
          pointBackgroundColor: 'white',
          pointBorderWidth: 2,
          pointRadius: 4,
          fill: false,
          backgroundColor: 'rgba(219, 39, 119, 0.08)'
        },
        {
          label: 'Absenteeism Rate (%)',
          data: absenteeRate,
          yAxisID: 'yRate',
          tension: 0.28,
          borderWidth: 2.5,
          borderColor: 'rgba(185,28,28,0.95)', // deep red
          pointBackgroundColor: 'rgba(185,28,28,1)',
          pointRadius: 4,
          fill: true,
          backgroundColor: gradient,
          cubicInterpolationMode: 'monotone'
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: true, labels: { boxWidth: 12, padding: 12 } },
        tooltip: { padding: 8, bodySpacing: 6 },
      },
      scales: {
        x: {
          grid: { display: false },
          ticks: { color: '#374151' }
        },
        yDays: {
          type: 'linear',
          position: 'left',
          ticks: {
            callback: (v) => v.toFixed(1),
            color: '#374151'
          },
          title: {
            display: true,
            text: 'Days',
            color: '#374151'
          },
          grid: {
            color: 'rgba(15,23,42,0.04)'
          }
        },
        yRate: {
          type: 'linear',
          position: 'right',
          ticks: {
            callback: (v) => v + '%',
            color: '#9B1C1C'
          },
          title: {
            display: true,
            text: 'Rate (%)',
            color: '#9B1C1C'
          },
          grid: { display: false }
        }
      }
    }
  });

  // KPI computations + narrative
  function computeKPIs() {
    // average days & rate
    const avgDays = (absenteeDays.reduce((a,b)=>a+b,0) / absenteeDays.length);
    const avgRate = (absenteeRate.reduce((a,b)=>a+b,0) / absenteeRate.length);

    // change 2017 -> 2022
    const daysDiff = absenteeDays[absenteeDays.length-1] - absenteeDays[0];
    const rateDiff = absenteeRate[absenteeRate.length-1] - absenteeRate[0];
    const ratePercChange = ((rateDiff / absenteeRate[0]) * 100);

    // highest day year
    let maxDays = -Infinity, maxIdx = 0;
    absenteeDays.forEach((v,i)=> { if (v > maxDays) { maxDays = v; maxIdx = i; }});

    // lowest rate year
    let minRate = Infinity, minIdx = 0;
    absenteeRate.forEach((v,i)=> { if (v < minRate) { minRate = v; minIdx = i; }});

    // fill UI
    document.getElementById('kpi-days').textContent = avgDays.toFixed(2);
    document.getElementById('kpi-rate').textContent = avgRate.toFixed(2) + '%';
    document.getElementById('kpi-change').textContent = (daysDiff <= 0 ? `${Math.abs(daysDiff).toFixed(2)} ↓` : `${daysDiff.toFixed(2)} ↑`);
    document.getElementById('kpi-days-delta').textContent = `Avg days (2017–2022). Latest: ${absenteeDays[absenteeDays.length-1].toFixed(1)} days.`;
    document.getElementById('kpi-rate-delta').textContent = `Rate change: ${rateDiff.toFixed(2)} pts (${ratePercChange.toFixed(1)}%).`;
    document.getElementById('highest-days').textContent = `${years[maxIdx]} — ${maxDays.toFixed(1)} days`;
    document.getElementById('lowest-rate').textContent = `${years[minIdx]} — ${minRate.toFixed(2)}%`;

    // small snapshot placeholders
    document.getElementById('snap-absent').textContent = '12';     // sample placeholder
    document.getElementById('snap-late').textContent = '34';       // sample placeholder
    document.getElementById('snap-score').textContent = '89%';     // sample placeholder

    // narrative summary
    const summary = [];
    summary.push(`Average absenteeism across ${years[0]}–${years[years.length-1]} is ${avgDays.toFixed(2)} days (${avgRate.toFixed(2)}%).`);
    if (rateDiff < 0) {
      summary.push(`Rate fell by ${Math.abs(rateDiff).toFixed(2)} percentage points since ${years[0]} — a ${Math.abs(ratePercChange).toFixed(1)}% reduction.`);
    } else if (rateDiff > 0) {
      summary.push(`Rate rose by ${rateDiff.toFixed(2)} percentage points since ${years[0]} — a ${ratePercChange.toFixed(1)}% increase.`);
    } else {
      summary.push(`Rate remained stable versus ${years[0]}.`);
    }
    const spikeYears = [];
    absenteeRate.forEach((v,i)=> { if (v >= Math.max(...absenteeRate.slice(0,3))) spikeYears.push(years[i]); });
    summary.push(`Highest days recorded in ${years[maxIdx]}. Focus investigations on years with local increases (e.g., ${years[2]}–${years[3]}).`);
    document.getElementById('trend-summary').textContent = summary.join(' ');
  }

  computeKPIs();

  // Hook month/roster selectors (placeholders — in your real app you'll re-load data from backend)
  document.getElementById('monthSelector').addEventListener('change', () => {
    // In production: fetch filtered data from your API with the selected month
    // For demo, just show a toast or recalc (no change)
    alert('Month filter changed — hook this to your backend to re-query data.');
  });
  document.getElementById('rosterSelector').addEventListener('change', () => {
    alert('Roster filter changed — hook this to your backend to re-query data.');
  });

</script>

</body>
</html>
