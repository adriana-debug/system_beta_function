<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BPO Dashboard — Coaching</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#CBEB33',
                        brandlight: '#D9F25A',
                        blackpearl: '#04101d',
                        pear: '#e5e7eb',
                        waterloo: '#565f6f',
                        wasabi: '#2c370b',
                        primary: '#1f2937', 
                        secondary: '#4b5563'
                    }
                }
            }
        };
    </script>
    <style>
        .page-section { display: none; }
        .page-section.active { display: block; }
        .nav-link.active-link {
            background-color: #D9F25A; /* brandlight */
            color: #04101d; /* blackpearl */
            font-weight: 600;
        }
        /* Custom styles for the formal document viewer content */
        .doc-viewer-content h1, .doc-viewer-content h2, .doc-viewer-content h3 {
             font-family: Georgia, serif; /* Formal serif font for headers */
        }
        .doc-viewer-content p {
            text-align: justify;
            font-family: Georgia, serif; /* Formal serif font for body */
            line-height: 1.6;
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-800">
    <div class="flex min-h-screen">
        <aside class="w-64 bg-white shadow-xl flex flex-col border-r border-gray-200">
            <div class="p-6 flex flex-col items-center gap-3 border-b border-gray-200">
                <img src="dmi_logo.png" alt="Logo" class="w-16 h-16 rounded-full object-cover shadow-lg">
                <h1 class="text-xl font-extrabold text-primary tracking-wide">Digital Minds BPO</h1>
            </div>
            <nav class="flex-1 px-4 space-y-1 py-4">
                <a href="#" data-page="dashboard"
                    class="nav-link flex items-center px-4 py-3 rounded-lg text-secondary hover:bg-gray-100 transition duration-150 active-link">
                    <i class="fas fa-chart-line w-5 h-5 mr-3"></i>
                    Dashboard
                </a>
                <a href="#" data-page="coaching"
                    class="nav-link flex items-center px-4 py-3 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">
                    <i class="fas fa-clipboard-list w-5 h-5 mr-3"></i>
                    Coaching Log
                </a>
                <a href="#" data-page="irnte"
                    class="nav-link flex items-center px-4 py-3 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">
                    <i class="fas fa-exclamation-triangle w-5 h-5 mr-3"></i>
                    IR / NTE
                </a>
                <a href="#" data-page="sop"
                    class="nav-link flex items-center px-4 py-3 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">
                    <i class="fas fa-book-open w-5 h-5 mr-3"></i>
                    SOP Documents
                </a>
                <a href="#" data-page="knowledge-base"
                    class="nav-link flex items-center px-4 py-3 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">
                    <i class="fas fa-book-reader w-5 h-5 mr-3"></i>
                    Knowledge Base
                </a>
                <a href="#" data-page="tools"
                    class="nav-link flex items-center px-4 py-3 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">
                    <i class="fas fa-tools w-5 h-5 mr-3"></i>
                    Tools
                </a>
            </nav>
            <div class="p-4 border-t border-gray-200">
                <button class="w-full py-3 bg-brand hover:bg-brandlight text-blackpearl font-semibold rounded-lg shadow-md transition duration-150">Logout</button>
            </div>
        </aside>

        <main class="flex-1 p-8">
            <section id="dashboard" class="page-section active">
                <h1 class="text-4xl font-extrabold mb-6 text-primary">Dashboard</h1>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col justify-between h-48">
                        <p class="text-sm font-medium text-secondary">Key Performance Indicator 1</p>
                        <div class="text-4xl font-bold text-primary">95.4%</div>
                        <p class="text-green-500 text-sm">↑ 2.1% from last month</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 flex items-center justify-center text-secondary h-48 col-span-1 lg:col-span-2">
                        <i class="fas fa-chart-bar fa-2x mr-3 text-brand"></i>
                        Detailed Performance Charts Here
                    </div>
                </div>
            </section>
            
            <section id="coaching" class="page-section">
                 <div class="flex justify-between items-center mb-6">
                    <h1 class="text-4xl font-extrabold text-primary">Coaching Log</h1>
                    <a href="https://www.adrianavenido.com/coaching-form-log.html" target="_blank"
                        class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-150 transform hover:scale-[1.02]">
                        <i class="fas fa-plus-circle mr-2"></i>Update Coaching Log
                    </a>
                </div>

                <div class="bg-white rounded-xl shadow-2xl p-6 relative">
                    <h2 class="text-2xl font-semibold mb-6 text-primary border-b pb-3 border-gray-200">Past Coaching Sessions</h2>

                    <div class="mb-6 flex justify-between items-center">
                        <input type="text" id="coachingSearch" placeholder="Search by Employee, Coach, or Employee No..." 
                            class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brandlight focus:border-brandlight transition duration-150"
                            onkeyup="handleSearch()">
                    </div>
                    <div id="coachingLoadingSpinner" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl">
                         <div class="flex flex-col items-center">
                            <svg class="animate-spin h-10 w-10 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p id="coachingLoadingText" class="mt-3 text-lg text-primary font-medium">Loading data...</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead style="background-color: #04101c;" class="text-white">
                                <tr>
                                    <th class="text-left px-4 py-3 rounded-tl-lg">Date</th>
                                    <th class="text-left px-4 py-3">Coach</th>
                                    <th class="text-left px-4 py-3">Employee</th>
                                    <th class="text-left px-4 py-3">Employee No.</th>
                                    <th class="text-left px-4 py-3">Performance Observed</th>
                                    <th class="text-left px-4 py-3">Acknowledge</th>
                                    <th class="text-center px-4 py-3 rounded-tr-lg">Signed Document</th>
                                </tr>
                            </thead>
                            <tbody id="coachingSessionsTable" class="divide-y divide-gray-100">
                                <tr>
                                    <td colspan="7" class="text-center py-6 text-gray-500">Loading coaching data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="irnte" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-4xl font-extrabold text-primary">IR / NTE Log</h1>
                    <a href="#" target="_blank"
                        class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-150 transform hover:scale-[1.02]">
                        <i class="fas fa-file-alt mr-2"></i>File New IR / NTE
                    </a>
                </div>

                <div class="bg-white rounded-xl shadow-2xl p-6 relative">
                    <h2 class="text-2xl font-semibold mb-6 text-primary border-b pb-3 border-gray-200">Past IR / NTE Records</h2>

                    <div class="mb-6 flex justify-between items-center">
                        <input type="text" id="irnteSearch" placeholder="Search by Employee, Campaign, or NTE/IR Code..." 
                            class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brandlight focus:border-brandlight transition duration-150"
                            onkeyup="handleIRNTESearch()">
                    </div>
                    <div id="irnteLoadingSpinner" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl">
                         <div class="flex flex-col items-center">
                            <svg class="animate-spin h-10 w-10 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p id="irnteLoadingText" class="mt-3 text-lg text-primary font-medium">Loading data...</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead style="background-color: #04101c;" class="text-white">
                                <tr>
                                    <th class="text-left px-4 py-3">ID</th> 
                                    <th class="text-left px-4 py-3">Date Filed</th>
                                    <th class="text-left px-4 py-3">Employee</th>
                                    <th class="text-left px-4 py-3">Employee No.</th> 
                                    <th class="text-left px-4 py-3">Campaign</th>
                                    <th class="text-left px-4 py-3">NTE/IR Code</th>
                                    <th class="text-left px-4 py-3">Violation Category</th>
                                    <th class="text-left px-4 py-3">Decision (HR)</th>
                                    <th class="text-center px-4 py-3">NTE Docs</th> 
                                    <th class="text-center px-4 py-3 rounded-tr-lg">NOD Docs</th>
                                </tr>
                            </thead>
                            <tbody id="irnteSessionsTable" class="divide-y divide-gray-100">
                                <tr>
                                    <td colspan="10" class="text-center py-6 text-gray-500">Loading IR/NTE data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section id="sop" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-4xl font-extrabold text-primary">SOP Documents</h1>
                    <a href="#" target="_blank"
                        class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-150 transform hover:scale-[1.02]">
                        <i class="fas fa-file-alt mr-2"></i>New SOP Entry
                    </a>
                </div>

                <div class="bg-white rounded-xl shadow-2xl p-6 relative">
                    <h2 class="text-2xl font-semibold mb-6 text-primary border-b pb-3 border-gray-200">Standard Operating Procedures</h2>
                    <div class="mb-6 flex justify-between items-center">
                        <input type="text" id="sopSearch" placeholder="Search by SOP Name, Campaign, or ID..." 
                            class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brandlight focus:border-brandlight transition duration-150"
                            onkeyup="handleSOPSearch()">
                    </div>
                    <div id="sopLoadingSpinner" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl">
                         <div class="flex flex-col items-center">
                            <svg class="animate-spin h-10 w-10 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p id="sopLoadingText" class="mt-3 text-lg text-primary font-medium">Loading SOP data...</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead style="background-color: #04101c;" class="text-white">
                                <tr>
                                    <th class="text-left px-4 py-3 rounded-tl-lg">ID</th>
                                    <th class="text-left px-4 py-3">SOP Name</th>
                                    <th class="text-left px-4 py-3">Campaign</th>
                                    <th class="text-left px-4 py-3">Last Updated</th>
                                    <th class="text-center px-4 py-3 rounded-tr-lg">Document Link</th>
                                </tr>
                            </thead>
                            <tbody id="sopTable" class="divide-y divide-gray-100">
                                <tr>
                                    <td colspan="5" class="text-center py-6 text-gray-500">Loading SOP data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="knowledge-base" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-4xl font-extrabold text-primary">Knowledge Base Wiki</h1>
                    <button id="btnCreateNewDoc" onclick="openDocumentEditor()"
                        class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-150 transform hover:scale-[1.02]">
                        <i class="fas fa-file-alt mr-2"></i>Create New Document
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-2xl p-6 relative">
                    <div class="mb-6">
                        <input type="text" id="kbSearch" placeholder="Search by Document Title, Tags, or Content Keywords..." 
                            class="p-4 border border-gray-300 rounded-lg w-full focus:ring-brandlight focus:border-brandlight text-lg transition duration-150"
                            onkeyup="handleKBSearch()">
                    </div>

                    <div class="flex gap-6">
                        <div class="w-64 flex-shrink-0">
                            <h3 class="text-xl font-semibold mb-4 text-primary border-b pb-2">Categories</h3>
                            <nav class="space-y-1" id="kbCategoryNav">
                                <a href="#" data-category="all" class="block px-4 py-2 rounded-lg text-secondary bg-gray-100 font-medium hover:bg-gray-200 transition duration-150">All Documents (0)</a>
                                <a href="#" data-category="HR" class="block px-4 py-2 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">HR (0)</a>
                                <a href="#" data-category="Finance" class="block px-4 py-2 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">Finance (0)</a>
                                <a href="#" data-category="Operations" class="block px-4 py-2 rounded-lg text-secondary hover:bg-gray-100 transition duration-150">Operations (0)</a>
                            </nav>
                            <h3 class="text-xl font-semibold mt-6 mb-4 text-primary border-b pb-2">Recent</h3>
                            <nav class="space-y-1 text-sm text-gray-600">
                                <p>Onboarding Checklist (Placeholder)</p>
                                <p>New Payroll Process (Placeholder)</p>
                            </nav>
                        </div>

                        <div class="flex-1">
                            <h2 class="text-2xl font-semibold mb-6 text-primary border-b pb-3 border-gray-200">Documents List</h2>
                            
                            <div id="kbLoadingSpinner"
                                class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl">
                                <div class="flex flex-col items-center">
                                    <svg class="animate-spin h-10 w-10 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <p id="kbLoadingText" class="mt-3 text-lg text-primary font-medium">Loading documents...</p>
                                </div>
                            </div>

                            <div id="documentGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                                <div class="bg-gray-50 rounded-lg shadow-md p-5 border-t-4 border-brand">
                                    <h4 class="text-lg font-bold text-primary mb-2">Loading documents...</h4>
                                    <p class="text-sm text-gray-600 truncate mb-3">#documentation</p>
                                    <div class="text-xs text-secondary space-y-1">
                                        <p><strong>Category:</strong> N/A</p>
                                        <p><strong>Author:</strong> N/A</p>
                                        <p><strong>Last Modified:</strong> N/A</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="tools" class="page-section">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-4xl font-extrabold text-primary">Campaigns Tools List</h1> 
                    <a href="#" target="_blank"
                        class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-150 transform hover:scale-[1.02]">
                        <i class="fas fa-tools mr-2"></i>New Tool Entry
                    </a>
                </div>
                <div class="bg-white rounded-xl shadow-2xl p-6 relative">
                    <h2 class="text-2xl font-semibold mb-6 text-primary border-b pb-3 border-gray-200">Applications and Resources</h2>

                    <div class="mb-6 flex justify-between items-center">
                        <input type="text" id="toolsSearch" placeholder="Search by Tool Name, Campaign, or Description..." 
                            class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brandlight focus:border-brandlight transition duration-150"
                            onkeyup="handleToolsSearch()">
                    </div>
                    <div id="toolsLoadingSpinner" class="hidden absolute inset-0 bg-white/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl">
                         <div class="flex flex-col items-center">
                            <svg class="animate-spin h-10 w-10 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p id="toolsLoadingText" class="mt-3 text-lg text-primary font-medium">Loading Tools data...</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead style="background-color: #04101c;" class="text-white">
                                <tr>
                                    <th class="text-left px-4 py-3 rounded-tl-lg">ID</th>
                                    <th class="text-left px-4 py-3">Tool Name</th>
                                    <th class="text-left px-4 py-3">Campaign</th> <th class="text-left px-4 py-3">Description</th>
                                    <th class="text-center px-4 py-3">URL</th>
                                    <th class="text-center px-4 py-3 rounded-tr-lg">Work Instruction</th>
                                </tr>
                            </thead>
                            <tbody id="toolsTable" class="divide-y divide-gray-100">
                                <tr>
                                    <td colspan="6" class="text-center py-6 text-gray-500">Loading Tools data...</td> </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="documentViewerModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl">
                <h3 class="text-xl font-bold text-primary" id="docViewerTitle">Document Title</h3>
                <div class="space-x-2">
                    <button class="text-sm text-blue-600 hover:text-blue-800 font-semibold" onclick="openDocumentEditor(document.getElementById('documentViewerModal').dataset.docId)">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </button>
                    <button class="text-secondary hover:text-red-500" onclick="document.getElementById('documentViewerModal').classList.add('hidden')">
                        <i class="fas fa-times fa-lg"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex-1 p-8 overflow-y-auto relative">
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-10">
                    <span class="text-6xl font-extrabold text-brand transform rotate-[-45deg] select-none">DIGITAL MINDS BPO</span>
                </div>

                <div id="docViewerContent" class="doc-viewer-content max-w-none text-base">
                    <p class="mb-6 text-center text-gray-500">Fetching document content...</p>
                </div>
            </div>

            <div class="p-4 border-t border-gray-200 text-xs text-secondary flex justify-between">
                <p>Version 1.0 | <span id="docViewerCategory">Category: N/A</span></p>
                <p>Last Modified: <span id="docViewerDate">MM/DD/YYYY</span></p>
            </div>
        </div>
    </div>

    <div id="documentEditorModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[95vh] flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50 rounded-t-xl">
                <h3 class="text-xl font-bold text-primary" id="docEditorTitle">Create New Document</h3>
                <button class="text-secondary hover:text-red-500" onclick="document.getElementById('documentEditorModal').classList.add('hidden')">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            
            <div class="flex-1 p-6 overflow-y-auto space-y-4">
                <input type="text" id="docTitleInput" placeholder="Document Title (e.g., Remote Work Policy)" 
                    class="p-3 border border-gray-300 rounded-lg w-full text-xl font-semibold focus:ring-brandlight focus:border-brandlight">
                
                <div class="grid grid-cols-3 gap-4">
                    <select id="docCategorySelect" class="p-3 border border-gray-300 rounded-lg focus:ring-brandlight focus:border-brandlight">
                        <option value="">Select Category</option>
                        <option value="HR">HR</option>
                        <option value="Finance">Finance</option>
                        <option value="Operations">Operations</option>
                        <option value="General">General</option>
                    </select>
                    <input type="text" id="docTagsInput" placeholder="Tags (e.g., #policy, #remote, #hr - comma-separated)" 
                        class="col-span-2 p-3 border border-gray-300 rounded-lg focus:ring-brandlight focus:border-brandlight">
                </div>
                
                <h4 class="text-lg font-semibold text-primary mt-4">Document Content (Rich Text Editor Placeholder)</h4>
                <textarea id="docContentRTE" rows="15" placeholder="Start drafting your SOP or internal document here... (In a production app, replace this with TinyMCE/Quill)"
                    class="p-4 border border-gray-300 rounded-lg w-full resize-none font-mono text-sm focus:ring-brandlight focus:border-brandlight"></textarea>
            </div>

            <div class="p-4 border-t border-gray-200 flex justify-end">
                <button id="btnSaveDocument" onclick="saveDocument()"
                    class="bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-lg shadow-md font-bold transition duration-150">
                    <i class="fas fa-save mr-2"></i>Save Document
                </button>
            </div>
        </div>
    </div>


    <div id="loadingModal"
        class="hidden fixed inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center z-50">
        <div class="w-24 h-24 border-4 border-brand border-t-transparent rounded-full animate-spin"></div>
        <p id="loadingText" class="mt-4 text-brand text-lg font-medium">Loading...</p>
    </div>

    <script>
        feather.replace();

        // 🛑 CRITICAL: REPLACE THESE URLS WITH YOUR LIVE, ANYONE-ACCESS GOOGLE APPS SCRIPT WEB APP URLs
        const COACHING_API_URL = "https://script.google.com/macros/s/AKfycbzh35p0nz1Xtb1Gaksxk7KR2DxlNfjk-imi2I3KbTt-MY2raDI5QrcpjSA_5dv0TJN6/exec";
        const IRNTE_API_URL = "https://script.google.com/macros/s/AKfycbz8wi_hsT5s0nGMXpc2sMsVG6Xue9eoadKoZUXLpIXTkY1WO0V3cg1B5ilqfVcwrruW/exec"; 
        const SOP_TOOLS_API_URL = "https://script.google.com/macros/s/AKfycbwn0GPogd4Cy3TiEPR462FId4nP1DTy2r8Aciqxp389JS6lopKgV5j9u1My_g1YyE7t/exec"; 
        
        // ** API URL is now set to null to force local data loading **
        const KNOWLEDGE_BASE_API_URL = null; 
        
        // --- STATIC DATA FROM book2.xlsx - Sheet1.csv (Resolved content for local use) ---
        const staticKBData = [
            { id: 1, documentName: "Attendance and Tardiness Policy", campaign: "Telco Sales", tags: "HR, Policy, Attendance", author: "HR Department", dateCreated: "2025-01-05", lastModified: "2025-01-15", documentContent: "This policy outlines the company’s expectations regarding punctuality and attendance. Employees are expected to log in on time for their shifts, with a 15-minute grace period provided. Repeated tardiness beyond three instances per month may result in a Notice to Explain (NTE). Absences without prior notice (NCNS) for three consecutive days will be treated as job abandonment. Supervisors must record attendance violations and escalate them to HR. Employees who face emergencies are advised to communicate with their immediate manager at least one hour before their shift." },
            { id: 2, documentName: "Customer Escalation SOP", campaign: "Banking Support", tags: "Operations, Customer Service, SOP", author: "Quality Team", dateCreated: "2025-01-08", lastModified: "2025-01-20", documentContent: "The Customer Escalation SOP provides a step-by-step guide on handling issues that cannot be resolved during the first interaction. Tier 1 agents must document the concern in the CRM system and escalate to Tier 2 if unresolved after basic troubleshooting. Cases involving financial discrepancies should be immediately flagged as High Priority and forwarded to the Escalation Desk within 30 minutes. Managers are responsible for reviewing escalations daily and ensuring customers are informed of updates within 24 hours. The goal of this SOP is to reduce resolution time and improve customer satisfaction scores." },
            { id: 3, documentName: "Data Privacy Guidelines", campaign: "Healthcare BPO", tags: "Compliance, Privacy, Security", author: "Legal Team", dateCreated: "2025-01-12", lastModified: "2025-01-22", documentContent: "This document emphasizes the importance of protecting sensitive personal information. All employees are required to follow HIPAA (for healthcare accounts) and GDPR principles when handling patient or customer data. Prohibited actions include sharing login credentials, storing customer information on personal devices, and sending sensitive data via unsecured channels. Violations of these guidelines may result in disciplinary action, including suspension or termination. Annual privacy training is mandatory for all employees, with additional refresher sessions as needed." },
            { id: 4, documentName: "QA Calibration Process", campaign: "Retail Support", tags: "QA, Performance, Training", author: "QA Manager", dateCreated: "2025-01-15", lastModified: "2025-01-25", documentContent: "The QA Calibration Process ensures consistent scoring across all quality analysts. Weekly calibration sessions are conducted where team leaders and QA staff review sample calls and align on scoring criteria. Discrepancies in evaluation must be discussed and resolved during these sessions to avoid agent disputes. Calibration data is tracked and analyzed monthly to identify trends. The process aims to maintain fairness and accuracy in performance evaluations, ultimately driving improvements in agent behavior and customer satisfaction." },
            { id: 5, documentName: "Remote Work Guidelines", campaign: "Tech Support", tags: "WFH, Policy, Operations", author: "HR Department", dateCreated: "2025-01-18", lastModified: "2025-01-27", documentContent: "These guidelines outline the responsibilities and expectations of employees working remotely. Employees must ensure stable internet connectivity, a quiet working environment, and the proper use of company-issued devices. Unauthorized use of VPNs or third-party software is strictly prohibited. Daily check-ins via video conferencing are required, and employees must remain available on Slack or Teams during scheduled shifts. HR reserves the right to request workstation inspections. Repeated violations of WFH policies may result in disciplinary action or revocation of remote work privileges." }
        ];
        
        let allCoachingSessions = []; 
        let allIRNTESessions = []; 
        let allSOPSessions = []; 
        let allKBDocuments = []; 
        let allToolsSessions = [];

        // Helper function to format the date (MM/DD/YYYY)
        function formatDate(dateString) {
            if (!dateString) return "N/A";
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return dateString;
                }
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const year = date.getFullYear();

                return `${month}/${day}/${year}`;
            } catch (e) {
                return dateString;
            }
        }
        
        // --- Placeholder functions for existing sections (kept for functionality) ---

        function renderCoachingTable(sessionsToRender) { /* ... original implementation ... */ }
        function handleSearch() { /* ... original implementation ... */ }
        async function loadCoachingSessions() { /* ... original implementation ... */ }
        function renderIRNTETable(sessionsToRender) { /* ... original implementation ... */ }
        function handleIRNTESearch() { /* ... original implementation ... */ }
        async function loadIRNTE() { /* ... original implementation ... */ }
        function handleSOPSearch() { /* ... original implementation ... */ }
        async function loadSOP() { /* ... original implementation ... */ }
        function renderToolsTable(sessionsToRender) { /* ... original implementation ... */ }
        function handleToolsSearch() { /* ... original implementation ... */ }
        async function loadTools() { /* ... original implementation ... */ }


        // --- NEW KNOWLEDGE BASE FUNCTIONS (UPDATED TO USE STATIC DATA) ---

        function renderKBDocumentsGrid(documentsToRender) {
            const grid = document.getElementById("documentGrid");
            grid.innerHTML = ""; 

            if (!Array.isArray(documentsToRender) || documentsToRender.length === 0) {
                grid.innerHTML = `<div class="md:col-span-3 text-center py-10 text-gray-500">No documents match your criteria.</div>`;
                return;
            }

            // Simple search to get category counts for the sidebar (local only)
            const categoryCounts = documentsToRender.reduce((acc, doc) => {
                const cat = doc.campaign || 'General';
                acc[cat] = (acc[cat] || 0) + 1;
                return acc;
            }, {});

            document.querySelectorAll('#kbCategoryNav a[data-category]').forEach(link => {
                const cat = link.dataset.category;
                if (cat === 'all') {
                    link.textContent = `All Documents (${documentsToRender.length})`;
                } else if (categoryCounts[cat]) {
                    link.textContent = `${cat} (${categoryCounts[cat]})`;
                } else {
                    link.textContent = `${cat} (0)`;
                }
            });


            documentsToRender.forEach(doc => {
                const tags = (doc.tags || '').split(',').map(tag => `#${tag.trim()}`).join(' ');
                const lastModified = formatDate(doc.lastModified);

                grid.innerHTML += `
                    <div class="bg-gray-50 rounded-lg shadow-md p-5 border-t-4 border-brand hover:shadow-xl transition duration-300 cursor-pointer" onclick="openDocumentViewer(${doc.id})">
                        <h4 class="text-lg font-bold text-primary mb-2">${doc.documentName || "Untitled Document"}</h4>
                        <p class="text-sm text-gray-600 truncate mb-3">${tags || "#documentation"}</p>
                        <div class="text-xs text-secondary space-y-1">
                            <p><strong>Category:</strong> ${doc.campaign || "General"}</p>
                            <p><strong>Author:</strong> ${doc.author || "N/A"}</p>
                            <p><strong>Last Modified:</strong> ${lastModified}</p>
                        </div>
                    </div>`;
            });
        }

        function handleKBSearch() {
            const query = document.getElementById('kbSearch').value.toLowerCase().trim();
            
            if (!query) {
                renderKBDocumentsGrid(allKBDocuments); 
                return;
            }

            const filteredDocuments = allKBDocuments.filter(doc => {
                // Search in title, category (campaign), tags, and content
                return (doc.documentName && doc.documentName.toLowerCase().includes(query)) ||
                       (doc.campaign && doc.campaign.toLowerCase().includes(query)) ||
                       (doc.tags && doc.tags.toLowerCase().includes(query)) || 
                       (doc.documentContent && doc.documentContent.toLowerCase().includes(query)); // Search in content as well
            });

            renderKBDocumentsGrid(filteredDocuments);
        }

        /**
         * UPDATED: Load data from local staticKBData array instead of API.
         */
        async function loadKnowledgeBaseDocs() {
            const spinner = document.getElementById('kbLoadingSpinner');
            const grid = document.getElementById("documentGrid");

            grid.innerHTML = `<div class="md:col-span-3 text-center py-10 text-gray-500">Loading Knowledge Base documents...</div>`;
            spinner.classList.remove('hidden');
            
            try {
                // *** Use STATIC DATA instead of fetch ***
                allKBDocuments = staticKBData.map(doc => ({ 
                    ...doc, 
                    id: Number(doc.id) // Ensure ID is a number for matching
                })); 
                
                renderKBDocumentsGrid(allKBDocuments);

            } catch (error) {
                console.error("Error loading KB documents from local data:", error);
                
                const errorMessage = `Failed to load KB data from local source. (Error: ${error.message})`;

                grid.innerHTML = `<div class="md:col-span-3 text-center py-10 text-red-500 font-semibold">${errorMessage}</div>`;
            }
            spinner.classList.add('hidden');
        }

        /**
         * UPDATED: Use locally available documentContent.
         */
        function openDocumentViewer(docId) {
            const viewerModal = document.getElementById('documentViewerModal');
            const contentDiv = document.getElementById('docViewerContent');

            const doc = allKBDocuments.find(d => d.id == docId);

            if (!doc) {
                alert("Document not found.");
                return;
            }

            viewerModal.dataset.docId = docId;
            document.getElementById('docViewerTitle').textContent = doc.documentName || `Document ID: ${docId}`;
            document.getElementById('docViewerCategory').textContent = `Category: ${doc.campaign || "General"}`;
            document.getElementById('docViewerDate').textContent = formatDate(doc.lastModified);
            
            // Format content by wrapping in a paragraph tag for styling
            const formattedContent = doc.documentContent.split('\n').map(p => `<p class="mb-4">${p}</p>`).join('');

            contentDiv.innerHTML = formattedContent;

            viewerModal.classList.remove('hidden');
        }

        function openDocumentEditor(docId = null) {
            document.getElementById('documentViewerModal').classList.add('hidden');
            const editorModal = document.getElementById('documentEditorModal');
            
            if (docId) {
                const doc = allKBDocuments.find(d => d.id == docId);
                if (!doc) { alert("Document not found for editing."); return; }

                document.getElementById('docEditorTitle').textContent = `Edit Document ID: ${docId}`;
                document.getElementById('docTitleInput').value = doc.documentName || '';
                // Since saving is disabled, populate editor with local content
                document.getElementById('docContentRTE').value = doc.documentContent || ''; 
                document.getElementById('docCategorySelect').value = doc.campaign || '';
                document.getElementById('docTagsInput').value = doc.tags || '';
                editorModal.dataset.docId = docId;
            } else {
                document.getElementById('docEditorTitle').textContent = 'Create New Document';
                document.getElementById('docTitleInput').value = '';
                document.getElementById('docContentRTE').value = '';
                document.getElementById('docCategorySelect').value = '';
                document.getElementById('docTagsInput').value = '';
                editorModal.dataset.docId = '';
            }
            
            editorModal.classList.remove('hidden');
        }

        function saveDocument() {
            alert("Saving is disabled because the Google Apps Script API URL is inactive. Please use the editor as a local scratchpad.");
            document.getElementById('documentEditorModal').classList.add('hidden');
        }


        // --- NAVIGATION LOGIC ---
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('active-link'));
                this.classList.add('active-link');

                document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
                const pageId = this.dataset.page;
                document.getElementById(pageId).classList.add('active');
                
                // Simplified conditional loading for demonstration
                if (pageId === 'knowledge-base') {
                    if (allKBDocuments.length === 0) {
                        loadKnowledgeBaseDocs();
                    } else {
                        renderKBDocumentsGrid(allKBDocuments);
                    }
                } 
                // Placeholder logic for other pages:
                else if (pageId === 'coaching') { /* loadCoachingSessions() */ } 
                else if (pageId === 'irnte') { /* loadIRNTE() */ } 
                else if (pageId === 'sop') { /* loadSOP() */ } 
                else if (pageId === 'tools') { /* loadTools() */ }
            });
        });

        // Initial load check
        document.addEventListener("DOMContentLoaded", () => {
            const activeLink = document.querySelector('.nav-link.active-link');
            if (activeLink && activeLink.dataset.page === 'knowledge-base') {
                 loadKnowledgeBaseDocs();
            } else if (activeLink && activeLink.dataset.page === 'dashboard') {
                 // Do nothing, Dashboard is static
            }
            // Default to loading KB data if dashboard is active but KB should be prioritized
            if (document.getElementById('knowledge-base').classList.contains('active')) {
                loadKnowledgeBaseDocs();
            }
        });
    </script>
</body>
</html>