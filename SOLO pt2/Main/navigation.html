<script>
  // Navigation and routing system
  const AppNav = {
    currentPage: null,

    init() {
      // Setup drawer controls
      document.getElementById('menuBtn').addEventListener('click', () => AppUtils.toggleDrawer(true));
      document.getElementById('closeDrawerBtn').addEventListener('click', () => AppUtils.toggleDrawer(false));
      document.getElementById('overlay').addEventListener('click', () => AppUtils.toggleDrawer(false));

      // Setup theme toggle
      document.getElementById('themeToggle').addEventListener('click', () => AppUtils.toggleTheme());

      // Setup navigation buttons
      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', () => this.loadPage(btn.dataset.page));
      });

      // Initialize Google Charts
      if (window.google && window.google.charts) {
        google.charts.load('current', {'packages':['corechart']});
      }
    },

    loadPage(pageName) {
      if (!AppConfig.PAGES[pageName]) {
        console.error('Page not found:', pageName);
        return;
      }

      this.currentPage = pageName;
      const pageConfig = AppConfig.PAGES[pageName];
      
      // Update title
      document.getElementById('mainTitleContainer').textContent = pageConfig.title;

      // Update active nav item
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('tab-active');
        if (item.dataset.page === pageName) {
          item.classList.add('tab-active');
        }
      });

      // Hide all pages
      document.querySelectorAll('.page-section').forEach(page => {
        page.classList.add('hidden');
      });

      // Show selected page
      const pageElement = document.getElementById(`page-${pageName}`);
      if (pageElement) {
        pageElement.classList.remove('hidden');
        
        // Initialize page-specific functionality
        const initFunction = `init_${pageName}`;
        if (window[initFunction]) {
          window[initFunction]();
        }
      }

      // Close drawer and scroll to top
      AppUtils.toggleDrawer(false);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };
</script>