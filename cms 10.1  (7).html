<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPO Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#CBEB33',
                        brandlight: '#D9F25A'
                    }
                }
            }
        }
    </script>

    <style>
        /* Style for Page Navigation: Hides all non-active pages by default */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Styles for Attendance Tab component */
        .tab {
            color: black;
            transition: background-color 0.2s, color 0.2s;
        }

        .tab:hover {
            background-color: #f0f9c0;
            /* brandlight hover */
            color: black;
        }

        .tab.active {
            border-bottom: 2px solid #cce416;
            /* brand color */
            background-color: #f0f9c0;
            color: black;
        }
    </style>
</head>

<body class="bg-gray-50 text-slate-800">
    <div class="flex min-h-screen">

        <aside class="w-64 bg-white shadow-xl flex flex-col">
            <div class="p-6 flex flex-col items-center gap-2">
                <img src="dmi_logo.jpg" alt="Digital Minds BPO Logo"
                    class="w-20 h-20 rounded-full object-cover mb-2">
                <h1 class="text-xl font-bold text-slate-900 text-center">Digital Minds BPO</h1>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <a href="#" data-page="dashboard"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-tachometer-alt mr-3 text-slate-700"></i> Dashboard
                </a>

                <a href="#" data-page="campaigns"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-bullhorn mr-3 text-slate-700"></i> Campaigns
                </a>

                <a href="#" data-page="headcount"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-users mr-3 text-slate-700"></i> Headcount
                </a>

                <a href="#" data-page="attendance-calendar"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-calendar-check mr-3 text-slate-700"></i> Attendance Calendar
                </a>

                <a href="#" data-page="billing"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-file-invoice-dollar mr-3 text-slate-700"></i> Billing
                </a>

                <a href="#" data-page="scorecards"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-clipboard-list mr-3 text-slate-700"></i> Scorecards
                </a>



                <a href="#" data-page="coaching"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-chart-pie mr-3 text-slate-700"></i> Coaching Log
                </a>



                <a href="#" data-page="reports"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-chart-pie mr-3 text-slate-700"></i> Reports
                </a>


                <p class="text-xs text-gray-400 mt-6 uppercase px-4">Macro</p>
                <a href="#" data-page="macro"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-bolt mr-3 text-slate-700"></i> Macros
                </a>
            </nav>

            <div class="p-4">
                <button
                    class="w-full py-2 bg-brand hover:bg-brandlight rounded-lg font-semibold text-slate-900 transition">Logout</button>
            </div>
        </aside>

        <main class="flex-1 ml-0 md:ml-0 p-6">

            <section id="dashboard" class="page-section active">
                <h1 class="text-3xl font-bold mb-4">Dashboard</h1>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-2">Welcome Back, Admin</h2>
                    <p class="text-gray-600">Here’s an overview of your CRM campaigns and agent performance today.</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Tickets Handled</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">1,250</p>
                        <p class="text-sm text-green-600 mt-1">↑ 5% from last month</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">FCR %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#d8ec42]">87%</p>
                        <p class="text-sm text-red-600 mt-1">↓ 2% from last month</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Avg Response Time</h3>
                        <p class="text-3xl font-bold mt-2 text-[#e2f171]">2h 15m</p>
                        <p class="text-sm text-green-600 mt-1">↓ 10% from last month</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">CSAT %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">92%</p>
                        <p class="text-sm text-green-600 mt-1">↑ 3% from last month</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6 overflow-x-auto">
                    <h2 class="text-xl font-semibold mb-4">Campaign Summary</h2>
                    <table class="min-w-full text-sm border-collapse">
                        <thead class="bg-gray-100 text-gray-700">
                            <tr>
                                <th class="text-left px-4 py-3">Campaign</th>
                                <th class="text-left px-4 py-3">Line of Business</th>
                                <th class="text-left px-4 py-3">Total Agents</th>
                                <th class="text-left px-4 py-3">Tickets Handled</th>
                                <th class="text-left px-4 py-3">FCR %</th>
                                <th class="text-left px-4 py-3">CSAT %</th>
                                <th class="text-left px-4 py-3">Avg Response Time</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-2 font-semibold">Campaign A</td>
                                <td class="px-4 py-2">Retail</td>
                                <td class="px-4 py-2">40</td>
                                <td class="px-4 py-2">450</td>
                                <td class="px-4 py-2">88%</td>
                                <td class="px-4 py-2">91%</td>
                                <td class="px-4 py-2">2h 10m</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-semibold">Campaign B</td>
                                <td class="px-4 py-2">Banking</td>
                                <td class="px-4 py-2">35</td>
                                <td class="px-4 py-2">380</td>
                                <td class="px-4 py-2">85%</td>
                                <td class="px-4 py-2">93%</td>
                                <td class="px-4 py-2">2h 30m</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-semibold">Campaign C</td>
                                <td class="px-4 py-2">Telecom</td>
                                <td class="px-4 py-2">45</td>
                                <td class="px-4 py-2">420</td>
                                <td class="px-4 py-2">90%</td>
                                <td class="px-4 py-2">89%</td>
                                <td class="px-4 py-2">1h 50m</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Campaign Trends</h2>
                    <div class="h-64 bg-gray-100 flex items-center justify-center text-gray-400">
                        Chart placeholder (Tickets / FCR / CSAT)
                    </div>
                </div>
            </section>

            <section id="campaigns" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Campaigns</h1>

                <div class="relative">
                    <div class="h-56 relative rounded-2xl overflow-hidden flex items-center">
                        <div class="absolute inset-0">
                            <div class="w-full h-full bg-brand"></div>
                            <svg class="absolute inset-0 w-full h-full opacity-10" viewBox="0 0 1440 320"
                                xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <pattern id="dots" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
                                        <circle cx="20" cy="20" r="6" fill="#A6B91A" />
                                    </pattern>
                                </defs>
                                <rect width="1440" height="320" fill="url(#dots)" />
                            </svg>
                            <svg class="absolute bottom-0 left-0 w-full h-28" viewBox="0 0 1440 320"
                                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path fill="#CBE31B" fill-opacity="0.5"
                                    d="M0,224L48,202.7C96,181,192,139,288,154.7C384,171,480,245,576,240C672,235,768,149,864,117.3C960,85,1056,107,1152,117.3C1248,128,1344,128,1392,128L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
                                </path>
                            </svg>
                        </div>
                        <div class="absolute top-4 right-6 flex items-center gap-4 z-10">
                            <input type="text" placeholder="Search..."
                                class="px-4 py-2 rounded-full outline-none text-gray-700 shadow-md bg-white/90 w-56" />
                        </div>
                    </div>

                    <div class="relative w-[95%] max-w-6xl mx-auto -mt-16 z-20">
                        <div
                            class="bg-white/70 backdrop-blur-safe rounded-4xl p-6 flex flex-col md:flex-row items-center gap-6 border border-white/20 shadow-lg">
                            <img src="https://via.placeholder.com/96" alt="Profile"
                                class="w-24 h-24 rounded-full border-4 border-white shadow-lg object-cover">
                            <div class="flex-1 text-center md:text-left">
                                <h2 class="text-2xl font-semibold text-slate-900">Digital Minds BPO</h2>
                                <p class="text-sm text-slate-600">admin@dmibpo.com</p>
                            </div>
                            <div class="flex flex-wrap justify-center md:justify-end gap-3">
                                <button
                                    class="px-6 py-2 rounded-full bg-white/60 hover:bg-white text-slate-900 font-medium transition">OVERVIEW</button>
                                <button
                                    class="px-6 py-2 rounded-full bg-white/60 hover:bg-white text-slate-900 font-medium transition">TEAMS</button>
                                <button
                                    class="px-6 py-2 rounded-full bg-white/60 hover:bg-white text-slate-900 font-medium transition">PROJECTS</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-4 md:px-8 mt-10 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <section class="bg-white rounded-xl shadow p-6">
                        <h3 class="font-semibold mb-4">Platform Settings</h3>
                        <p class="text-xs text-gray-400 mb-2">ACCOUNT</p>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span>Email me when someone follows me</span>
                                <input type="checkbox" class="h-5 w-5" />
                            </label>
                            <label class="flex items-center justify-between">
                                <span>Email me when someone answers on my post</span>
                                <input type="checkbox" class="h-5 w-5" />
                            </label>
                            <label class="flex items-center justify-between">
                                <span>Email me when someone mentions me</span>
                                <input type="checkbox" class="h-5 w-5" />
                            </label>
                        </div>
                    </section>

                    <section class="bg-white rounded-xl shadow p-6">
                        <h3 class="font-semibold mb-4">Profile Information</h3>
                        <p class="text-sm mb-4">Hi, I’m Esthera Jackson. Decisions: If you can’t decide, the answer is no...
                        </p>
                        <div class="text-sm space-y-2">
                            <p><strong>Full Name:</strong> Esthera Jackson</p>
                            <p><strong>Mobile:</strong> (44) 123 1234 123</p>
                            <p><strong>Email:</strong> esthera@simmmpple.com</p>
                            <p><strong>Location:</strong> United States</p>
                            <p><strong>Social:</strong>
                                <span class="inline-flex gap-3 ml-2 text-slate-700">
                                    <i class="fab fa-facebook-f"></i>
                                    <i class="fab fa-instagram"></i>
                                    <i class="fab fa-twitter"></i>
                                </span>
                            </p>
                        </div>
                    </section>

                    <section class="bg-white rounded-xl shadow p-6">
                        <h3 class="font-semibold mb-4">Conversations</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="https://via.placeholder.com/40" class="rounded-full" />
                                    <div>
                                        <p class="font-medium">Sophie B.</p>
                                        <p class="text-sm text-gray-500">Hi! I need more information...</p>
                                    </div>
                                </div>
                                <a href="#" class="text-slate-700 text-sm font-semibold">REPLY</a>
                            </div>
                            </div>
                    </section>
                </div>
            </section>


            <section id="attendance-calendar" class="page-section">
                <div class="bg-white rounded-xl shadow-lg p-6">

                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-slate-900">Attendance</h1>
                        <div class="flex gap-2"></div>
                    </div>

                    <div class="mb-6 border-b border-gray-300">
                        <nav class="flex space-x-4">
                            <button id="weekly-tab"
                                class="tab py-3 px-5 text-sm font-semibold rounded-t-lg focus:outline-none">Weekly
                                View</button>
                            <button id="monthly-tab"
                                class="tab py-3 px-5 text-sm font-semibold rounded-t-lg focus:outline-none">Monthly
                                View</button>
                            <button id="custom-tab"
                                class="tab py-3 px-5 text-sm font-semibold rounded-t-lg focus:outline-none">Custom</button>
                        </nav>
                    </div>

                    <div>
                        <div id="weekly-content">
                            <div class="flex justify-end items-center mb-6">
                                <div class="flex gap-2">
                                    <button
                                        class="px-4 py-2 bg-brand hover:bg-brandlight rounded-lg transition">This
                                        Week</button>
                                    <div class="flex items-center bg-gray-100 rounded-lg">
                                        <button class="p-2 hover:bg-gray-200 rounded-l-lg transition"><i
                                                class="fas fa-chevron-left"></i></button>
                                        <span class="px-4 font-semibold">Week 39, Sep 2025</span>
                                        <button class="p-2 hover:bg-gray-200 rounded-r-lg transition"><i
                                                class="fas fa-chevron-right"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="border rounded-xl overflow-hidden mb-6">
                                <div
                                    class="grid grid-cols-7 bg-gray-50 border-b text-center text-sm font-semibold text-slate-600">
                                    <div class="py-2">Sun</div>
                                    <div class="py-2">Mon</div>
                                    <div class="py-2">Tue</div>
                                    <div class="py-2">Wed</div>
                                    <div class="py-2">Thu</div>
                                    <div class="py-2">Fri</div>
                                    <div class="py-2">Sat</div>
                                </div>

                                <div class="grid grid-cols-7 text-center text-sm">
                                    <div class="p-2 border-b border-r min-h-[80px]">
                                        <div class="font-semibold">Sun</div>
                                        <div class="mt-2 text-green-700 bg-green-100 rounded px-2 py-1">Present: 45</div>
                                        <div class="mt-1 text-red-700 bg-red-100 rounded px-2 py-1">Absent: 3</div>
                                        <div class="mt-1 text-yellow-700 bg-yellow-100 rounded px-2 py-1">Leave: 2</div>
                                    </div>
                                    <div class="p-2 border-b border-r min-h-[80px]">
                                        <div class="font-semibold">Mon</div>
                                        <div class="mt-2 text-green-700 bg-green-100 rounded px-2 py-1">Present: 46</div>
                                        <div class="mt-1 text-red-700 bg-red-100 rounded px-2 py-1">Absent: 2</div>
                                        <div class="mt-1 text-yellow-700 bg-yellow-100 rounded px-2 py-1">Leave: 3</div>
                                    </div>
                                    </div>
                            </div>

                            <div class="bg-white rounded-xl shadow-md p-4 mt-4">
                                <h2 class="text-xl font-semibold mb-4">Campaign Attendance Summary</h2>
                                <table class="min-w-full text-sm border-collapse">
                                    <thead class="bg-gray-100 text-gray-700">
                                        <tr>
                                            <th class="text-left px-4 py-2">Campaign</th>
                                            <th class="text-left px-4 py-2">LOB</th>
                                            <th class="text-left px-4 py-2">Total Headcount</th>
                                            <th class="text-left px-4 py-2">Present</th>
                                            <th class="text-left px-4 py-2">Absent</th>
                                            <th class="text-left px-4 py-2">Covered Absences</th>
                                            <th class="text-left px-4 py-2">Attendance %</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-4 py-2 font-semibold">Campaign A</td>
                                            <td class="px-4 py-2">Finance</td>
                                            <td class="px-4 py-2">50</td>
                                            <td class="px-4 py-2">48</td>
                                            <td class="px-4 py-2">2</td>
                                            <td class="px-4 py-2">2</td>
                                            <td class="px-4 py-2">96%</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2 font-semibold">Campaign B</td>
                                            <td class="px-4 py-2">Retail</td>
                                            <td class="px-4 py-2">70</td>
                                            <td class="px-4 py-2">65</td>
                                            <td class="px-4 py-2">5</td>
                                            <td class="px-4 py-2">3</td>
                                            <td class="px-4 py-2">93%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="monthly-content" class="hidden">
                            <div class="overflow-x-auto mb-6">
                                <table class="min-w-full text-sm border-collapse">
                                    <thead class="bg-gray-100 text-gray-700">
                                        <tr>
                                            <th class="text-left px-4 py-2">Date</th>
                                            <th class="text-left px-4 py-2">Present</th>
                                            <th class="text-left px-4 py-2">Absent</th>
                                            <th class="text-left px-4 py-2">Leave</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="px-4 py-2">Sep 1, 2025</td>
                                            <td class="px-4 py-2">46</td>
                                            <td class="px-4 py-2">2</td>
                                            <td class="px-4 py-2">2</td>
                                        </tr>
                                        <tr>
                                            <td class="px-4 py-2">Sep 2, 2025</td>
                                            <td class="px-4 py-2">45</td>
                                            <td class="px-4 py-2">3</td>
                                            <td class="px-4 py-2">2</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="custom-content" class="hidden">
                            <div class="text-center text-gray-400 py-10">
                                <p>Custom content or additional visualizations can go here.</p>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <section id="billing" class="page-section px-6 py-4">
                <h1 class="text-3xl font-bold mb-4">Billing</h1>
                <p class="text-gray-600 mb-6">Overview of billing metrics, trends, and campaign comparison.</p>

                <div class="flex space-x-3 mb-6">
                    <button onclick="openDownloadModal()"
                        class="bg-[#cce416] hover:bg-[#d8ec42] text-black px-4 py-2 rounded shadow font-medium flex items-center space-x-2">
                        <i class="fas fa-file-excel"></i><span>Download Excel</span>
                    </button>
                    <button onclick="openDownloadModal()"
                        class="bg-[#cce416] hover:bg-[#d8ec42] text-black px-4 py-2 rounded shadow font-medium flex items-center space-x-2">
                        <i class="fas fa-file-pdf"></i><span>Download PDF</span>
                    </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Active Agents</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">120</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 3%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Total Headcount</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">145</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-red-600 font-semibold">↓ 2%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Lost Hours</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">125</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-red-600 font-semibold">↑ 5%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Covered Absences %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">95%</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 5%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Billed Hours</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">1,020 hrs</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 4%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Overhead (Supervisors)</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">25 hrs</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-yellow-600 font-semibold">↔ 1%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Agent Coverage %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#e2f171]">87.5%</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 2%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Agent Coverage Hours</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">1,050 hrs</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-red-600 font-semibold">↓ 1%</span> from last month
                        </p>
                    </div>
                </div>

                <div class="bg-white shadow rounded-xl p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-2">Lost Hours & Headcount Trend</h3>
                    <div class="h-64 flex items-center justify-center text-gray-400 border-2 border-dashed rounded-lg">
                        <span>Chart will go here</span>
                    </div>
                </div>

                <div class="bg-white shadow rounded-xl p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-2">Campaign Comparison</h3>
                    <div class="h-64 flex items-center justify-center text-gray-400 border-2 border-dashed rounded-lg">
                        <span>Chart will go here</span>
                    </div>
                </div>

                <section id="metrics-description" class="mb-10">
                    <h2 class="text-2xl font-bold mb-4">KPI Metrics & Calculations</h2>

                    <div class="space-y-4">
                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Coverage %</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Percentage of scheduled agent hours that are actively covered.
                                </p>
                                <p><strong>Calculation:</strong>
                                    <code>(Total Agent Hours Worked ÷ Total Scheduled Hours) × 100</code></p>
                                <p><strong>Example:</strong> 280 hours worked ÷ 320 scheduled hours × 100 = <strong>87.5%</strong>
                                </p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Lost Hours</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Hours lost due to absenteeism, tardiness, or unscheduled breaks.
                                </p>
                                <p><strong>Calculation:</strong> <code>Total Scheduled Hours - Total Hours Worked</code></p>
                                <p><strong>Example:</strong> 320 scheduled hours - 295 worked hours = <strong>25 lost hours</strong>
                                </p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Billed Hours</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Hours worked by billable agents submitted to the client.</p>
                                <p><strong>Calculation:</strong> Sum of all agents’ billable hours for the period.</p>
                                <p><strong>Example:</strong> Agent A: 40 hrs, Agent B: 38 hrs → Total Billed Hours =
                                    <strong>78 hrs</strong></p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Total Headcount</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Total number of employees in the team.</p>
                                <p><strong>Calculation:</strong> Count of all active employees.</p>
                                <p><strong>Example:</strong> 120 agents + 25 supervisors = <strong>145 total headcount</strong>
                                </p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Active Agents</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Number of agents actively handling tasks during the period.</p>
                                <p><strong>Calculation:</strong> Count of agents logged in and productive.</p>
                                <p><strong>Example:</strong> 120 out of 150 scheduled agents are active → <strong>80%</strong>
                                    active agents</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Overhead (Supervisors)</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Hours worked by non-billable employees (supervisors).</p>
                                <p><strong>Calculation:</strong> Sum of supervisors’ logged hours.</p>
                                <p><strong>Example:</strong> 5 supervisors × 5 hrs/day × 5 days = <strong>125 hrs</strong></p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Agent Coverage %</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Percentage of scheduled agents that were available and productive.
                                </p>
                                <p><strong>Calculation:</strong> <code>(Active Agents ÷ Total Scheduled Agents) × 100</code></p>
                                <p><strong>Example:</strong> 120 active ÷ 150 scheduled × 100 = <strong>80%</strong></p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Billing Efficiency</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Average billed hours per employee.</p>
                                <p><strong>Calculation:</strong> <code>Total Billed Hours ÷ Total Headcount</code></p>
                                <p><strong>Example:</strong> 320 billed hours ÷ 120 agents = <strong>2.67 hrs/agent</strong></p>
                            </div>
                        </details>
                    </div>
                </section>
            </section>

            <section id="headcount" class="page-section">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-3xl font-bold">Headcount</h1>
                    <button onclick="openCrudModal('addEmployee','NEW')"
                        class="px-4 py-2 bg-brand text-black rounded hover:bg-brandlight"> + Add Employee </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-slate-900">Agent Headcount</h2>
                        <div class="flex space-x-2">
                            <input type="text" id="searchHeadcount" oninput="filterHeadcount()"
                                placeholder="Search agents..."
                                class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand">
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left border-collapse">
                            <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
                                <tr>
                                    <th class="px-4 py-3">Emp No</th>
                                    <th class="px-4 py-3">Name</th>
                                    <th class="px-4 py-3">Phone</th>
                                    <th class="px-4 py-3">Emergency Contact</th>
                                    <th class="px-4 py-3">Department</th>
                                    <th class="px-4 py-3">DOJ</th>
                                    <th class="px-4 py-3">LWD</th>
                                    <th class="px-4 py-3">Status</th>
                                    <th class="px-4 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="headcountTableBody" class="divide-y divide-gray-200">
                                </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="scorecards" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Scorecards</h1>
                <div class="bg-white rounded-xl shadow-md p-6 h-96 flex items-center justify-center text-gray-400">
                    Scorecard visualization and data will be added here.
                </div>
            </section>

            <section id="reports" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Reports</h1>
                <div class="bg-white rounded-xl shadow-md p-6 h-96 flex items-center justify-center text-gray-400">
                    Reports dashboard and generation forms will be added here.
                </div>
                <button onclick="openRequestReportModal()"
                    class="mt-4 px-4 py-2 bg-brand text-black rounded hover:bg-brandlight">Request Custom Report</button>
            </section>

            <section id="coaching" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Coaching Log</h1>

                <div class="flex justify-end mb-6">
                    <button onclick="openCoachingModal()" class="bg-brand hover:bg-brandlight text-slate-900 px-6 py-2 rounded-lg shadow font-medium transition">
                        <i class="fas fa-plus mr-2"></i>Add Coaching Session
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 relative">
                    <h2 class="text-xl font-semibold mb-4 text-slate-900">Past Coaching Sessions</h2>

                    <div id="coachingLoadingSpinner" class="hidden absolute inset-0 bg-white/70 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl">
                        <div class="flex flex-col items-center">
                            <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p id="coachingLoadingText" class="mt-2 text-slate-700">Loading data...</p>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="bg-gray-100 text-gray-700">
                                <tr>
                                    <th class="text-left px-4 py-3">Date</th>
                                    <th class="text-left px-4 py-3">Coach</th>
                                    <th class="text-left px-4 py-3">Employee</th>
                                    <th class="text-left px-4 py-3">Employee No.</th> 
                                    <th class="text-left px-4 py-3">Focus Area</th>
                                    <th class="text-left px-4 py-3">Acknowledge</th>
                                    <th class="text-left px-4 py-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="coachingSessionsTable" class="divide-y divide-gray-200">
                                <tr><td colspan="7" class="text-center py-4 text-gray-500">Click "Coaching Log" to load data...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            <section id="macro" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Macros/Automation</h1>
                <div class="bg-white rounded-xl shadow-md p-6 h-96 flex items-center justify-center text-gray-400">
                    Macro creation and management interface.
                </div>
            </section>

        </main>
        </div>

    <div id="crudModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-lg p-6 relative">
            <button onclick="closeCrudModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            <h3 id="crudModalTitle" class="text-xl font-bold mb-4">Modal Title</h3>
            <div id="crudModalBody" class="space-y-4">
                </div>
            <div class="flex justify-end mt-6 space-x-2">
                <button onclick="closeCrudModal()" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
                <button id="crudModalAction"
                    class="px-4 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold">Confirm</button>
            </div>
        </div>
    </div>

    <div id="downloadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-sm p-6 relative">
            <button onclick="closeDownloadModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="text-xl font-bold mb-4">Download Report</h3>
            <div class="space-y-4">
                <label class="block">
                    <span class="text-gray-700">Select Date Range:</span>
                    <input type="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" />
                </label>
                <label class="block">
                    <span class="text-gray-700">Select Format:</span>
                    <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        <option>Excel (.xlsx)</option>
                        <option>PDF (.pdf)</option>
                        <option>CSV (.csv)</option>
                    </select>
                </label>
            </div>
            <div class="flex justify-end mt-6">
                <button onclick="downloadReport()"
                    class="px-4 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold">Download</button>
            </div>
        </div>
    </div>

    <div id="requestReportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 relative">
            <button onclick="closeRequestReportModal()"
                class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="text-xl font-bold mb-4">Request Custom Report</h3>
            <div class="space-y-4">
                <label class="block">
                    <span class="text-gray-700">Report Name:</span>
                    <input type="text" id="reportName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" />
                </label>
                <label class="block">
                    <span class="text-gray-700">Description / Requirements:</span>
                    <textarea id="reportDescription" rows="4"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                </label>
            </div>
            <div class="flex justify-end mt-6">
                <button onclick="submitReportRequest()"
                    class="px-4 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold">Submit Request</button>
            </div>
        </div>
    </div>
    
    <div id="coachingModalBg" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[1050]">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-6 relative">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 id="coachingModalTitle" class="text-xl font-semibold text-slate-900">Add Coaching Session</h3>
                <button onclick="closeCoachingModal()" class="text-gray-500 hover:text-gray-900 text-2xl leading-none">&times;</button>
            </div>

            <form id="coachingForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" name="id" />

                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">Employee Number</label>
                    <input type="text" name="employeenumber" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">Session Date</label>
                    <input type="date" name="date" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">Employee Name</label>
                    <input type="text" name="employee" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">Coach Name</label>
                    <input type="text" name="coach" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand">
                </div>


                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1 text-slate-700">Performance/Behavior Observed</label>
                    <textarea name="performance" rows="3" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand"></textarea>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1 text-slate-700">Coaching Provided</label>
                    <textarea name="coachingprovided" rows="3" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand"></textarea>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1 text-slate-700">Agreed Action Plan</label>
                    <textarea name="actionplan" rows="3" required class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-slate-700">Acknowledge</label>
                    <select name="acknowledge" class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-brand focus:border-brand">
                        <option value="Pending" selected>Pending</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>

                <div class="md:col-span-2 flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeCoachingModal()" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 font-medium transition">Cancel</button>
                    <button type="submit" class="px-6 py-2 rounded-lg bg-brand hover:bg-brandlight text-slate-900 font-medium shadow transition">
                        <i class="fas fa-save mr-1"></i>
                        <span id="coachingFormSubmitText">Save</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize main page navigation and other components when the DOM is fully loaded.
            initializePageNavigation();
            initializeAttendanceTabs();
            renderHeadcountTable();
        });


        /* --- Data Definitions --- */

        // NOTE: I commented out the incomplete api_url from your original file.
        // const api_url = "https://script.google.com/macros/s/AKfycbze-TuGjfOyuafjZqoIsFD3tORkTMWPAx5u9K03hwdWc3vZ36299UoPKpvfl920dxaNYw/exec:;

        const API_URL = "/api/v1/headcount"; // Placeholder API URL for Headcount data fetching
        const API_URL_CRUD = "/api/headcount"; // Placeholder API URL for Headcount CRUD actions
        const sampleAgents = [
            { id: 1, emp: 'DMI-0001', name: 'Jane Doe', phone: '09171234567', emergency: '09181234567', dept: 'Support', doj: '2024-01-10', lwd: '', status: 'Active' },
            { id: 2, emp: 'DMI-0002', name: 'John Smith', phone: '09172345678', emergency: '09182345678', dept: 'Sales', doj: '2024-02-05', lwd: '', status: 'Active' },
            { id: 3, emp: 'DMI-0003', name: 'Maria Cruz', phone: '09173456789', emergency: '09183456789', dept: 'Support', doj: '2023-11-15', lwd: '2024-09-25', status: 'On Leave' },
        ];


        /* --- Loading/Utility Functions --- */

        // NOTE: Kept simple placeholder loading functions for other sections
        function showLoading(message = "Processing...") {
            console.log(`Loading: ${message}`);
        }
        function hideLoading() {
            console.log("Loading complete.");
        }


        /* --- 4.1. Main Page Navigation Logic (MODIFIED FOR LAZY LOAD) --- */
        
        let currentPage = 'dashboard'; 
        let coachingDataLoaded = false; 

        function initializePageNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const pageSections = document.querySelectorAll('.page-section');
            const defaultPageId = 'dashboard';

            function navigateTo(pageId) {
                // Deactivate current page and links
                document.getElementById(currentPage).classList.remove('active');
                document.querySelector(`.nav-link[data-page="${currentPage}"]`).classList.remove('bg-brand');
                document.querySelector(`.nav-link[data-page="${currentPage}"]`).classList.remove('font-semibold');
                document.querySelector(`.nav-link[data-page="${currentPage}"]`).classList.remove('text-slate-900');
                document.querySelector(`.nav-link[data-page="${currentPage}"]`).classList.add('text-slate-700');

                // Activate new page and link
                document.getElementById(pageId).classList.add('active');
                document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('bg-brand');
                document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('font-semibold');
                document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('text-slate-900');
                document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.remove('text-slate-700');
                currentPage = pageId;
                
                // LAZY LOAD IMPLEMENTATION
                if (pageId === 'coaching' && !coachingDataLoaded) {
                    loadSessions();
                }
            }

            // Set up click listeners for all sidebar links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.dataset.page);
                });
            });

            // Set default page on load
            navigateTo(defaultPageId);
        }


        /* --- 4.2. Attendance Tabs Logic (Consolidated) --- */

        function initializeAttendanceTabs() {
            const tabs = document.querySelectorAll("#attendance-calendar .tab");
            const contents = {
                'weekly-tab': document.getElementById('weekly-content'),
                'monthly-tab': document.getElementById('monthly-content'),
                'custom-tab': document.getElementById('custom-content')
            };

            function switchTab(tabId) {
                // Update tab styles (using the CSS definitions in the <head>)
                tabs.forEach(t => t.classList.remove("active"));
                document.getElementById(tabId).classList.add("active");

                // Show/Hide content
                Object.keys(contents).forEach(key => {
                    const content = contents[key];
                    if (key === tabId) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
            }

            tabs.forEach(tab => {
                tab.addEventListener("click", () => {
                    const tabId = tab.id;
                    switchTab(tabId);
                });
            });
            
            // Initialize to the first tab
            switchTab('weekly-tab');
        }


        /* --- 4.3. Headcount CRUD and Table Logic --- */

        // Renders the initial data using DOM manipulation (instead of document.write)
        function renderHeadcountTable() {
            const tableBody = document.getElementById('headcountTableBody');
            if (!tableBody) return;

            tableBody.innerHTML = sampleAgents.map(agent => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3">${agent.emp}</td>
                    <td class="px-4 py-3">${agent.name}</td>
                    <td class="px-4 py-3">${agent.phone}</td>
                    <td class="px-4 py-3">${agent.emergency}</td>
                    <td class="px-4 py-3">${agent.dept}</td>
                    <td class="px-4 py-3">${agent.doj || '-'}</td>
                    <td class="px-4 py-3">${agent.lwd || '-'}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${agent.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${agent.status}</span>
                    </td>
                    <td class="px-4 py-3 text-center space-x-2">
                        <button onclick="openCrudModal('view','${agent.emp}')" class="text-blue-500 hover:underline">View</button>
                        <button onclick="openCrudModal('edit','${agent.emp}')" class="text-green-500 hover:underline">Edit</button>
                        <button onclick="openCrudModal('delete','${agent.emp}')" class="text-red-500 hover:underline">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Search/Filter function (placeholder)
        function filterHeadcount() {
            const searchInput = document.getElementById('searchHeadcount').value.toLowerCase();
            const rows = document.getElementById('headcountTableBody').getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const rowText = rows[i].textContent.toLowerCase();
                rows[i].style.display = rowText.includes(searchInput) ? '' : 'none';
            }
        }

        // Headcount CRUD Modal Functions (Placeholders for AJAX/Fetch implementation)
        const crudModal = document.getElementById('crudModal');
        const modalTitle = document.getElementById('crudModalTitle');
        const modalBody = document.getElementById('crudModalBody');
        const modalAction = document.getElementById('crudModalAction');

        function openCrudModal(action, id) {
            crudModal.classList.remove('hidden');
            modalBody.innerHTML = ''; // Clear previous content

            let agent = sampleAgents.find(a => a.emp === id);

            switch (action) {
                case 'NEW':
                    modalTitle.textContent = "Add New Employee";
                    modalBody.innerHTML = generateFormHtml({});
                    modalAction.textContent = "Create Employee";
                    modalAction.onclick = () => saveCrudModal('POST');
                    break;
                case 'view':
                    modalTitle.textContent = `View Employee: ${agent.name}`;
                    modalBody.innerHTML = generateViewHtml(agent);
                    modalAction.textContent = "Close";
                    modalAction.onclick = closeCrudModal;
                    break;
                case 'edit':
                    modalTitle.textContent = `Edit Employee: ${agent.name}`;
                    modalBody.innerHTML = generateFormHtml(agent);
                    modalAction.textContent = "Save Changes";
                    modalAction.onclick = () => saveCrudModal('PUT', id);
                    break;
                case 'delete':
                    modalTitle.textContent = "Confirm Deletion";
                    modalBody.innerHTML = `<p>Are you sure you want to delete <strong>${agent.name} (${id})</strong>?</p>`;
                    modalAction.textContent = "Delete";
                    modalAction.classList.remove('bg-brand');
                    modalAction.classList.add('bg-red-500', 'hover:bg-red-600', 'text-white');
                    modalAction.onclick = () => deleteCrudModal(id);
                    break;
            }
        }

        function closeCrudModal() {
            crudModal.classList.add('hidden');
            // Reset delete button style
            modalAction.classList.remove('bg-red-500', 'hover:bg-red-600', 'text-white');
            modalAction.classList.add('bg-brand', 'hover:bg-brandlight', 'text-black');
        }

        function generateFormHtml(data) {
            return `
                <form id="crudForm">
                    <label>Name:</label><input type="text" name="name" value="${data.name || ''}" class="w-full border p-2 rounded mb-2">
                    <label>Department:</label><input type="text" name="dept" value="${data.dept || ''}" class="w-full border p-2 rounded mb-2">
                    <label>Phone:</label><input type="text" name="phone" value="${data.phone || ''}" class="w-full border p-2 rounded mb-2">
                    <label>DOJ:</label><input type="date" name="doj" value="${data.doj || ''}" class="w-full border p-2 rounded mb-2">
                    </form>
            `;
        }

        function generateViewHtml(data) {
            return `
                <p><strong>Employee ID:</strong> ${data.emp}</p>
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>Department:</strong> ${data.dept}</p>
                <p><strong>Status:</strong> ${data.status}</p>
                <p><strong>Phone:</strong> ${data.phone}</p>
                <p><strong>Emergency:</strong> ${data.emergency}</p>
                <p><strong>Date of Join:</strong> ${data.doj}</p>
                <p><strong>Last Working Day:</strong> ${data.lwd || '-'}</p>
            `;
        }

        async function saveCrudModal(method, id = null) {
            showLoading(method === 'POST' ? "Creating employee..." : "Updating employee...");
            const formData = new FormData(document.getElementById('crudForm'));
            const data = Object.fromEntries(formData.entries());
            data.emp = id || 'DMI-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'); // Simple ID generation

            try {
                // Placeholder API call
                const response = await fetch(API_URL_CRUD, {
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ _method: id ? 'PUT' : 'POST', id, ...data })
                });

                if (response.ok) {
                    alert(`Employee ${id ? 'updated' : 'created'} successfully!`);
                    // Update sampleAgents array and re-render the table
                    if (id) {
                         const index = sampleAgents.findIndex(a => a.emp === id);
                         if (index !== -1) sampleAgents[index] = { ...sampleAgents[index], ...data };
                    } else {
                        // For demonstration, pushing a new mock agent
                        sampleAgents.push({ id: sampleAgents.length + 1, emp: data.emp, ...data, status: 'Active', emergency: 'N/A' }); 
                    }
                    renderHeadcountTable(); 
                    closeCrudModal();
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                alert(`Error processing request: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        async function deleteCrudModal(id) {
            showLoading("Deleting employee...");
            try {
                // Placeholder API call
                const response = await fetch(API_URL_CRUD, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ _method: 'DELETE', id })
                });

                if (response.ok) {
                    alert(`Employee ${id} deleted successfully!`);
                    // In a real app, you would remove the agent from the sampleAgents array here
                    const index = sampleAgents.findIndex(a => a.emp === id);
                    if (index > -1) sampleAgents.splice(index, 1);
                    renderHeadcountTable();
                    closeCrudModal();
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                alert(`Error processing deletion: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        /* --- 4.4. Download Modal Functions --- */

        const downloadModal = document.getElementById('downloadModal');
        function openDownloadModal() {
            downloadModal.classList.remove('hidden');
        }
        function closeDownloadModal() {
            downloadModal.classList.add('hidden');
        }
        function downloadReport() {
            alert("Download initiated! (Placeholder)");
            closeDownloadModal();
        }

        /* --- 4.5. Report Request Modal Functions --- */

        const requestReportModal = document.getElementById('requestReportModal');
        function openRequestReportModal() {
            requestReportModal.classList.remove('hidden');
        }
        function closeRequestReportModal() {
            requestReportModal.classList.add('hidden');
        }
        function submitReportRequest() {
            const name = document.getElementById('reportName').value;
            const desc = document.getElementById('reportDescription').value;
            alert(`Report Requested:\nName: ${name}\nDescription: ${desc}`);
            closeRequestReportModal();
        }


        /* --- 4.6. Coaching Log CRUD and UI Logic (RE-ADDED) --- */

        /* **************************************************************
         * !!! FIX ME !!!
         * This URL is the reason data is not loading.
         * Replace 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE' below 
         * with the actual deployed URL for your Coaching Log script.
         **************************************************************
         */
        const API_URL_COACHING = "https://script.google.com/macros/s/AKfycbyn9CG1Lk3S5bXtfEEbvH5H-8GfBBOvY4OGSJPyIM5RZSDBCOf4fwkXVvnKjzZGvqUL/exec"; 

        const coachingSessionsTable = document.getElementById('coachingSessionsTable');
        const coachingModalBg = document.getElementById('coachingModalBg');
        const coachingForm = document.getElementById('coachingForm');
        const coachingLoadingSpinner = document.getElementById('coachingLoadingSpinner');
        const coachingLoadingText = document.getElementById('coachingLoadingText');
        const coachingModalTitle = document.getElementById('coachingModalTitle');
        const coachingFormSubmitText = document.getElementById('coachingFormSubmitText');

        function showCoachingLoading(text = "Loading...") {
            coachingModalBg.classList.add('hidden'); 
            coachingLoadingSpinner.classList.remove('hidden');
            coachingLoadingText.textContent = text;
        }

        function hideCoachingLoading() {
            coachingLoadingSpinner.classList.add('hidden');
        }

        function openCoachingModal(isEdit = false, session = {}) {
            coachingForm.reset();
            if (isEdit) {
                coachingModalTitle.textContent = "Edit Coaching Session";
                coachingFormSubmitText.textContent = "Update";
                // Populate form fields for editing
                for (const key in session) {
                    const input = coachingForm.querySelector(`[name="${key.toLowerCase().replace(/ /g, '')}"]`);
                    if (input) {
                        input.value = session[key];
                    }
                }
            } else {
                coachingModalTitle.textContent = "Add Coaching Session";
                coachingFormSubmitText.textContent = "Save";
            }
            coachingModalBg.classList.remove('hidden');
        }

        function closeCoachingModal() {
            coachingModalBg.classList.add('hidden');
        }

        coachingForm.addEventListener('submit', handleCoachingSubmit);

        async function handleCoachingSubmit(e) {
            e.preventDefault();
            
            if (API_URL_COACHING === "https://script.google.com/macros/s/AKfycbyn9CG1Lk3S5bXtfEEbvH5H-8GfBBOvY4OGSJPyIM5RZSDBCOf4fwkXVvnKjzZGvqUL/exec") {
                alert("ERROR: Please update the 'API_URL_COACHING' constant in the script to your actual Google Apps Script Web App URL.");
                return;
            }

            const formData = new FormData(coachingForm);
            const data = Object.fromEntries(formData.entries());
            data.action = data.id ? "update" : "create";

            closeCoachingModal();
            showCoachingLoading(data.id ? "Updating session..." : "Adding new session...");

            try {
                const response = await fetch(API_URL_COACHING, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert(`Session ${data.id ? 'updated' : 'created'} successfully!`);
                    loadSessions(); 
                } else {
                    alert(`Error: ${result.message}`);
                    hideCoachingLoading();
                }
            } catch (error) {
                alert("Network or API call failed. Check console for details.");
                console.error("Coaching API Error:", error);
                hideCoachingLoading();
            }
        }


        async function loadSessions() {
            if (API_URL_COACHING === "https://script.google.com/macros/s/AKfycbyn9CG1Lk3S5bXtfEEbvH5H-8GfBBOvY4OGSJPyIM5RZSDBCOf4fwkXVvnKjzZGvqUL/exec") {
                coachingSessionsTable.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-red-500 font-semibold">ERROR: Please set 'API_URL_COACHING' to your Google Apps Script URL.</td></tr>`;
                coachingDataLoaded = false;
                return;
            }

            showCoachingLoading("Fetching sessions...");

            try {
                const response = await fetch(`${API_URL_COACHING}?action=read`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    renderSessions(result.data);
                    coachingDataLoaded = true;
                } else {
                    coachingSessionsTable.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-red-500">Error loading data: ${result.message || 'Unknown error'}</td></tr>`;
                    coachingDataLoaded = false;
                }
            } catch (error) {
                coachingSessionsTable.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-red-500">Failed to connect to API. Check URL and CORS settings.</td></tr>`;
                coachingDataLoaded = false;
                console.error("Fetch Error:", error);
            } finally {
                hideCoachingLoading();
            }
        }

        function renderSessions(sessions) {
            if (sessions.length === 0) {
                coachingSessionsTable.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-gray-500">No coaching sessions found.</td></tr>`;
                return;
            }
            
            coachingSessionsTable.innerHTML = sessions.map(session => {
                const acknowledgeClass = session.Acknowledge === 'Yes' ? 'bg-green-100 text-green-800' : 
                                         session.Acknowledge === 'No' ? 'bg-red-100 text-red-800' : 
                                         'bg-yellow-100 text-yellow-800';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3">${session.Date}</td>
                        <td class="px-4 py-3">${session.Coach}</td>
                        <td class="px-4 py-3">${session.Employee}</td>
                        <td class="px-4 py-3">${session['Employee Number']}</td>
                        <td class="px-4 py-3">${session['Performance/Behavior Observed'].substring(0, 50)}...</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${acknowledgeClass}">${session.Acknowledge}</span>
                        </td>
                        <td class="px-4 py-3 text-center space-x-2">
                            <button onclick='openCoachingModal(true, ${JSON.stringify(session)})' class="text-green-500 hover:underline">Edit</button>
                            <button onclick="deleteSession('${session.id}')" class="text-red-500 hover:underline">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function deleteSession(id) {
            if (!confirm(`Are you sure you want to delete session ID: ${id}?`)) return;

            showCoachingLoading("Deleting session...");

            try {
                const response = await fetch(API_URL_COACHING, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'delete', id: id }),
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert('Session deleted successfully!');
                    loadSessions(); 
                } else {
                    alert(`Error: ${result.message}`);
                    hideCoachingLoading();
                }
            } catch (error) {
                alert("Network or API call failed.");
                console.error("Coaching API Delete Error:", error);
                hideCoachingLoading();
            }
        }

    </script>
</body>

</html>