<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KPI Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            // Dark Mode configuration applied only to elements with 'dark:' prefix
            darkMode: 'class',
            theme: {
                extend: {
                    // Use Roboto as the primary font
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                    },
                    colors: {
                        // Google-inspired colors
                        'google-blue': '#4285F4',
                        'google-green': '#34A853',
                        'google-red': '#EA4335',
                        'google-yellow': '#FBBC05',
                        // Coaching Log/IR NTE colors
                        'brand-accent': '#CBEB33',
                        'brand-dark': '#B5D12F',
                        // Custom dark mode palette for isolated dark elements
                        'bg-dark': '#0f172a', // Main dark background
                        'text-dark': '#f1f5f9', // Light text on dark backgrounds
                        'card-dark': '#1e293b', // Card/Header dark background
                        'border-dark': '#334155', // Dark border/secondary background
                        'danger': '#ef4444',
                        'danger-dark': '#dc2626',
                        'bg-light': '#f8fafc', // IR Log standard light background
                        'text-light': '#1e293b', // IR Log standard dark text
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for Drawer and active tab indicator (KPI Dashboard) */
        .drawer {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-100%);
        }

        .drawer-open {
            transform: translateX(0);
        }

        .tab-active {
            background-color: theme('colors.blue.50');
            color: theme('colors.google-blue');
            font-weight: 500;
            border-radius: 9999px;
        }

        .tab-active .material-symbols-outlined {
            color: theme('colors.google-blue');
        }

        /* Hover state for nav items: consistent lift, bg, and subtle shadow (light + dark) */
        .nav-item {
            transition: transform 0.14s ease, background-color 0.14s ease, box-shadow 0.14s ease, color 0.14s ease;
            border-radius: 0.75rem;
        }
        .nav-item:hover, button.nav-item:hover, .nav-item.group:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 22px rgba(16,24,40,0.06) !important;
            background-color: #d1e067 !important; /* brand accent */
            color: #000000 !important;
        }
        /* Dark mode hover variant */
        .dark .nav-item:hover, .dark button.nav-item:hover, .dark .nav-item.group:hover {
            transform: translateY(-2px) scale(1.01) !important;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5) !important;
            background-color: #d1e067 !important; /* brand accent */
            color: #000000 !important;
        }

        /* Icon transitions inside nav items */
        .nav-item .material-symbols-outlined, .nav-item .fa {
            transition: color 0.14s ease, transform 0.14s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .nav-item:hover .material-symbols-outlined, .nav-item:hover .fa {
            transform: translateY(-2px);
            /* inherit color from the nav item for a consistent look */
            color: inherit !important;
        }

        /* Helpful utility icon colors (use by adding class to the icon span) */
        .icon-blue { color: #2563EB !important; }
        .icon-blue-400 { color: #60A5FA !important; }
        .icon-green { color: #10B981 !important; }
        .icon-yellow { color: #fa1515 !important; }
        .icon-red { color: #EF4444 !important; }
        .icon-purple { color: #8E7CC3 !important; }
        .icon-teal { color: #06B6D4 !important; }

        /* On hover, gently brighten colored icons */
        .nav-item:hover .icon-blue { color: #1D4ED8 !important; }
        .nav-item:hover .icon-green { color: #059669 !important; }
        .nav-item:hover .icon-red { color: #DC2626 !important; }
        .nav-item:hover .icon-yellow { color: #c7010b !important; }
        .nav-item:hover .icon-purple { color: #7C3AED !important; }
        .nav-item:hover .icon-teal { color: #0891B2 !important; }

        /* Style for the main KPI cards */
        .kpi-card {
            transition: box-shadow 0.3s ease;
        }

        .kpi-card:hover {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Coaching Log/IR NTE loading animation */
        .animate-spin-slow {
            animation: spin 2.5s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Styles for Print View Modal (Coaching Log) */
        @media print {

            /* Hide all UI elements from the main dashboard when printing the Coaching Log modal */
            body>*:not(#modalBg):not(#deleteConfirmModal) {
                display: none !important;
            }

            /* Only show the view modal content */
            #modalBg {
                display: flex !important;
                position: static !important;
                background: none !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
                padding: 0 !important;
            }

            #modalContent {
                box-shadow: none !important;
                border: none !important;
                transform: none !important;
                opacity: 1 !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 3rem !important;
                min-height: 100vh;
            }

            /* Hide close and print buttons in print view */
            #modalContent button,
            #modalContent .modal-actions {
                display: none !important;
            }

            /* Ensure the content is black on white paper */
            #modalContent,
            #modalContent * {
                color: #000 !important;
                background-color: white !important;
                filter: none !important;
            }

            .view-field {
                border-bottom: 1px solid #ddd !important;
                padding-bottom: 0.5rem !important;
                margin-bottom: 1rem !important;
            }

            .view-title {
                font-weight: bold !important;
                color: #4b5563 !important;
                text-transform: uppercase;
                font-size: 0.875rem;
            }

            .view-value {
                font-size: 1rem !important;
                padding-top: 0.25rem !important;
            }
        }

        /* IR / NTE Log specific styles */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }
    </style>

    <!-- Hide scrollbar globally -->
<style>
  .custom-scrollbar-hide::-webkit-scrollbar {
    width: 0px;
    height: 0px;
  }
  .custom-scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>


    <!-- Tab Button Styles -->
    <style>
        .tab-button {
            background-color: #f3f4f6;
            color: #374151;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background-color: #e5e7eb;
        }

        .dark .tab-button {
            background-color: #1f2937;
            color: #e5e7eb;
        }

        .active-tab {
            background-color: #CBEB33 !important;
            color: #04101d !important;
            font-weight: 600;
        }

        .table-tab {
            display: none;
        }

        .active-tab-content {
            display: block;
        }
    </style>

    <!-- Loading spinner styles for tables (brand palette) -->
    <style>
        .table-spinner {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.85);
            z-index: 40;
            border-radius: 0.75rem; /* match container rounded */
        }

        .table-spinner.hidden { display: none; }

        .spinner-ring {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 6px solid rgba(0,0,0,0.08);
            border-top-color: #CBEB33; /* brand-accent */
            border-right-color: #B5D12F; /* brand-dark-ish */
            animation: spin 1s linear infinite;
            box-shadow: 0 4px 12px rgba(20,20,20,0.06);
        }

        .table-spinner .spinner-text {
            margin-top: 0.5rem;
            font-weight: 600;
            color: #374151; /* slate-700 */
        }

        .dark .table-spinner { background: rgba(15,23,42,0.85); }
        .dark .table-spinner .spinner-text { color: var(--tw-text-opacity, 1); }
    </style>

    <!-- Google-like compact table styling for SOP and Tools (invisible scrollbar) -->
    <style>
        /* Scroll container: vertical scrolling while allowing horizontal overflow */
        #sop .overflow-x-auto, #tools .overflow-x-auto {
            max-height: 52vh; /* dashboard-appropriate height */
            overflow-y: auto;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Invisible scrollbar: still scrollable but no visible track */
        #sop .overflow-x-auto::-webkit-scrollbar, #tools .overflow-x-auto::-webkit-scrollbar {
            width: 0px;
            height: 0px;
        }
        #sop .overflow-x-auto, #tools .overflow-x-auto {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge legacy */
        }

        /* Google DataTable-like visual: compact, clear typography */
        #sop table, #tools table {
            font-family: Roboto, system-ui, -apple-system, 'Segoe UI', 'Helvetica Neue', Arial;
            font-size: 0.9rem;
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }

        /* Header */
        #sop thead th, #tools thead th {
            padding: 10px 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #374151; /* slate-700 */
            text-transform: uppercase;
            letter-spacing: 0.02em;
            text-align: left;
            background: linear-gradient(180deg,#ffffff,#f8fafc);
            position: sticky;
            top: 0;
            z-index: 30;
            border-bottom: 1px solid rgba(16,24,40,0.06);
        }

        /* Body rows: allow wrapping and proper alignment */
        #sop tbody td, #tools tbody td {
            padding: 8px 12px;
            vertical-align: top; /* align multiline content at top for readability */
            color: #111827; /* slate-900 */
            white-space: normal; /* allow wrapping */
            word-wrap: break-word;
            word-break: break-word;
        }

        /* Preserve no-wrap for narrow columns (ID and link columns) */
        #sop tbody td:nth-child(1), #sop tbody td:nth-child(5),
        #tools tbody td:nth-child(1), #tools tbody td:nth-child(5), #tools tbody td:nth-child(6) {
            white-space: nowrap;
            overflow: visible;
        }

        /* Alternating row subtle lines to match Google Table */
        #sop tbody tr:nth-child(even), #tools tbody tr:nth-child(even) {
            background: rgba(15,23,42,0.02);
        }

        #sop tbody tr:hover, #tools tbody tr:hover {
            background: rgba(16,185,129,0.06); /* subtle green-ish hover for focus */
        }

        /* Let rows size naturally when content wraps */
        #sop tbody tr, #tools tbody tr { height: auto; }

        /* Dark mode: invert colors and keep visibility */
        .dark #sop thead th, .dark #tools thead th {
            background: linear-gradient(180deg,#0b1220,#0f172a);
            color: #cbd5e1;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .dark #sop tbody td, .dark #tools tbody td {
            color: #cbd5e1;
        }
        .dark #sop tbody tr:nth-child(even), .dark #tools tbody tr:nth-child(even) {
            background: rgba(255,255,255,0.01);
        }
        .dark #sop tbody tr:hover, .dark #tools tbody tr:hover {
            background: rgba(203,235,51,0.06);
        }

        /* Gentle card look around the table area */
        #sop .overflow-x-auto, #tools .overflow-x-auto {
            border-radius: 0 0 12px 12px;
        }

        /* Make spinner overlay not block scroll gestures but still visually on top */
        .table-spinner { pointer-events: none; }
    </style>


</head>

<body class="min-h-screen bg-gray-100 text-gray-800 font-sans transition-colors duration-500">

    <!-- Landing overlay shown before entering the dashboard -->
    <div id="landingOverlay" class="fixed inset-0 z-50 flex items-center justify-center bg-white dark:bg-card-dark transition-opacity" style="background: linear-gradient(135deg,#ffffff, #f3f7e6);">
        <div class="max-w-2xl mx-4 p-8 rounded-xl shadow-2xl bg-white dark:bg-card-dark border border-gray-100 dark:border-border-dark text-center">
            <img src="dmi_logo.png" alt="Logo" class="mx-auto h-12 mb-4" />
            <h1 class="text-2xl font-extrabold text-gray-900 dark:text-text-dark mb-2">Welcome to the KPI Dashboard</h1>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">This dashboard provides a unified view of campaign performance, KPIs, attendance, and operational tools. Click Enter to continue to the dashboard.</p>

                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-center gap-3">
                        <button id="enterDashboardBtn" class="inline-flex items-center justify-center px-6 py-3 rounded-full bg-brand-accent hover:bg-brand-dark text-black font-semibold shadow-md">Enter Dashboard</button>
                        <button id="viewDocsBtn" class="inline-flex items-center justify-center px-6 py-3 rounded-full bg-transparent border border-gray-200 dark:border-border-dark text-gray-700 dark:text-gray-300 hover:bg-[#e8f7b5] hover:text-black transition">View Quick Guide</button>
                    </div>

                    <p class="mt-4 text-xs text-gray-500 dark:text-gray-400">You can always access the dashboard later from the main menu.</p>
        </div>
    </div>

            <!-- Tour overlay (Joyride-like) -->
            <div id="quickGuideModal" class="hidden fixed inset-0 z-60">
                <div id="tourBackdrop" class="absolute inset-0 bg-black bg-opacity-50"></div>
                <div id="tourPopup" class="absolute z-70 max-w-xs w-[320px] bg-white dark:bg-card-dark rounded-lg p-4 border border-gray-100 dark:border-border-dark shadow-lg">
                    <div class="flex items-start justify-between">
                        <h3 id="tourTitle" class="text-lg font-bold text-gray-900 dark:text-text-dark"></h3>
                        <button id="endTourBtn" class="text-sm text-gray-500 hover:text-gray-700 dark:text-gray-300">End</button>
                    </div>
                    <div id="tourContent" class="mt-2 text-sm text-gray-700 dark:text-gray-300"></div>
                    <div class="mt-4 flex items-center justify-between">
                        <div class="text-xs text-gray-500 dark:text-gray-400" id="tourCounter"></div>
                        <div class="flex gap-2">
                            <button id="prevStepBtn" class="px-3 py-1 rounded bg-gray-100 dark:bg-border-dark text-gray-700 dark:text-gray-200">Prev</button>
                            <button id="nextStepBtn" class="px-3 py-1 rounded bg-brand-accent hover:bg-brand-dark text-black font-semibold">Next</button>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                /* Tour highlight ring (subtle, stays behind the popup) */
                .tour-highlight {
                    position: relative;
                    box-shadow: 0 0 0 3px rgba(16,24,40,0.06), 0 6px 18px rgba(2,6,23,0.08);
                    border-radius: 8px;
                    z-index: 100000 !important; /* behind popup */
                }

                /* Neutral popup styling */
                #tourPopup {
                    z-index: 100020 !important;
                    background: #ffffff;
                    color: #111827;
                    border: 1px solid rgba(15,23,42,0.06);
                    box-shadow: 0 8px 30px rgba(2,6,23,0.08);
                    max-width: 360px;
                    padding: 14px;
                }
                .dark #tourPopup { background: #0f172a; color: #e6eef7; border-color: rgba(255,255,255,0.04); }

                /* Backdrop: keep neutral and slightly dim to avoid overpowering content */
                #tourBackdrop { z-index: 100010 !important; position: absolute; inset: 0; background: rgba(0,0,0,0.28); }
                #quickGuideModal { z-index: 100000 !important; }

                /* Arrow (pointer) variants, controlled by data-placement on #tourPopup */
                #tourPopup::after { display: none; content: '';} /* default none */
                #tourPopup[data-placement='right']::after {
                    display: block;
                    position: absolute;
                    left: -6px;
                    top: 50%;
                    transform: translateY(-50%) rotate(45deg);
                    width: 12px; height: 12px; background: inherit; border-left: 1px solid rgba(0,0,0,0.04);
                }
                #tourPopup[data-placement='left']::after {
                    display: block;
                    position: absolute;
                    right: -6px;
                    top: 50%;
                    transform: translateY(-50%) rotate(45deg);
                    width: 12px; height: 12px; background: inherit; border-right: 1px solid rgba(0,0,0,0.04);
                }
                #tourPopup[data-placement='top']::after {
                    display: block;
                    position: absolute;
                    bottom: -6px;
                    left: 50%;
                    transform: translateX(-50%) rotate(45deg);
                    width: 12px; height: 12px; background: inherit; border-bottom: 1px solid rgba(0,0,0,0.04);
                }
                #tourPopup[data-placement='center']::after { display: none; }
                /* Centered popup which points to the left (useful for drawer navigation) */
                #tourPopup[data-placement='center-left']::after {
                    display: block;
                    position: absolute;
                    right: 100%; /* place arrow to the left of popup */
                    left: -6px; /* fallback */
                    top: var(--arrow-top, 50%);
                    transform: translateY(-50%) rotate(45deg);
                    width: 12px; height: 12px; background: inherit; border-left: 1px solid rgba(0,0,0,0.04);
                }
            </style>


<aside id="drawer"
  class="drawer fixed top-0 left-0 h-full w-64 bg-white shadow-2xl z-50 dark:bg-card-dark dark:text-text-dark">
  <!-- Header -->
<div class="flex items-center justify-between p-4 pt-5 border-b sticky top-0 bg-white dark:bg-card-dark dark:border-border-dark z-10">
  <!-- Logo -->
  <img src="dmi_logo.png" alt="Digital Minds BPO Logo"
    class="h-10 object-contain" />

  <!-- Close button -->
  <button id="closeDrawer"
    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-text-dark p-2 rounded-full hover:bg-gray-100 dark:hover:bg-border-dark transition-all duration-300">
    <span class="material-symbols-outlined text-2xl">close</span>
  </button>
</div>


  <!-- Navigation -->
  <nav class="p-3 text-sm font-normal text-gray-700 dark:text-gray-300">
    <ul class="space-y-1">
      <!-- Reusable nav item -->
      <li>
        <button
          class="nav-item group flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                 hover:bg-[#e3f37b] hover:text-black dark:hover:bg-border-dark dark:hover:text-[#CBEB33]"
          data-tab-title="Summary" onclick="showTab('summary', event)">
          <span class="material-symbols-outlined text-xl transition-colors duration-300 icon-blue">dashboard</span>
          <span class="transition-colors duration-300">Dashboard</span>
        </button>
      </li>

      <li>
        <button
          class="nav-item group flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                 hover:bg-[#e3f37b] hover:text-black dark:hover:bg-border-dark dark:hover:text-[#CBEB33]"
          data-tab-title="KPI Dashboard" onclick="showTab('kpi-dashboard', event)">
          <span class="material-symbols-outlined text-xl icon-purple">insights</span>
          <span>KPI</span>
        </button>
      </li>


  <!-- SOP Navigation -->
  <li>
    <button
      class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
             hover:text-google-green dark:hover:bg-border-dark"
      data-tab-title="SOP Documents" onclick="showTab('sop', event)">
    <span class="material-symbols-outlined text-xl text-google-green icon-green">description</span>
      <span>SOP Documents</span>
    </button>
  </li>

  <!-- Tools Navigation -->
  <li>
    <button
      class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
             hover:text-google-green dark:hover:bg-border-dark"
      data-tab-title="Campaign Tools" onclick="showTab('tools', event)">
    <span class="material-symbols-outlined text-xl text-google-green icon-green">build</span>
      <span>Campaign Tools</span>
    </button>
  </li>

    <!-- Attendance Navigation -->
    <li>
        <button
            class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                         hover:text-google-blue dark:hover:bg-border-dark"
            data-tab-title="Attendance" onclick="showTab('attendance', event)">
            <span class="material-symbols-outlined text-xl text-google-blue icon-blue">calendar_month</span>
            <span>Attendance</span>
        </button>
    </li>



      <li>
        <button
          class="nav-item group flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                 hover:bg-[#e3f37b] hover:text-black dark:hover:bg-border-dark dark:hover:text-[#CBEB33]"
          data-tab-title="Coaching Sessions" onclick="showTab('coaching-log', event)">
          <span class="material-symbols-outlined text-xl icon-teal">person_pin_circle</span>
          <span>Coaching Log</span>
        </button>
      </li>

      <li>
        <button
          class="nav-item group flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                 hover:bg-[#e3f37b] hover:text-black dark:hover:bg-border-dark dark:hover:text-[#CBEB33]"
          data-tab-title="IR / NTE Log" onclick="showTab('ir-nte-log', event)">
          <span class="material-symbols-outlined text-xl icon-yellow">gavel</span>
          <span>IR / NTE Log</span>
        </button>
      </li>

      <li>
        <button
          class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                 hover:text-google-green dark:hover:bg-border-dark"
          data-tab-title="Top Gainers Report" onclick="showTab('gainers', event)">
          <span class="material-symbols-outlined text-xl text-google-green icon-green">trending_up</span>
          <span>Performers</span>
        </button>
      </li>

      <li>
        <button
          class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                 hover:text-google-red dark:hover:bg-border-dark"
          data-tab-title="Underperformers Report" onclick="showTab('losers', event)">
          <span class="material-symbols-outlined text-xl text-google-red icon-red">trending_down</span>
          <span>Underperformers</span>
        </button>
      </li>

      <li>
  <button
    class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
           hover:text-google-blue dark:hover:bg-border-dark"
    data-tab-title="Quick Links" onclick="showTab('quicklinks', event)">
    <span class="material-symbols-outlined text-xl text-google-blue icon-blue">link</span>
    <span>Quick Links</span>
  </button>
</li>

            <li>
                <button
                    class="nav-item flex items-center gap-3 p-3 w-full text-left rounded-md transition-all duration-300 ease-out transform-gpu hover:scale-[1.02]
                                 hover:text-google-blue dark:hover:bg-border-dark"
                    data-tab-title="Billing" onclick="showTab('billing', event)">
                    <span class="material-symbols-outlined text-xl icon-yellow">receipt_long</span>
                    <span>Billing</span>
                </button>
            </li>



    </ul>
  </nav>
</aside>


    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-40 transition-opacity duration-300"></div>

    <div id="page-content">
        <header
            class="flex items-center gap-4 bg-white dark:bg-card-dark p-4 shadow-md sticky top-0 z-30 transition-colors duration-500 border-b border-gray-100 dark:border-border-dark">
            <button id="menuBtn"
                class="text-gray-600 dark:text-gray-300 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-border-dark transition">
                <span class="material-symbols-outlined text-2xl">menu</span>
            </button>
            <h1 id="mainTitleContainer" class="text-2xl font-extrabold text-gray-900 dark:text-text-dark">
            </h1>
            <button id="themeToggle"
                class="ml-auto p-2 rounded-full text-gray-800 dark:text-text-dark bg-gray-100 dark:bg-border-dark hover:bg-brand-accent hover:text-bg-dark transition-all duration-300 transform hover:scale-105"
                aria-label="Toggle Dark Mode">
            </button>
        </header>

        <main class="max-w-7xl mx-auto p-6 lg:p-10 space-y-12"></main>


    <script>
        feather.replace(); // Initialize feather icons for dark mode toggle

        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('overlay');
        const menuBtn = document.getElementById('menuBtn');
        const closeDrawer = document.getElementById('closeDrawer');

        // Global Elements
        const toggleBtn = document.getElementById('themeToggle');
        const body = document.body;
        const mainTitleContainer = document.getElementById('mainTitleContainer');
        const loadingModal = document.getElementById('loadingModal');
        const loadingText = document.getElementById('loadingText');



        /* ------------------ GLOBAL UTILITY FUNCTIONS ------------------ */

        function showGlobalLoading(message = "Loading...") {
            loadingText.innerText = message;
            loadingModal.classList.remove('hidden');
        }
        function hideGlobalLoading() {
            loadingModal.classList.add('hidden');
        }

        function showLocalIRNteLoading(text) {
            irNteLoadingText.textContent = text || "Processing...";
            irNteLoadingSpinner.classList.remove('hidden');
        }

        function hideLocalIRNteLoading() {
            irNteLoadingSpinner.classList.add('hidden');
        }

        /* ------------------ DARK MODE TOGGLE (Fixed for isolated scope) ------------------ */

        function setTheme(isDark) {
            if (isDark) {
                body.classList.add("dark");
                localStorage.setItem("theme", "dark");
                toggleBtn.innerHTML = feather.icons.sun.toSvg();
            } else {
                body.classList.remove("dark");
                localStorage.setItem("theme", "light");
                toggleBtn.innerHTML = feather.icons.moon.toSvg();
            }
        }

        // Set initial theme on load
        if (localStorage.getItem("theme") === "dark" || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            setTheme(true);
        } else {
            setTheme(false);
        }

        toggleBtn.addEventListener('click', () => {
            const isDark = body.classList.contains('dark');
            setTheme(!isDark);
        });

        /* ------------------ DRAWER & NAVIGATION FUNCTIONS (KPI Dashboard) ------------------ */

        function toggleDrawer(open) {
            if (open) {
                drawer.classList.add('drawer-open');
                overlay.classList.remove('hidden');
                document.body.classList.add('overflow-hidden');
            } else {
                drawer.classList.remove('drawer-open');
                overlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }
        }

        menuBtn.addEventListener('click', () => toggleDrawer(true));
        closeDrawer.addEventListener('click', () => toggleDrawer(false));
        overlay.addEventListener('click', () => toggleDrawer(false));

        function showTab(tabId, event) {
            try { console.debug('showTab called for:', tabId); } catch(e){}
            toggleDrawer(false);

            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            const tabEl = document.getElementById(tabId);
            if (!tabEl) {
                console.warn('showTab: target element not found for id=', tabId, ' - falling back to summary');
                const fallback = document.getElementById('summary');
                if (fallback) fallback.classList.remove('hidden');
            } else {
                tabEl.classList.remove('hidden');
            }

            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('tab-active');
            });

            let targetButton;
            if (event && event.currentTarget) {
                targetButton = event.currentTarget;
            } else {
                targetButton = document.querySelector(`#drawer button[onclick*="${tabId}"]`);
            }

            if (targetButton) {
                targetButton.classList.add('tab-active');

                // Dynamic Header Update
                const titleText = targetButton.dataset.tabTitle || 'KPI Dashboard';
                // Applying the requested dynamic style to the main header
                mainTitleContainer.innerHTML = `<span class="text-brand-accent">Digital</span> ${titleText}`;
            }





        /* ------------------ INIT ------------------ */
        document.addEventListener('DOMContentLoaded', () => {
            // Show the initial tab (Summary) and set the initial header title
            showTab('summary');
        });

        // runAll: helper to ensure key UI sections and data are initialized (debug helper)
        function runAll() {
            try {
                // hide landing overlay if visible
                const landing = document.getElementById('landingOverlay');
                if (landing && !landing.classList.contains('hidden')) {
                    landing.classList.add('hidden');
                }
            } catch(e){}

            try { if (typeof toggleDrawer === 'function') toggleDrawer(false); } catch(e){}

            // show KPI dashboard tab
            try { showTab('kpi-dashboard'); } catch(e) { console.warn('runAll: showTab kpi-dashboard failed', e); }

            // ensure billing chart (if present) is initialized
            try { if (typeof initBillingChart === 'function') initBillingChart(); } catch(e) { console.warn('runAll: initBillingChart failed', e); }

            // attempt to load key datasets if functions exist
            try { if (typeof loadAll === 'function') loadAll(); } catch(e) {}
            try { if (typeof loadSOP === 'function') loadSOP(); } catch(e) {}
            try { if (typeof loadTools === 'function') loadTools(); } catch(e) {}
            try { if (typeof loadSessions === 'function') loadSessions(); } catch(e) {}
            try { if (typeof loadRecords === 'function') loadRecords(); } catch(e) {}

            console.info('runAll: executed (KPI/Billing init attempted)');
        }

        // Expose helper to console for debugging
        window.runAll = runAll;

        /* ------------------ ATTENDANCE (backend logic extracted from attnew.html) ------------------ */
        (function(){
            const BASE_URL = "https://script.google.com/macros/s/AKfycbxrwq6w72om22yz5zkHyDO-fhPxqlPBzlUsIjExrI3ZOB1J__Um1NlRJbih-_wFwihAhg/exec";

            const statusColors = {
                P: "bg-[#38761D]", A: "bg-[#EF4444]", Off: "bg-[#9CA3AF]",
                L: "bg-[#F59E0B]", VL: "bg-[#0000FF]", T: "bg-[#8E7CC3]",
                SUS: "bg-[#00FFFF]", HD: "bg-[#00FF00]", L15: "bg-[#FACC15]",
                L30: "bg-[#FB923C]", L45: "bg-[#F97316]", L60: "bg-[#EA580C]",
                SL: "bg-[#6FA8DC]", NA: ""
            };

            // spinner helpers (ref-counted so nested fetches don't flicker)
            let _loadingCount = 0;
            function showLoading(text) {
                _loadingCount++;
                // global overlay spinner
                const spinner = document.getElementById('loading-spinner');
                if (spinner) {
                    const txt = spinner.querySelector('.text-sm');
                    if (txt && text) txt.textContent = text;
                    spinner.style.display = 'flex';
                }
                // local attendance card spinner (table-spinner)
                const attSpinner = document.getElementById('attendanceLoadingSpinner');
                if (attSpinner) {
                    const txt = attSpinner.querySelector('.spinner-text');
                    if (txt && text) txt.textContent = text;
                    attSpinner.classList.remove('hidden');
                }
            }

            function hideLoading() {
                _loadingCount = Math.max(0, _loadingCount - 1);
                if (_loadingCount > 0) return;
                const spinner = document.getElementById('loading-spinner');
                if (spinner) spinner.style.display = 'none';
                const attSpinner = document.getElementById('attendanceLoadingSpinner');
                if (attSpinner) attSpinner.classList.add('hidden');
            }

            async function loadClusters(){
                showLoading('Loading teams...');
                try{
                    const res = await fetch(BASE_URL + "?api=clusters");
                    const clusters = await res.json();
                    const select = document.getElementById("rosterSelector");
                    if (!select) return;
                    select.innerHTML = `<option value="">All Teams</option>`;
                    clusters.forEach(c => {
                        const opt = document.createElement("option"); opt.value = c; opt.textContent = c; select.appendChild(opt);
                    });
                }catch(err){ console.error('Failed to load clusters', err); }
                finally{ hideLoading(); }
            }

            async function loadAll(){
                showLoading('Loading attendance data…');

                const monthVal = document.getElementById('monthSelector') ? document.getElementById('monthSelector').value : '';
                const clusterVal = document.getElementById('rosterSelector') ? document.getElementById('rosterSelector').value : '';

                try{
                    const params = new URLSearchParams({ api:'summary', month:monthVal, cluster:clusterVal });
                    const summary = await (await fetch(BASE_URL + '?' + params.toString())).json();

                    renderKPIs(summary);
                    renderCampaignSummary(summary);

                    const calParams = new URLSearchParams({ api:'calendars', month:monthVal, cluster:clusterVal });
                    const calData = await (await fetch(BASE_URL + '?' + calParams.toString())).json();
                    renderCalendars(calData);
                }catch(err){ console.error('Attendance loadAll error', err); }
                finally{ hideLoading(); }
            }

            function renderKPIs(summary){
                const present = summary.overall.P || 0;
                const absent = summary.overall.A || 0;
                const halfDay = summary.overall.HD || 0;
                const late = (summary.overall.L || 0) + (summary.overall.L15 || 0) + (summary.overall.L30 || 0) + (summary.overall.L45 || 0) + (summary.overall.L60 || 0);
                const vacation = summary.overall.VL || 0;
                const total = present + absent + halfDay + late + vacation;
                const kpiPresent = document.getElementById('kpi-present'); if (kpiPresent) kpiPresent.textContent = present;
                const kpiAbsent = document.getElementById('kpi-absent'); if (kpiAbsent) kpiAbsent.textContent = absent;
                const kpiTardy = document.getElementById('kpi-tardy'); if (kpiTardy) kpiTardy.textContent = late;
                const kpiLeave = document.getElementById('kpi-leave'); if (kpiLeave) kpiLeave.textContent = vacation;
                const kpiScore = document.getElementById('kpi-score'); if (kpiScore) kpiScore.textContent = (total > 0 ? ((present/total)*100).toFixed(1) : 0) + '%';
            }

                        function renderCampaignSummary(summary){
                                const tbody = document.getElementById('campaign-summary-body'); if (!tbody) return; tbody.innerHTML = '';
                                const campaigns = summary.campaigns || {};

                                // Build array with numeric scores for sorting
                                const rows = Object.entries(campaigns).map(([campaign, stats]) => {
                                        const total = (stats.P||0)+(stats.A||0)+(stats.HD||0)+(stats.L||0)+(stats.L15||0)+(stats.L30||0)+(stats.L45||0)+(stats.L60||0);
                                        const scoreNum = total>0 ? (stats.P/total)*100 : 0;
                                        return { campaign, stats, scoreNum };
                                });

                                // sort lowest to highest
                                rows.sort((a,b) => a.scoreNum - b.scoreNum);

                                rows.forEach(({campaign, stats, scoreNum}) => {
                                        const score = scoreNum.toFixed(1) + '%';
                                        // color score red if below 95%
                                        const scoreClass = scoreNum < 95 ? 'text-red-600 dark:text-red-400 font-bold' : 'text-gray-900 dark:text-text-dark font-bold';

                                        const row = `
                                            <tr>
                                                <td class="px-4 py-2 font-medium text-gray-800 dark:text-text-dark">${campaign}</td>
                                                <td class="px-4 py-2 text-center text-green-600 dark:text-green-400">${stats.P||0}</td>
                                                <td class="px-4 py-2 text-center text-yellow-600 dark:text-yellow-400">${(stats.L||0)+(stats.L15||0)+(stats.L30||0)+(stats.L45||0)+(stats.L60||0)}</td>
                                                <td class="px-4 py-2 text-center text-blue-600 dark:text-blue-400">${stats.HD||0}</td>
                                                <td class="px-4 py-2 text-center text-red-600 dark:text-red-400">${stats.A||0}</td>
                                                <td class="px-4 py-2 text-center ${scoreClass}">${score}</td>
                                            </tr>`;
                                        tbody.insertAdjacentHTML('beforeend', row);
                                });
                        }

            function renderCalendars(data){
                const feed = document.getElementById('campaign-feed'); if (!feed) return; feed.innerHTML = '';

                Object.entries(data).forEach(([campaign, employees]) => {
                    // determine how many day columns are needed (max length among employees)
                    const lengths = Object.values(employees || {}).map(arr => Array.isArray(arr) ? arr.length : 0);
                    const maxDays = lengths.length ? Math.max(...lengths) : 0;
                    // clamp between 1 and 31
                    const daysCount = Math.min(Math.max(maxDays, 1), 31);

                    let table = `
                        <div class="bg-white dark:bg-card-dark border border-gray-100 dark:border-border-dark rounded-2xl shadow-sm overflow-x-auto">
                            <div class="p-4 border-b border-gray-100 dark:border-border-dark flex justify-between items-center">
                                <h3 class="text-xl font-semibold text-gray-700 mb-4">${campaign}</h3>
                            </div>
                            <table class="table-fixed border-collapse w-auto text-xs">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="border px-2 py-1 text-left w-40">Employee</th>`;
                    for (let d = 1; d <= daysCount; d++) table += `<th class='border px-1 py-1 w-6 text-center'>${d}</th>`;
                    table += `</tr></thead><tbody>`;

                    Object.entries(employees).forEach(([name, statuses]) => {
                        table += `<tr><td class="border px-2 py-1 font-medium text-gray-700">${name}</td>`;
                        for (let i = 0; i < daysCount; i++){
                            const s = (Array.isArray(statuses) && typeof statuses[i] !== 'undefined') ? statuses[i] : null;
                            if (s === null || s === '') {
                                // no data for this day: render empty bordered square (blank)
                                table += `<td class="border w-6 h-6"></td>`;
                            } else if (s === 'NA') {
                                // explicit NA: repeating-gradient pattern
                                table += `<td class="border w-6 h-6" style="background:repeating-linear-gradient(45deg,#E5E7EB 0px,#E5E7EB 2px,#D1D5DB 2px,#D1D5DB 4px);"></td>`;
                            } else {
                                const c = statusColors[s] || '';
                                table += `<td class="border w-6 h-6 ${c}" title="${s}"></td>`;
                            }
                        }
                        table += `</tr>`;
                    });
                    table += `</tbody></table></div>`;
                    feed.insertAdjacentHTML('beforeend', table);
                });
            }

            // default filter
            function setDefaultFilters(){
                const now = new Date();
                const month = now.getMonth() + 1;
                const monthSelector = document.getElementById('monthSelector'); if (monthSelector) monthSelector.value = month;
                const rosterSelector = document.getElementById('rosterSelector'); if (rosterSelector) rosterSelector.value = 'Admin';
            }

            // bind controls
            const refreshBtn = document.getElementById('refreshBtn'); if (refreshBtn) refreshBtn.addEventListener('click', loadAll);
            const monthSel = document.getElementById('monthSelector'); if (monthSel) monthSel.addEventListener('change', loadAll);
            const rosterSel = document.getElementById('rosterSelector'); if (rosterSel) rosterSel.addEventListener('change', loadAll);

            // initialization
            window.addEventListener('DOMContentLoaded', async function(){
                await loadClusters();
                setDefaultFilters();
                loadAll();
            });
        })();
    </script>
</body>

</html>