<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Employee Attendance â€“ September</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-center text-xl font-bold text-gray-800 mb-6">ðŸ“… Employee Attendance â€“ September</h2>

    <!-- Legend -->
    <div class="flex justify-center gap-6 mb-6 flex-wrap text-sm">
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#38761D]"></span>Present</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#00FF00]"></span>Half Day</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#F59E0B]"></span>Late</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#6FA8DC]"></span>Sick Leave</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#8E7CC3]"></span>Terminated</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#0000FF]"></span>Vacation Leave</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#00FFFF]"></span>Suspended</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#9CA3AF]"></span>Day Off</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#EF4444]"></span>Absent</div>
      <div class="flex items-center gap-2"><span style="display:inline-block;width:16px;height:16px;background:repeating-linear-gradient(45deg,#E5E7EB 0px,#E5E7EB 2px,#D1D5DB 2px,#D1D5DB 4px);border-radius:4px;"></span>Not Marked</div>
      <div class="flex items-center gap-2"><span class="w-4 h-4 rounded bg-[#14B8A6]"></span>Holiday</div>
    </div>

    <!-- Campaign Calendars -->
    <div id="campaign-calendars" class="space-y-12"></div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwuhbrM5WhurujJJtZMZTZ6YJJnrfc8xP54qhtvoHAu-vWzY75BwCW94fr5b27z970/exec";

    const statusColors = {
      P: "bg-[#38761D]",    // Present
      HD: "bg-[#00FF00]",   // Half Day
      L: "bg-[#F59E0B]",    // Late
      SL: "bg-[#6FA8DC]",   // Sick Leave
      T: "bg-[#8E7CC3]",    // Terminated
      VL: "bg-[#0000FF]",   // Vacation Leave
      SUS: "bg-[#00FFFF]",  // Suspended
      Off: "bg-[#9CA3AF]",  // Day Off
      A: "bg-[#EF4444]",    // Absent
      H: "bg-[#14B8A6]",    // Holiday
      NA: ""                // Not Marked handled inline
    };

    async function loadAttendance() {
      try {
        const res = await fetch(API_URL);
        const rawData = await res.json();
        console.log("Fetched data:", rawData);

        if (!Array.isArray(rawData) || rawData.length === 0) {
          document.getElementById("campaign-calendars").innerHTML =
            "<p class='text-red-600'>No data found. Check your Google Sheet.</p>";
          return;
        }

        // Group data: campaign â†’ employee â†’ days
        const campaigns = {};
        rawData.forEach(row => {
          const { date, name, campaign, status } = row;
          const day = new Date(date).getDate();

          if (!campaigns[campaign]) campaigns[campaign] = {};
          if (!campaigns[campaign][name]) campaigns[campaign][name] = Array(30).fill("NA");

          if (day >= 1 && day <= 30) campaigns[campaign][name][day - 1] = status || "NA";
        });

        const container = document.getElementById("campaign-calendars");
        container.innerHTML = "";

        Object.entries(campaigns).forEach(([campaign, employees]) => {
          const section = document.createElement("div");
          section.innerHTML = `
            <h3 class="text-xl font-semibold text-gray-700 mb-4">${campaign}</h3>
            <div class="overflow-x-auto border rounded-lg shadow bg-white">
              <table class="table-fixed border-collapse w-full text-xs">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="border px-2 py-1 text-left w-40">Employee</th>
                    ${[...Array(30).keys()].map(d => `<th class='border px-1 py-1 w-6 text-center'>${d+1}</th>`).join('')}
                  </tr>
                </thead>
                <tbody>
                  ${Object.entries(employees).map(([name, days]) => `
                    <tr>
                      <td class="border px-2 py-1 font-medium text-gray-700">${name}</td>
                      ${days.map(status => {
                        if (status === "NA") {
                          return `<td class="border w-6 h-6" style="background:repeating-linear-gradient(45deg,#E5E7EB 0px,#E5E7EB 2px,#D1D5DB 2px,#D1D5DB 4px);"></td>`;
                        }
                        return `<td class="border w-6 h-6 ${statusColors[status] || ""}" title="${status}"></td>`;
                      }).join('')}
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
          container.appendChild(section);
        });

      } catch (err) {
        console.error("Fetch error:", err);
        document.getElementById("campaign-calendars").innerHTML =
          "<p class='text-red-600'>Error loading data. See console.</p>";
      }
    }

    loadAttendance();
  </script>
</body>
</html>
