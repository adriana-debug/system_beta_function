<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <style>
    :root {
      --primary: #0f172a;
      --sidebar-width: 280px;
    }
    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      background-color: #f1f5f9; 
      color: #1e293b; 
    }
    
    /* Modern Navigation Styling */
    .nav-item {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    .nav-active { 
      background: #f8fafc; 
      color: #0f172a; 
      font-weight: 600;
      box-shadow: inset 4px 0 0 0 #0f172a;
    }
    .nav-active i { color: #0f172a; }
    
    /* Layout Components */
    .glass-card { 
      background: rgba(255, 255, 255, 0.9); 
      backdrop-filter: blur(8px);
      border: 1px solid rgba(226, 232, 240, 0.8); 
      border-radius: 16px; 
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .glass-card:hover { 
      transform: translateY(-2px);
      box-shadow: 0 12px 24px -10px rgba(0,0,0,0.05);
    }

    /* Knowledge Base Enhancements */
    .kb-table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 1rem; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
    .kb-table th { background: #f8fafc; color: #64748b; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; padding: 14px; text-align: left; border-bottom: 1px solid #e2e8f0; }
    .kb-table td { padding: 20px; font-size: 14px; border-bottom: 1px solid #f1f5f9; vertical-align: top; line-height: 1.6; background: white; }
    
    .kb-template {
      position: relative;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      cursor: pointer;
    }
    .kb-template:hover { background: #f1f5f9; }
    .copy-hint { position: absolute; top: 8px; right: 8px; opacity: 0; transition: opacity 0.2s; }
    .kb-template:hover .copy-hint { opacity: 1; }

    .view-content { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Nav Tree Styles */
    .nav-chevron {
      transition: transform 0.2s ease;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

    /* Enhanced Audit Form Styles */
    .form-input {
      background-color: #f8fafc; 
      border: 1px solid #e2e8f0; 
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 14px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .form-input:focus {
      outline: none;
      border-color: #0f172a;
      background-color: white;
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }
    .rating-btn, .compliance-btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 40px; height: 40px; border-radius: 10px; background-color: #f1f5f9;
      font-size: 14px; font-weight: 600; color: #64748b; cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .rating-btn:hover, .compliance-btn:hover { 
      background-color: #e2e8f0;
      transform: translateY(-2px);
    }
    .rating-btn.selected { 
      background-color: #0f172a; 
      color: white; 
      transform: translateY(-2px);
      box-shadow: 0 6px 12px -4px rgba(15, 23, 42, 0.2);
    }
    .compliance-btn { width: auto; padding: 0 16px; }
    .compliance-btn.selected[data-value="yes"] { background-color: #10b981; color: white; transform: translateY(-2px); box-shadow: 0 6px 12px -4px rgba(16, 185, 129, 0.3); }
    .compliance-btn.selected[data-value="no"] { background-color: #ef4444; color: white; transform: translateY(-2px); box-shadow: 0 6px 12px -4px rgba(239, 68, 68, 0.3); }
    .compliance-btn.selected[data-value="na"] { background-color: #64748b; color: white; transform: translateY(-2px); box-shadow: 0 6px 12px -4px rgba(100, 116, 139, 0.3); }

    /* Tooltip for ratings */
    .rating-group { position: relative; }
    .rating-btn-wrapper { position: relative; }
    .rating-tooltip {
      visibility: hidden; opacity: 0;
      position: absolute; bottom: 125%; left: 50%;
      transform: translateX(-50%);
      background-color: #0f172a; color: white;
      padding: 4px 8px; border-radius: 4px;
      font-size: 11px; font-weight: 500;
      white-space: nowrap;
      transition: opacity 0.2s, visibility 0.2s;
    }
    .rating-btn-wrapper:hover .rating-tooltip {
      visibility: visible; opacity: 1;
    }
  </style>
  <style>
    aside, main { display: none; }
  </style>
</head>
<body class="flex min-h-screen">

  <section id="view-login" class="w-full h-screen bg-slate-100 flex items-center justify-center absolute top-0 left-0 z-[100]">
    <div class="w-full max-w-sm">
      <form id="login-form" class="bg-white glass-card shadow-xl rounded-2xl px-8 pt-10 pb-8">
        <div class="mb-8 text-center">
          <h1 class="text-2xl font-extrabold text-slate-900 tracking-tight">TSUKI GLASS</h1>
          <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">Support Portal</p>
        </div>
        <div id="login-error" class="bg-red-100 border border-red-200 text-red-700 px-4 py-3 rounded-lg relative mb-4 hidden" role="alert">
          <span class="block sm:inline">Invalid email or password.</span>
        </div>
        <div class="mb-4">
          <label class="block text-slate-600 text-xs font-bold mb-2 uppercase tracking-wider" for="email">
            Email Address
          </label>
          <input class="form-input w-full text-sm" id="email" type="email" placeholder="user@tsukiglass.com" required>
        </div>
        <div class="mb-6">
          <label class="block text-slate-600 text-xs font-bold mb-2 uppercase tracking-wider" for="password">
            Password
          </label>
          <input class="form-input w-full text-sm" id="password" type="password" placeholder="••••••••••">
        </div>
        <div class="mt-8">
          <button class="bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-lg w-full uppercase tracking-wider text-sm transition-transform transform hover:scale-105" type="submit">
            Sign In
          </button>
        </div>
      </form>
    </div>
  </section>


  <aside class="w-[280px] h-screen bg-white border-r border-slate-200 fixed flex flex-col z-50">
    <div class="p-8">
      <div class="flex items-center gap-3 mb-2">
        <div>
          <h1 class="text-lg font-extrabold text-slate-900 tracking-tight">TSUKI GLASS</h1>
          <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Support Portal</p>
        </div>
      </div>
    </div>
    
    <nav class="flex-1 px-4 space-y-1">
      <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4 pb-2 mt-4">Main Menu</div>
      <button onclick="setView('dashboard')" id="btn-dashboard" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl nav-active">
        <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard
      </button>
      <button onclick="setView('agents')" id="btn-agents" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl">
        <i data-lucide="users" class="w-4 h-4"></i> Agent Performance
      </button>
      <button onclick="setView('knowledge')" id="btn-knowledge" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl">
        <i data-lucide="book-open" class="w-4 h-4"></i> Knowledge Base
      </button>

      <div id="systems-label" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-4 pt-8 pb-2 mb-2 mt-8">Systems</div>

      <button onclick="setView('quality')" id="btn-quality" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl">
        <i data-lucide="shield-check" class="w-4 h-4"></i> Quality Form
      </button>

      <button onclick="setView('schedule')" id="btn-schedule" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl">
        <i data-lucide="calendar" class="w-4 h-4"></i> Schedule
      </button>
      <button onclick="setView('settings')" id="btn-settings" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl">
        <i data-lucide="settings" class="w-4 h-4"></i> Settings
      </button>
      <button onclick="setView('training')" id="btn-training" class="nav-item w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-50 rounded-xl">
        <i data-lucide="book" class="w-4 h-4"></i> Training
      </button>
    </nav>

<div class="p-4 border-t border-slate-200">
    <button onclick="logout()" class="w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-slate-500 hover:bg-slate-100 rounded-xl">
        <i data-lucide="log-out" class="w-4 h-4"></i>
        <span>Logout</span>
    </button>
</div>

  </aside>

  <main class="ml-[280px] flex-1 p-12 max-w-[1600px]">
    
    <section id="view-dashboard" class="view-content">
      <div class="flex justify-between items-end mb-10">
        <div>
          <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Operational Overview</h1>
          <p class="text-slate-500 mt-1">Real-time performance metrics for the current billing cycle.</p>
        </div>
        <div class="flex gap-2">
          <button class="bg-white border border-slate-200 px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 flex items-center gap-2 hover:bg-slate-50">
            <i data-lucide="download" class="w-4 h-4"></i> Export Report
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10">
        <div class="bg-white border border-slate-200 rounded-lg p-5">
          <p class="text-xs font-medium text-slate-500 mb-2">Total Inbound</p>
          <h2 class="text-2xl font-semibold text-slate-900">1,000</h2>
          <p class="text-xs text-emerald-600 mt-2">+12% from last period</p>
        </div>
        <div class="bg-white border border-slate-200 rounded-lg p-5">
          <p class="text-xs font-medium text-slate-500 mb-2">Avg Handling Time</p>
          <h2 class="text-2xl font-semibold text-slate-900">4m 12s</h2>
          <p class="text-xs text-slate-500 mt-2">-2% from last period</p>
        </div>
        <div class="bg-white border border-slate-200 rounded-lg p-5">
          <p class="text-xs font-medium text-slate-500 mb-2">CSAT Score</p>
          <h2 class="text-2xl font-semibold text-slate-900">100.0%</h2>
          <p class="text-xs text-slate-500 mt-2">No change</p>
        </div>
        <div class="bg-white border border-slate-200 rounded-lg p-5">
          <p class="text-xs font-medium text-slate-500 mb-2">Active Agents</p>
          <h2 class="text-2xl font-semibold text-slate-900">2</h2>
          <p class="text-xs text-slate-500 mt-2">Agent 1, Agent 2</p>
        </div>
      </div>
      
      <div class="glass-card p-12 flex flex-col items-center justify-center text-slate-400 border-dashed border-2 border-slate-200">
        <div class="p-4 bg-slate-50 rounded-full mb-4">
          <i data-lucide="bar-chart-3" class="w-8 h-8 opacity-40"></i>
        </div>
        <p class="text-sm font-semibold text-slate-500">Analytics Visualization Module</p>
        <p class="text-xs text-slate-400 mt-1">Data will populate upon API synchronization.</p>
      </div>
    </section>

    <section id="view-agents" class="view-content hidden">
        <h1 class="text-3xl font-bold text-slate-900 mb-8">Agent Performance</h1>
        <div class="glass-card overflow-hidden">
            <table class="w-full text-left">
              <thead class="bg-slate-50 border-b border-slate-200">
                <tr>
                  <th class="px-8 py-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Agent Name</th>
                  <th class="px-8 py-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Status</th>
                  <th class="px-8 py-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Department</th>
                  <th class="px-8 py-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-100 bg-white">
                <tr class="hover:bg-slate-50/50 transition-colors">
                  <td class="px-8 py-5">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">A1</div>
                      <span class="text-sm font-semibold text-slate-900">Agent 1</span>
                    </div>
                  </td>
                  <td class="px-8 py-5">
                    <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-emerald-50 text-emerald-700 text-[11px] font-bold rounded-full">
                      <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span> ONLINE
                    </span>
                  </td>
                  <td class="px-8 py-5 text-sm text-slate-500">Customer Support</td>
                  <td class="px-8 py-5"><button class="text-slate-400 hover:text-slate-900"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button></td>
                </tr>
                <tr class="hover:bg-slate-50/50 transition-colors">
                  <td class="px-8 py-5">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">A2</div>
                      <span class="text-sm font-semibold text-slate-900">Agent 2</span>
                    </div>
                  </td>
                  <td class="px-8 py-5">
                    <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-slate-100 text-slate-500 text-[11px] font-bold rounded-full">
                      <span class="w-1.5 h-1.5 bg-slate-400 rounded-full"></span> OFFLINE
                    </span>
                  </td>
                  <td class="px-8 py-5 text-sm text-slate-500">Quality Assurance</td>
                  <td class="px-8 py-5"><button class="text-slate-400 hover:text-slate-900"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button></td>
                </tr>
              </tbody>
            </table>
          </div>
    </section>

    <section id="view-quality" class="view-content hidden">
      <!-- Header -->
      <div class="flex justify-between items-start mb-8">
        <div>
          <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Quality Form</h1>
          <p class="text-slate-500 mt-1">Evaluate agent performance based on the criteria below.</p>
        </div>
        <div class="flex gap-2">
          <button onclick="resetAuditForm()" class="bg-white border border-slate-200 px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 hover:bg-slate-50 flex items-center gap-2">
            <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Reset
          </button>
          <button onclick="downloadAuditPDF()" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800 flex items-center gap-2">
            <i data-lucide="download" class="w-4 h-4"></i> Download PDF
          </button>
        </div>
      </div>

      <!-- Audit Info -->
      <div class="glass-card p-8 mb-8">
        <h2 class="text-lg font-bold text-slate-800 mb-6 border-b border-slate-200 pb-4">Audit Details</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div>
            <label for="audit-agent" class="text-xs font-bold text-slate-500 uppercase mb-2 block">Agent</label>
            <input type="text" id="audit-agent" placeholder="Agent Name" class="form-input w-full">
          </div>
          <div>
            <label for="audit-evaluator" class="text-xs font-bold text-slate-500 uppercase mb-2 block">Evaluator</label>
            <input type="text" id="audit-evaluator" placeholder="Evaluator Name" class="form-input w-full">
          </div>
          <div>
            <label for="audit-ticket" class="text-xs font-bold text-slate-500 uppercase mb-2 block">Ticket/Call ID</label>
            <input type="text" id="audit-ticket" placeholder="Ticket/Call ID" class="form-input w-full">
          </div>
          <div>
            <label for="audit-date" class="text-xs font-bold text-slate-500 uppercase mb-2 block">Date</label>
            <input type="date" id="audit-date" class="form-input w-full">
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="mb-8">
        <div class="flex justify-between items-center mb-2">
            <label class="text-xs font-bold text-slate-500 uppercase">Form Progress</label>
            <span id="audit-progress-text" class="text-sm font-bold text-slate-600">0%</span>
        </div>
        <div class="w-full bg-slate-200 rounded-full h-2.5">
            <div id="audit-progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
      </div>

      <!-- Audit Form Content -->
      <div id="audit-form-content" class="space-y-6">
        
        <!-- Call Opening -->
        <div class="glass-card overflow-hidden">
          <h3 class="text-base font-bold text-blue-800 bg-blue-50 p-6 border-b border-blue-200">Call Opening</h3>
          <div class="p-6 space-y-4">
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Greeted customer professionally</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="opening">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Introduced self and company</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="opening">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Verified customer identity</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="opening">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
          </div>
        </div>

        <!-- Communication Skills -->
        <div class="glass-card overflow-hidden">
          <h3 class="text-base font-bold text-purple-800 bg-purple-50 p-6 border-b border-purple-200">Communication Skills</h3>
          <div class="p-6 space-y-4">
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Clear and understandable speech</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="communication">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Active listening demonstrated</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="communication">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Professional tone maintained</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="communication">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
             <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Empathy and rapport building</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="communication">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
          </div>
        </div>

        <!-- Problem Resolution -->
        <div class="glass-card overflow-hidden">
          <h3 class="text-base font-bold text-emerald-800 bg-emerald-50 p-6 border-b border-emerald-200">Problem Resolution</h3>
          <div class="p-6 space-y-4">
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Correctly identified issue</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="resolution">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Provided accurate information</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="resolution">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Followed proper procedures</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="resolution">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
             <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Offered appropriate solutions</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="resolution">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
          </div>
        </div>

        <!-- Call Closing -->
        <div class="glass-card overflow-hidden">
          <h3 class="text-base font-bold text-amber-800 bg-amber-50 p-6 border-b border-amber-200">Call Closing</h3>
          <div class="p-6 space-y-4">
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Summarized resolution/next steps</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="closing">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Asked if anything else needed</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="closing">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Professional closing statement</div>
                <div class="flex items-center gap-2 justify-start md:justify-end rating-group" data-category="closing">
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Poor</span><span class="rating-btn" data-value="1">1</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Needs Work</span><span class="rating-btn" data-value="2">2</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Meets</span><span class="rating-btn" data-value="3">3</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceeds</span><span class="rating-btn" data-value="4">4</span></div>
                  <div class="rating-btn-wrapper"><span class="rating-tooltip">Exceptional</span><span class="rating-btn" data-value="5">5</span></div>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
          </div>
        </div>

        <!-- Compliance -->
        <div class="glass-card overflow-hidden">
          <h3 class="text-base font-bold text-rose-800 bg-rose-50 p-6 border-b border-rose-200">Compliance</h3>
          <div class="p-6 space-y-4">
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Followed data protection guidelines</div>
                <div class="flex items-center gap-2 justify-start md:justify-end compliance-group">
                  <span class="compliance-btn" data-value="yes">Yes</span>
                  <span class="compliance-btn" data-value="no">No</span>
                  <span class="compliance-btn" data-value="na">N/A</span>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">No unauthorized promises made</div>
                <div class="flex items-center gap-2 justify-start md:justify-end compliance-group">
                  <span class="compliance-btn" data-value="yes">Yes</span>
                  <span class="compliance-btn" data-value="no">No</span>
                  <span class="compliance-btn" data-value="na">N/A</span>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
            <div class="py-4 border-b border-slate-100 last:border-b-0">
              <div class="grid md:grid-cols-2 gap-4 items-center mb-4">
                <div class="font-semibold text-slate-800">Proper documentation completed</div>
                <div class="flex items-center gap-2 justify-start md:justify-end compliance-group">
                  <span class="compliance-btn" data-value="yes">Yes</span>
                  <span class="compliance-btn" data-value="no">No</span>
                  <span class="compliance-btn" data-value="na">N/A</span>
                </div>
              </div>
              <textarea class="audit-comment form-input w-full h-20 resize-none" placeholder="Add a comment..."></textarea>
            </div>
          </div>
        </div>

      </div>

      <!-- Overall Notes & Score -->
      <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 glass-card p-6">
          <label for="audit-notes" class="text-xs font-bold text-slate-500 uppercase mb-2 block">Overall Notes & Coaching Points</label>
          <textarea id="audit-notes" class="form-input w-full h-48 resize-none" placeholder="Enter final feedback and coaching points for the agent..."></textarea>
        </div>
        <div class="glass-card bg-slate-900 p-8 flex flex-col justify-center items-center text-center">
          <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Total Score</p>
          <div class="my-4">
            <span id="audit-score" class="text-7xl font-extrabold text-white">0</span>
            <span class="text-3xl font-bold text-slate-500">/70</span>
          </div>
          <div class="w-full bg-slate-700 rounded-full h-2.5">
            <div id="audit-percent-bar" class="bg-emerald-500 h-2.5 rounded-full" style="width: 0%"></div>
          </div>
          <p class="text-slate-300 mt-3"><span id="audit-percent">0</span>% Quality Score</p>
        </div>
      </div>
    </section>

    <section id="view-knowledge" class="view-content hidden">
      <div class="flex gap-8">
        <div class="w-[280px] shrink-0">
          <div class="sticky top-12">
              <div class="relative mb-4">
                <i data-lucide="search" class="w-4 h-4 absolute left-3 top-2.5 text-slate-400"></i>
                <input type="text" id="kb-search" oninput="searchKnowledgeBase()" placeholder="Search..." class="w-full pl-9 pr-3 py-2 text-sm bg-white border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-900/10">
              </div>

            <div class="bg-white border border-slate-200 rounded-lg overflow-hidden">
              <div class="max-h-[calc(100vh-200px)]">

                <!-- Shipping & Orders -->
                <div class="border-b border-slate-100">
                  <button onclick="toggleNavSection('shipping')" class="w-full flex items-center justify-between p-3 hover:bg-slate-50 transition-colors">
                    <div class="flex items-center gap-2">
                      <i data-lucide="package" class="w-4 h-4 text-slate-600"></i>
                      <span class="text-sm font-semibold text-slate-900">Shipping & Orders</span>
                    </div>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 nav-chevron" id="chevron-shipping"></i>
                  </button>
                  <div id="nav-shipping" class="bg-slate-50 hidden">
                    <div onclick="scrollToSection('shipping-matrix')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Address Modification
                    </div>
                    <div onclick="scrollToSection('shipping-matrix')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Modify Unfulfilled Orders
                    </div>
                    <div onclick="scrollToSection('shipping-matrix')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Order Status Templates
                    </div>
                  </div>
                </div>

                <!-- Cancellations & Refunds -->
                <div class="border-b border-slate-100">
                  <button onclick="toggleNavSection('cancellations')" class="w-full flex items-center justify-between p-3 hover:bg-slate-50 transition-colors">
                    <div class="flex items-center gap-2">
                      <i data-lucide="x-circle" class="w-4 h-4 text-slate-600"></i>
                      <span class="text-sm font-semibold text-slate-900">Cancellations & Refunds</span>
                    </div>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 nav-chevron" id="chevron-cancellations"></i>
                  </button>
                  <div id="nav-cancellations" class="bg-slate-50 hidden">
                    <div onclick="scrollToSection('cancellations')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Cancellation Workflow
                    </div>
                    <div onclick="scrollToSection('cancellations')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Refund for Returns
                    </div>
                  </div>
                </div>

                <!-- Voice Scripts -->
                <div class="border-b border-slate-100">
                  <button onclick="toggleNavSection('abandoned-carts')" class="w-full flex items-center justify-between p-3 hover:bg-slate-50 transition-colors">
                    <div class="flex items-center gap-2">
                      <i data-lucide="phone" class="w-4 h-4 text-slate-600"></i>
                      <span class="text-sm font-semibold text-slate-900">Voice Scripts</span>
                    </div>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 nav-chevron" id="chevron-abandoned-carts"></i>
                  </button>
                  <div id="nav-abandoned-carts" class="bg-slate-50 hidden">
                    <div onclick="scrollToSection('abandoned-cart-script')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Recovery Script
                    </div>
                  </div>
                </div>

                <!-- Email Templates -->
                <div class="border-b border-slate-100">
                  <button onclick="toggleNavSection('customer-responses')" class="w-full flex items-center justify-between p-3 hover:bg-slate-50 transition-colors">
                    <div class="flex items-center gap-2">
                      <i data-lucide="mail" class="w-4 h-4 text-slate-600"></i>
                      <span class="text-sm font-semibold text-slate-900">Email Templates</span>
                    </div>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 nav-chevron" id="chevron-customer-responses"></i>
                  </button>
                  <div id="nav-customer-responses" class="bg-slate-50 hidden">
                    <div onclick="scrollToSection('customer-response-templates')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Abandoned & Payment Issues
                    </div>
                    <div onclick="scrollToSection('customer-response-templates')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-.all">
                      Shipping & Delivery
                    </div>
                    <div onclick="scrollToSection('customer-response-templates')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Social Media Responses
                    </div>
                  </div>
                </div>

                <!-- Tools -->
                <div>
                  <button onclick="toggleNavSection('tools')" class="w-full flex items-center justify-between p-3 hover:bg-slate-50 transition-colors">
                    <div class="flex items-center gap-2">
                      <i data-lucide="calculator" class="w-4 h-4 text-slate-600"></i>
                      <span class="text-sm font-semibold text-slate-900">Tools</span>
                    </div>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-slate-400 nav-chevron" id="chevron-tools"></i>
                  </button>
                  <div id="nav-tools" class="bg-slate-50 hidden">
                    <div onclick="scrollToSection('retention-calculator')" class="pl-9 pr-3 py-2 text-xs text-slate-700 hover:text-slate-900 hover:bg-slate-100 cursor-pointer border-l-2 border-transparent hover:border-slate-900 transition-all">
                      Retention Calculator
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <div class="flex-1 space-y-12 pb-32">

          <!-- Shipping & Orders -->
          <div id="shipping-matrix">
            <div class="mb-8">
              <h2 class="text-3xl font-extrabold text-slate-900 tracking-tight">Shipping & Orders</h2>
              <p class="text-slate-500 mt-2 text-lg">Standardized workflows for common shipping and order-related tasks.</p>
            </div>

            <div class="space-y-4">
              <!-- Step 1 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Address Modification</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm text-slate-800">Always confirm fulfillment status in Shopify before discussing options with the customer. Status determines the entire path.</p>
                </div>
              </div>
              <!-- Step 2 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm"></div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm font-bold text-rose-800 mb-2">If Status is FULFILLED</p>
                  <p class="text-sm text-slate-800">Notify customer that the order has shipped. Provide tracking and advise direct courier contact. Modification is not possible.</p>
                </div>
              </div>
              <!-- Step 3 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm"></div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm font-bold text-emerald-800 mb-2">If Status is UNFULFILLED</p>
                  <p class="text-sm text-slate-800">Proceed to gather details from the customer. Use the inquiry template for consistency.</p>
                </div>
              </div>
              <!-- Step 4 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Order Modification</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm font-bold text-slate-800 mb-2">Adding Items</p>
                  <p class="text-sm text-slate-800 mb-4">Confirm Product Name/Quantity/Link with the customer.</p>
                  <ul class="text-sm space-y-2 list-disc list-inside text-slate-600">
                    <li>For US orders: Update OMS, then edit Shopify invoice amount.</li>
                    <li>For International orders: Update Shopify, then escalate to K&S Team.</li>
                  </ul>
                </div>
              </div>
              <!-- Step 5 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm"></div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm font-bold text-slate-800 mb-2">Removing Items</p>
                  <p class="text-sm text-slate-800 mb-4">Request Product Name, Reason, and PayPal for refund from the customer.</p>
                  <ul class="text-sm space-y-2 list-disc list-inside text-slate-600">
                    <li>Process in ERP/OMS and Shopify.</li>
                    <li>Trigger manual refund in Shopify.</li>
                    <li>Notify customer: "Refund initiated (5-7 days)".</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Cancellations & Refunds -->
          <div id="cancellations">
            <div class="mb-8">
              <h2 class="text-3xl font-extrabold text-slate-900 tracking-tight">Cancellations & Refunds</h2>
              <p class="text-slate-500 mt-2 text-lg">Protocols for handling cancellation requests and refunds.</p>
            </div>

            <div class="space-y-4">
              <!-- Step 1 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Cancellation Workflow</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm font-bold text-rose-800 mb-2">If Tracking is Issued</p>
                  <p class="text-sm text-slate-800">Cancellation is not possible. Suggest the customer receive the package and then initiate a return.</p>
                </div>
              </div>
              <!-- Step 2 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm"></div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm font-bold text-emerald-800 mb-2">If Within 24 Hours of Order</p>
                  <p class="text-sm text-slate-800">Attempt retention first by offering store credit. If declined, hold the order in Shopify and cancel in Shopify/OMS.</p>
                </div>
              </div>
               <!-- Step 3 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Refund for Returns</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                    <p class="text-sm font-bold text-slate-800 mb-2">90-Day Return Policy</p>
                    <p class="text-sm text-slate-800 mb-4">The following conditions must be met for a return to be eligible for a refund:</p>
                    <ul class="text-sm space-y-2 list-disc list-inside text-slate-600">
                        <li>Original packaging required.</li>
                        <li>Product must be unused and in the same condition.</li>
                        <li>Buyer pays return shipping.</li>
                    </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Voice Scripts -->
          <div id="abandoned-cart-script">
            <div class="mb-8">
              <h2 class="text-3xl font-extrabold text-slate-900 tracking-tight">Voice Scripts</h2>
              <p class="text-slate-500 mt-2 text-lg">Scripts for outbound calls to recover abandoned checkouts.</p>
            </div>

            <div class="space-y-4">
              <!-- Step 1 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">When to Contact</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <ul class="text-sm space-y-2 list-disc list-inside text-slate-600">
                    <li>Customer added items and entered contact details.</li>
                    <li>Call within 1–24 hours of cart abandonment.</li>
                    <li>Call only between 8 a.m. – 9 p.m. in the recipient's local time.</li>
                    <li>Immediately honor opt-out or DNC requests.</li>
                  </ul>
                </div>
              </div>
              <!-- Step 2 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Opening Script</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm text-slate-800 italic">"Hi, may I speak with [Customer Name]? This is [Agent Name] calling from [Store Name]. You recently added items to your cart but didn’t get a chance to check out. Is now a good time for a quick minute?"</p>
                </div>
              </div>
              <!-- Step 3 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Handling Objections</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                    <p class="text-sm font-bold text-slate-800 mb-2">Price Concern</p>
                    <p class="text-sm text-slate-800 italic mb-4">"Thanks for sharing that. If it helps, I can apply [free shipping / small promo] today."</p>
                    <p class="text-sm font-bold text-slate-800 mb-2">Still Thinking</p>
                    <p class="text-sm text-slate-800 italic">"Totally fine. Would it help if I emailed you your cart so you can check out when it’s convenient?"</p>
                </div>
              </div>
                <!-- Step 4 -->
              <div class="flex gap-6">
                <div class="w-1/4 font-semibold text-slate-600 text-sm">Closing Script</div>
                <div class="flex-1 p-6 bg-white border border-slate-200 rounded-2xl">
                  <p class="text-sm text-slate-800 italic">"Would you like me to help complete the order now, or would you prefer the link by email?"</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Email Templates -->
          <div id="customer-response-templates">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">
              Email Templates
            </h2>
            <p class="text-slate-500 mb-10">
              Approved reply templates for sales, support, social media, shipping, refunds, and customer care.
            </p>

            <div class="space-y-12">

              <!-- ABANDONED / PAYMENT -->
              <section id="responses-abandoned-payment" class="space-y-6">
                <h3 class="text-xl font-semibold text-slate-900">Abandoned & Payment Issues</h3>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Abandon – During Call</p>
                  <pre class="text-sm text-slate-700 whitespace-pre-wrap font-sans template-content">
Hello {{ticket.customer.firstname}},

I’d be happy to help you place your order.

You can use the following link to place your order:
[Insert link]

Before checking out, please apply this 20% discount code:
[Insert code]

If you run into any issues or have questions, I’m here to help.

Best regards,
{{current_user.firstname}}
Tsuki Glass Support</pre>
                </div>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Charged but No Order Found</p>
                  <pre class="text-sm text-slate-700 whitespace-pre-wrap font-sans template-content">
Hello {{ticket.customer.firstname}},

Thank you for reaching out. After checking our system, we do not see an order under your name.

To investigate further, please provide:
• Email and address used
• Date and time of charge
• Amount charged

Once received, we’ll resolve this promptly.

Best regards,
{{current_user.firstname}}</pre>
                </div>
              </section>

              <!-- SHIPPING -->
              <section id="responses-shipping" class="space-y-6">
                <h3 class="text-xl font-semibold text-slate-900">Shipping & Delivery</h3>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Shipping Delay</p>
                  <pre class="text-sm text-slate-700 whitespace-pre-wrap font-sans template-content">
Hello {{ticket.customer.firstname}},

I sincerely apologize for the delay. Due to increased order volume, some shipments are delayed.

Your order has shipped and can be tracked here:
https://tsukiglass.com/apps/track123?nums=

Best regards,
{{current_user.firstname}}</pre>
                </div>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Delivered to Incorrect Address</p>
                  <pre class="text-sm text-slate-700 whitespace-pre-wrap font-sans template-content">
Hi {{ticket.customer.firstname}},

We’ve escalated this to our logistics team for urgent investigation.
We’ll update you immediately once we hear back.

Kind regards,
{{current_user.firstname}}</pre>
                </div>
              </section>

              <!-- SOCIAL -->
              <section id="responses-social" class="space-y-6">
                <h3 class="text-xl font-semibold text-slate-900">Social Media Responses</h3>

                 <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Loved the Glasses</p>
                  <p class="text-sm italic text-slate-700 template-content">We absolutely love hearing this! 🎉 Every TsukiGlass is handcrafted to elevate your experience.</p>
                </div>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Out of Stock</p>
                  <p class="text-sm italic text-slate-700 template-content">Thanks for your interest! Please sign up for an email alert on the product page to be notified when it’s back.</p>
                </div>
              </section>

              <!-- RETURNS -->
              <section id="responses-returns" class="space-y-6">
                <h3 class="text-xl font-semibold text-slate-900">Returns, Refunds & Damage</h3>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Broken Glass Replacement</p>
                  <pre class="text-sm text-slate-700 whitespace-pre-wrap font-sans template-content">
Dear {{ticket.customer.firstname}},

We’ve arranged a replacement set of 2 glasses.
No return is required.

Best regards,
{{current_user.firstname}}</pre>
                </div>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Return Beyond 30 Days</p>
                  <pre class="text-sm text-slate-700 whitespace-pre-wrap font-sans template-content">
While we’re unable to process a refund, we’d like to offer a 30% discount on your next order.

Code: X67YGF30ReturnGift</pre>
                </div>
              </section>

              <!-- PRODUCT -->
              <section id="responses-product" class="space-y-6">
                <h3 class="text-xl font-semibold text-slate-900">Product & Store Inquiries</h3>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Left-Handed Product Inquiry</p>
                  <p class="text-sm text-slate-700 template-content">The Storm Japanese Crystal Whisky Glass is designed to be comfortable for both left- and right-handed users.</p>
                </div>
              </section>

              <!-- FEEDBACK -->
              <section id="responses-feedback" class="space-y-6">
                <h3 class="text-xl font-semibold text-slate-900">Feedback & Reviews</h3>

                <div class="kb-template p-4 rounded-xl" onclick="copyTemplate(this)">
                  <div class="copy-hint text-[10px] font-bold text-blue-600">CLICK TO COPY</div>
                  <p class="text-[10px] font-bold text-blue-500 uppercase mb-2 tracking-widest">Positive Feedback</p>
                  <p class="text-sm text-slate-700 template-content">Thank you so much for your kind words! We’d truly appreciate a review on Trustpilot.</p>
                </div>
              </section>

            </div>
          </div>

          <!-- Tools -->
          <div id="retention-calculator">
            <h2 class="text-3xl font-bold text-slate-900 tracking-tight mb-8">Retention Offer Calculator</h2>
            
            <div class="bg-white border border-slate-200 rounded-[32px] p-10 shadow-2xl shadow-slate-200/50">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-10 mb-10">
                <div class="space-y-2">
                  <label class="text-[10px] font-extrabold text-slate-400 uppercase tracking-widest">Order Total ($)</label>
                  <input type="number" id="orderAmount" placeholder="0.00" class="w-full px-6 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-2xl font-bold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all outline-none" oninput="calculateRetention()">
                </div>
                <div class="space-y-2">
                  <label class="text-[10px] font-extrabold text-slate-400 uppercase tracking-widest">Existing Discount (%)</label>
                  <input type="number" id="existingDiscount" value="0" min="0" max="20" class="w-full px-6 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-2xl font-bold focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all outline-none" oninput="calculateRetention()">
                </div>
              </div>

              <div id="results" class="hidden animate-in fade-in slide-in-from-bottom-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="p-8 bg-blue-600 text-white rounded-[24px]">
                        <p class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-4">Option A: Partial Refund</p>
                        <h4 class="text-4xl font-bold mb-2" id="refundAmount">$0.00</h4>
                        <p class="text-xs text-blue-100 mb-6">Immediate refund + <span id="refundDiscount">30%</span> coupon</p>
                        <div class="pt-6 border-t border-white/20">
                            <p class="text-[10px] uppercase font-bold opacity-60">Customer Net Pay</p>
                            <p class="text-xl font-bold" id="refundNetAmount">$0.00</p>
                        </div>
                    </div>
                    <div class="p-8 bg-slate-900 text-white rounded-[24px]">
                        <p class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-4">Option B: Store Credit</p>
                        <h4 class="text-4xl font-bold mb-2" id="creditAmount">$0.00</h4>
                        <p class="text-xs text-slate-400 mb-6">Store credit + <span id="creditDiscount">30%</span> coupon</p>
                        <div class="pt-6 border-t border-white/20">
                            <p class="text-[10px] uppercase font-bold opacity-60">Total Value Offered</p>
                            <p class="text-xl font-bold" id="creditTotalValue">$0.00</p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-50 border border-slate-200 rounded-2xl p-6">
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">Personalized Script</p>
                    <div class="text-sm text-slate-700 leading-relaxed font-medium" id="scriptTemplate"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section id="view-schedule" class="view-content hidden">
      <!-- Header with Week Navigation -->
      <div class="flex justify-between items-center mb-6">
        <div>
          <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Schedule</h1>
          <p class="text-slate-500 mt-1">Shift Scheduling and Coverage</p>
        </div>
        <div class="flex items-center gap-3">
          <button class="bg-white border border-slate-200 px-4 py-2 rounded-lg text-sm font-semibold text-slate-600 hover:bg-slate-50 flex items-center gap-2">
            <i data-lucide="download" class="w-4 h-4"></i> Export
          </button>
          <button class="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800 flex items-center gap-2">
            <i data-lucide="plus" class="w-4 h-4"></i> Add Shift
          </button>
        </div>
      </div>

      <!-- Week Navigation Bar -->
      <div class="glass-card p-4 mb-6 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <button onclick="prevWeek()" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" title="Previous Week">
            <i data-lucide="chevron-left" class="w-5 h-5 text-slate-600"></i>
          </button>
          <div class="flex items-center gap-3">
            <h2 id="week-range-display" class="text-xl font-bold text-slate-900 w-40 text-center"></h2>
            <button onclick="goToToday()" class="p-1 hover:bg-slate-100 rounded-transition-colors" title="Go to Today">
              <i data-lucide="calendar" class="w-4 h-4 text-slate-500"></i>
            </button>
          </div>
          <button onclick="nextWeek()" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" title="Next Week">
            <i data-lucide="chevron-right" class="w-5 h-5 text-slate-600"></i>
          </button>
        </div>
        <div class="flex items-center gap-2">
          <select id="view-mode-select" onchange="changeCalendarView()" class="bg-white border border-slate-200 px-3 py-2 rounded-lg text-sm font-medium text-slate-700">
            <option value="week">Week</option>
            <option value="month">Month</option>
          </select>
          <select id="role-filter-select" onchange="filterSchedule()" class="bg-white border border-slate-200 px-3 py-2 rounded-lg text-sm font-medium text-slate-700">
            <option value="all">All Employees</option>
          </select>
        </div>
      </div>

      <!-- Calendar Grid -->
      <div class="glass-card overflow-hidden">
        <!-- Day Headers -->
<!-- Day Headers -->
<div class="grid grid-cols-8 border-b border-slate-200 bg-slate-50" id="week-header">
  <div class="p-4 border-r border-slate-200">
    <p class="text-xs font-bold text-slate-500 uppercase tracking-wider">Employee</p>
  </div>
  <div class="p-4 text-center border-r border-slate-200" data-day="Mon"></div>
  <div class="p-4 text-center border-r border-slate-200" data-day="Tue"></div>
  <div class="p-4 text-center border-r border-slate-200" data-day="Wed"></div>
  <div class="p-4 text-center border-r border-slate-200" data-day="Thu"></div>
  <div class="p-4 text-center border-r border-slate-200" data-day="Fri"></div>
  <div class="p-4 text-center border-r border-slate-200" data-day="Sat"></div>
  <div class="p-4 text-center" data-day="Sun"></div>
</div>


        <!-- Employee Rows -->
        <div id="schedule-tbody">
        </div>
      </div>

      <!-- Summary Stats -->
      <div class="grid grid-cols-4 gap-6 mt-6">
        <div class="glass-card p-6">
          <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Total Scheduled Hours</p>
          <p id="summary-total-hours" class="text-3xl font-bold text-slate-900">0.0</p>
          <p class="text-xs text-slate-500 mt-1">Per week (Agents only)</p>
        </div>
        <div class="glass-card p-6">
          <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Coverage Rate</p>
          <p id="summary-coverage-rate" class="text-3xl font-bold text-emerald-600">0%</p>
          <p id="summary-coverage-subtitle" class="text-xs text-slate-500 mt-1">7pm-1pm Client Operations</p>
        </div>
        <div class="glass-card p-6">
          <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Active Employees</p>
          <p id="summary-active-employees" class="text-3xl font-bold text-slate-900">0</p>
          <p id="summary-active-subtitle" class="text-xs text-slate-500 mt-1"></p>
        </div>
        <div class="glass-card p-6">
          <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Backup Coverage</p>
          <p id="summary-backup-coverage" class="text-3xl font-bold text-blue-600">0</p>
          <p class="text-xs text-slate-500 mt-1">Team leads on-call</p>
        </div>
      </div>
    </section>

    <section id="view-settings" class="view-content hidden">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-slate-900">Role Permissions</h1>
        <button onclick="toggleAddUserModal()" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800 flex items-center gap-2">
          <i data-lucide="plus" class="w-4 h-4"></i> Add User
        </button>
      </div>

      <!-- Add User Modal -->
      <div id="addUserModal" class="hidden mb-6 bg-white border border-slate-200 rounded-lg p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold text-slate-900">Add New User</h3>
          <button onclick="toggleAddUserModal()" class="text-slate-400 hover:text-slate-900">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Full Name</label>
            <input type="text" placeholder="John Doe" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Email</label>
            <input type="email" placeholder="john@example.com" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Username</label>
            <input type="text" placeholder="johndoe" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Role</label>
            <select class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Select role...</option>
              <option value="agent">Agent</option>
              <option value="agent">Agent</option>
              <option value="lead">Team Lead</option>
              <option value="admin">Administrator</option>
            </select>
          </div>
        </div>
        <div class="flex gap-2 justify-end">
          <button onclick="toggleAddUserModal()" class="px-4 py-2 text-sm font-semibold text-slate-600 hover:bg-slate-50 rounded-lg">Cancel</button>
          <button class="px-4 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 rounded-lg">Add User</button>
        </div>
      </div>

      <!-- Edit User Modal -->
      <div id="editUserModal" class="hidden mb-6 bg-white border border-slate-200 rounded-lg p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold text-slate-900">Edit User</h3>
          <button onclick="toggleEditUserModal()" class="text-slate-400 hover:text-slate-900">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Full Name</label>
            <input type="text" id="editFullName" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Email</label>
            <input type="email" id="editEmail" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Username</label>
            <input type="text" id="editUsername" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg bg-slate-50" disabled>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 block mb-2">Role</label>
            <select id="editRole" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="agent">Agent</option>
              <option value="agent">Agent</option>
              <option value="lead">Team Lead</option>
              <option value="admin">Administrator</option>
            </select>
          </div>
        </div>
        <div class="flex gap-2 justify-end">
          <button onclick="toggleEditUserModal()" class="px-4 py-2 text-sm font-semibold text-slate-600 hover:bg-slate-50 rounded-lg">Cancel</button>
          <button class="px-4 py-2 text-sm font-semibold bg-slate-900 text-white hover:bg-slate-800 rounded-lg">Save Changes</button>
        </div>
      </div>

      <div class="glass-card overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-slate-50 border-b border-slate-200">
            <tr>
              <th class="px-6 py-4 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Username</th>
              <th class="px-6 py-4 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Role</th>
              <th class="px-6 py-4 text-[11px] font-bold text-slate-400 uppercase tracking-wider w-24">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 bg-white">
            <tr class="hover:bg-slate-50/50 transition-colors">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">A1</div>
                  <span class="text-sm font-semibold text-slate-900">Agent 1</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <select class="text-xs font-semibold px-3 py-1 border border-slate-200 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="agent" selected>Agent</option>
              <option value="agent">Agent</option>
                  <option value="lead">Team Lead</option>
                  <option value="admin">Administrator</option>
                </select>
              </td>
              <td class="px-6 py-4">
                <button onclick="openEditUser('Agent 1', 'agent1@tsukiglass.com', 'agent')" class="text-slate-400 hover:text-slate-900 transition-colors">
                  <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
            <tr class="hover:bg-slate-50/50 transition-colors">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">A2</div>
                  <span class="text-sm font-semibold text-slate-900">Agent 2</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <select class="text-xs font-semibold px-3 py-1 border border-slate-200 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="agent">Agent</option>
              <option value="agent">Agent</option>
                  <option value="lead">Team Lead</option>
                  <option value="admin">Administrator</option>
                </select>
              </td>
              <td class="px-6 py-4">
                <button onclick="openEditUser('Agent 2', 'agent2@tsukiglass.com', 'qa')" class="text-slate-400 hover:text-slate-900 transition-colors">
                  <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
            <tr class="hover:bg-slate-50/50 transition-colors">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">B1</div>
                  <span class="text-sm font-semibold text-slate-900">Backup 1</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <select class="text-xs font-semibold px-3 py-1 border border-slate-200 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="agent">Agent</option>
                  <option value="qa">Quality Assurance</option>
                  <option value="lead" selected>Team Lead</option>
                  <option value="admin">Administrator</option>
                </select>
              </td>
              <td class="px-6 py-4">
                <button onclick="openEditUser('Backup 1', 'backup1@tsukiglass.com', 'lead')" class="text-slate-400 hover:text-slate-900 transition-colors">
                  <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
            <tr class="hover:bg-slate-50/50 transition-colors">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">B2</div>
                  <span class="text-sm font-semibold text-slate-900">Backup 2</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <select class="text-xs font-semibold px-3 py-1 border border-slate-200 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="agent">Agent</option>
                  <option value="qa">Quality Assurance</option>
                  <option value="lead" selected>Team Lead</option>
                  <option value="admin">Administrator</option>
                </select>
              </td>
              <td class="px-6 py-4">
                <button onclick="openEditUser('Backup 2', 'backup2@tsukiglass.com', 'lead')" class="text-slate-400 hover:text-slate-900 transition-colors">
                  <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
            <tr class="hover:bg-slate-50/50 transition-colors">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center font-bold text-xs text-slate-600">PM</div>
                  <span class="text-sm font-semibold text-slate-900">Project Manager</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <select class="text-xs font-semibold px-3 py-1 border border-slate-200 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="agent">Agent</option>
                  <option value="qa">Quality Assurance</option>
                  <option value="lead">Team Lead</option>
                  <option value="admin" selected>Administrator</option>
                </select>
              </td>
              <td class="px-6 py-4">
                <button onclick="openEditUser('Project Manager', 'pm@tsukiglass.com', 'admin')" class="text-slate-400 hover:text-slate-900 transition-colors">
                  <i data-lucide="pencil" class="w-4 h-4"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="view-training" class="view-content hidden">
      <h1 class="text-3xl font-bold text-slate-900 mb-8">Computer Based Training</h1>

      <div class="glass-card p-8 mb-8">
        <h2 class="text-lg font-bold text-slate-800 mb-6 border-b border-slate-200 pb-4">Embed Video</h2>
        <div class="flex gap-4">
          <input type="text" id="video-url" placeholder="Enter video URL (YouTube, Google Drive)" class="form-input w-full">
          <button onclick="embedVideo()" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800">Embed</button>
        </div>
        <div id="video-container" class="mt-6"></div>
      </div>

      <div class="glass-card p-8">
        <h2 class="text-lg font-bold text-slate-800 mb-6 border-b border-slate-200 pb-4">Quiz</h2>
        <div id="quiz-container">
            <button onclick="startQuiz()" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800">Start Quiz</button>
            <div id="quiz-questions" class="mt-6"></div>
            <button onclick="submitQuiz()" id="submit-quiz-btn" class="hidden bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800 mt-6">Submit Quiz</button>
        </div>
      </div>
    </section>

  </main>

  <script>
    // Google Apps Script Integration
    const GAS_MODE = typeof google !== 'undefined' && google.script; // Detect if running in Apps Script

    // Load schedule data from Google Sheets
    function loadScheduleData() {
      if (GAS_MODE) {
        google.script.run
          .withSuccessHandler(onScheduleDataLoaded)
          .withFailureHandler(onScheduleError)
          .getScheduleData();
      } else {
        console.log('Running in standalone mode - using static data');
      }
    }

    // Callback when schedule data is loaded
    function onScheduleDataLoaded(response) {
      if (response.error) {
        console.error('Error loading schedule:', response.error);
        alert('Error loading schedule: ' + response.error);
        return;
      }

      if (response.success && response.data) {
        renderSchedule(response.data);
      }
    }

    // Error handler
    function onScheduleError(error) {
      console.error('Apps Script error:', error);
      alert('Error communicating with server: ' + error.message);
    }

    // Render schedule table from data
    function renderSchedule(scheduleData) {
      const tbody = document.getElementById('schedule-tbody');
      if (!tbody) return;

      tbody.innerHTML = '';

      scheduleData.forEach((employee, index) => {
        const row = createScheduleRow(employee, index);
        tbody.appendChild(row);
      });

      lucide.createIcons();
    }

    // Create a schedule row element
    function createScheduleRow(employee, index) {
      const row = document.createElement('div');
      row.className = 'grid grid-cols-8 border-b border-slate-100 hover:bg-slate-50 transition-colors schedule-row';
      row.dataset.employee = employee.Employee;

      const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const colorClass = employee.Color || 'slate-500';

      // Employee name cell
      row.innerHTML = `
        <div class="p-4 border-r border-slate-100 flex items-center gap-3">
          <div class="w-8 h-8 rounded-full bg-${colorClass} flex items-center justify-center text-white font-bold text-sm">${employee.Initials}</div>
          <div>
            <p class="font-semibold text-slate-900 text-sm">${employee.Employee}</p>
            <p class="text-xs text-slate-500">${employee.HoursPerWeek}.00 Hrs/week</p>
          </div>
        </div>
      `;

      // Day cells
      days.forEach(day => {
        const cellDiv = document.createElement('div');
        cellDiv.className = 'p-2 border-r border-slate-100 flex items-center justify-center schedule-cell';
        cellDiv.dataset.day = day;
        cellDiv.dataset.employee = employee.Employee;

        const shiftValue = employee[day] || '';
        const isOff = shiftValue === 'OFF';
        const isOnCall = shiftValue.includes('ON-CALL');
        const isMANAGER = shiftValue.includes('MANAGER');

        let cellContent;
        if (isOff) {
          cellContent = `<div class="bg-slate-100 text-slate-400 px-3 py-2 rounded text-xs font-semibold text-center w-full editable-shift" contenteditable="true">${shiftValue}</div>`;
        } else if (isOnCall) {
          cellContent = `<div class="bg-slate-100 text-slate-600 px-3 py-2 rounded text-xs font-semibold text-center w-full border border-slate-200 editable-shift" contenteditable="true">
            <div class="font-bold">ON-CALL</div>
            <div class="text-[10px] opacity-70 mt-1">BACKUP</div>
          </div>`;
        } else if (isMANAGER) {
          cellContent = `<div class="bg-purple-500 text-white px-3 py-2 rounded text-xs font-semibold text-center w-full editable-shift" contenteditable="true">
            <div class="font-bold">MANAGER</div>
            <div class="text-[10px] opacity-90 mt-1">STRATEGY</div>
          </div>`;
        } else {
          cellContent = `<div class="bg-${colorClass} text-white px-3 py-2 rounded text-xs font-semibold text-center w-full editable-shift" contenteditable="true">
            <div class="font-bold">${shiftValue}</div>
            <div class="text-[10px] opacity-90 mt-1">${employee.Role}</div>
          </div>`;
        }

        cellDiv.innerHTML = cellContent;
        row.appendChild(cellDiv);
      });

      // Remove last day Sunday's border
      row.lastChild.classList.remove('border-r');

      return row;
    }

    // Save schedule changes to Google Sheets
    function saveScheduleChange(employeeName, day, value) {
      if (!GAS_MODE) {
        console.log('Standalone mode - change not persisted:', employeeName, day, value);
        return;
      }

      google.script.run
        .withSuccessHandler(onScheduleSaved)
        .withFailureHandler(onScheduleError)
        .updateScheduleCell(employeeName, day, value);
    }

    // Callback when schedule is saved
    function onScheduleSaved(response) {
      if (response.error) {
        console.error('Error saving schedule:', response.error);
        alert('Error saving schedule: ' + response.error);
        return;
      }

      console.log('Schedule saved successfully');
      // Optionally show a brief success indicator
    }

    // Set up edit listeners for schedule cells
    function initScheduleEditing() {
      document.addEventListener('blur', function(e) {
        if (e.target.classList.contains('editable-shift')) {
          const cell = e.target.closest('.schedule-cell');
          if (!cell) return;

          const employeeName = cell.dataset.employee;
          const day = cell.dataset.day;
          const newValue = e.target.textContent.trim();

          saveScheduleChange(employeeName, day, newValue);
        }
      }, true);

      // Also save on Enter key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.target.classList.contains('editable-shift')) {
          e.preventDefault();
          e.target.blur();
        }
      });
    }

    // Load data when view changes to schedule
    function onViewChange(viewId) {
      if (viewId === 'schedule') {
        loadScheduleData();
      }
    }

    function calculateRetention() {
      const amount = parseFloat(document.getElementById('orderAmount').value) || 0;
      const existingDiscount = parseFloat(document.getElementById('existingDiscount').value) || 0;
      const resultsDiv = document.getElementById('results');

      if (amount <= 0) {
        resultsDiv.classList.add('hidden');
        return;
      }

      let refundPercent, creditAmount, nextOrderDiscount;

      if (amount < 100) {
        refundPercent = 20; creditAmount = 35; nextOrderDiscount = 30;
      } else if (amount >= 100 && amount < 150) {
        refundPercent = 25; creditAmount = 50; nextOrderDiscount = 30;
      } else {
        refundPercent = 30; creditAmount = 60; nextOrderDiscount = 30;
      }

      const maxAdditional = Math.max(0, 20 - existingDiscount);
      const adjustedDiscount = Math.min(nextOrderDiscount, maxAdditional + 10);
      const refundVal = (amount * refundPercent / 100).toFixed(2);
      const netVal = (amount - refundVal).toFixed(2);

      document.getElementById('refundAmount').textContent = `$${refundVal}`;
      document.getElementById('refundDiscount').textContent = `${adjustedDiscount}%`;
      document.getElementById('refundNetAmount').textContent = `$${netVal}`;
      document.getElementById('creditAmount').textContent = `$${creditAmount}`;
      document.getElementById('creditDiscount').textContent = `${adjustedDiscount}%`;
      document.getElementById('creditTotalValue').textContent = `$${creditAmount} + ${adjustedDiscount}% Off`;

      document.getElementById('scriptTemplate').innerHTML = `Hi Customer, I understand you'd like to cancel. We'd love to keep you with us! <br><br><strong>Option A:</strong> A refund of $${refundVal} plus a ${adjustedDiscount}% code.<br><strong>Option B:</strong> $${creditAmount} in store credit plus a ${adjustedDiscount}% code.<br><br>Which do you prefer?`;

      resultsDiv.classList.remove('hidden');
      lucide.createIcons();
    }

    function setView(viewId) {
      document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('nav-active'));
      document.getElementById('btn-' + viewId).classList.add('nav-active');
      document.querySelectorAll('.view-content').forEach(view => view.classList.add('hidden'));
      document.getElementById('view-' + viewId).classList.remove('hidden');
      window.scrollTo(0,0);

      // Trigger view change callback
      onViewChange(viewId);
    }

    function scrollToSection(id) {
        document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function copyTemplate(el) {
        const contentEl = el.querySelector('.template-content');
        if (!contentEl) return;
        const text = contentEl.innerText;
        navigator.clipboard.writeText(text);
        
        const hint = el.querySelector('.copy-hint');
        if(hint) {
          hint.innerText = 'COPIED!';
          hint.classList.add('text-emerald-500');
          setTimeout(() => {
              hint.innerText = 'CLICK TO COPY';
              hint.classList.remove('text-emerald-500');
          }, 2000);
        }
    }

    function toggleAddUserModal() {
        const modal = document.getElementById('addUserModal');
        modal.classList.toggle('hidden');
        if (!modal.classList.contains('hidden')) {
            lucide.createIcons();
        }
    }

    function toggleEditUserModal() {
        const modal = document.getElementById('editUserModal');
        modal.classList.toggle('hidden');
        if (!modal.classList.contains('hidden')) {
            lucide.createIcons();
        }
    }

    function openEditUser(fullName, email, role) {
        document.getElementById('editFullName').value = fullName;
        document.getElementById('editEmail').value = email;
        document.getElementById('editUsername').value = email.split('@')[0];
        document.getElementById('editRole').value = role;
        toggleEditUserModal();
    }

    function toggleNavSection(sectionId) {
        const section = document.getElementById('nav-' + sectionId);
        const chevron = document.getElementById('chevron-' + sectionId);

        if (section.classList.contains('hidden')) {
            section.classList.remove('hidden');
            chevron.style.transform = 'rotate(0deg)';
        } else {
            section.classList.add('hidden');
            chevron.style.transform = 'rotate(-90deg)';
        }

        lucide.createIcons();
    }

    function searchKnowledgeBase() {
        const input = document.getElementById('kb-search');
        const filter = input.value.toUpperCase();
        const sections = document.querySelectorAll('.view-content .space-y-12 > div');

        sections.forEach(section => {
            const content = section.textContent || section.innerText;
            if (content.toUpperCase().indexOf(filter) > -1) {
                section.style.display = "";
            } else {
                section.style.display = "none";
            }
        });
    }

    function embedVideo() {
        const url = document.getElementById('video-url').value;
        const videoContainer = document.getElementById('video-container');
        videoContainer.innerHTML = '';

        function getYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length === 11) {
                return match[2];
            }
            return null;
        }

        const youtubeId = getYouTubeId(url);

        if (youtubeId) {
            const embedUrl = `https://www.youtube.com/embed/${youtubeId}`;
            videoContainer.innerHTML = `<iframe width="560" height="315" src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        } else if (url.includes('drive.google.com')) {
            const embedUrl = url.replace('/view', '/preview');
            videoContainer.innerHTML = `<iframe src="${embedUrl}" width="640" height="480" allow="autoplay"></iframe>`;
        } else {
            videoContainer.innerHTML = `<p class="text-red-500">Invalid video URL. Please use a valid YouTube or Google Drive URL.</p>`;
        }
    }

    const quizData = [
        {
            question: "What is the capital of France?",
            options: ["London", "Paris", "Berlin", "Madrid"],
            answer: "Paris"
        },
        {
            question: "What is 2 + 2?",
            options: ["3", "4", "5", "6"],
            answer: "4"
        }
    ];

    function startQuiz() {
        renderQuiz();
        document.getElementById('submit-quiz-btn').classList.remove('hidden');
        document.querySelector('#quiz-container > button').classList.add('hidden');
    }

    function renderQuiz() {
        const quizQuestions = document.getElementById('quiz-questions');
        quizQuestions.innerHTML = '';
        quizData.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'mb-4';
            questionEl.innerHTML = `<p class="font-semibold">${index + 1}. ${q.question}</p>`;
            const optionsEl = document.createElement('div');
            optionsEl.className = 'flex flex-col gap-2 mt-2';
            q.options.forEach(option => {
                optionsEl.innerHTML += `
                    <label class="flex items-center gap-2">
                        <input type="radio" name="question${index}" value="${option}">
                        <span>${option}</span>
                    </label>
                `;
            });
            questionEl.appendChild(optionsEl);
            quizQuestions.appendChild(questionEl);
        });
    }

    function submitQuiz() {
        let score = 0;
        quizData.forEach((q, index) => {
            const selected = document.querySelector(`input[name="question${index}"]:checked`);
            if (selected && selected.value === q.answer) {
                score++;
            }
        });
        const quizQuestions = document.getElementById('quiz-questions');
        quizQuestions.innerHTML = `<p class="font-semibold text-lg">Your score is: ${score} out of ${quizData.length}</p>`;
        document.getElementById('submit-quiz-btn').classList.add('hidden');
        document.querySelector('#quiz-container > button').classList.remove('hidden');
    }
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize schedule editing functionality
        initScheduleEditing();

        // Initialize icons
        lucide.createIcons();
    });

    lucide.createIcons();

    // ===== AUDIT FORM FUNCTIONS =====
    function initAuditForm() {
      document.querySelectorAll('.rating-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          this.closest('.rating-group').querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          updateAuditScoreAndProgress();
        });
      });
      document.querySelectorAll('.compliance-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          this.parentElement.querySelectorAll('.compliance-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          updateAuditScoreAndProgress();
        });
      });
      updateAuditScoreAndProgress();
    }

    function updateAuditScoreAndProgress() {
      // Score calculation
      let total = 0;
      document.querySelectorAll('.rating-btn.selected').forEach(btn => {
        total += parseInt(btn.dataset.value);
      });
      const maxScore = document.querySelectorAll('.rating-group').length * 5;
      const percentage = maxScore > 0 ? Math.round((total / maxScore) * 100) : 0;
      
      document.getElementById('audit-score').textContent = total;
      document.getElementById('audit-percent').textContent = percentage;

      const percentBar = document.getElementById('audit-percent-bar');
      if (percentBar) {
        percentBar.style.width = `${percentage}%`;
      }


      // Progress calculation
      const itemGroups = document.querySelectorAll('.rating-group, .compliance-group');
      const totalItems = itemGroups.length;
      const completedItems = document.querySelectorAll('.rating-group .selected, .compliance-group .selected').length;
      const progress = totalItems > 0 ? (completedItems / totalItems) * 100 : 0;
    
      const progressBar = document.getElementById('audit-progress-bar');
      const progressText = document.getElementById('audit-progress-text');
    
      if (progressBar) progressBar.style.width = `${progress}%`;
      if (progressText) progressText.textContent = `${Math.round(progress)}%`;
    }

    function resetAuditForm() {
      document.querySelectorAll('.rating-btn, .compliance-btn').forEach(btn => btn.classList.remove('selected'));
      document.querySelectorAll('.audit-comment').forEach(input => input.value = '');
      document.querySelectorAll('#audit-agent, #audit-evaluator, #audit-ticket, #audit-notes').forEach(el => el.value = '');
      document.getElementById('audit-date').valueAsDate = new Date();
      updateAuditScoreAndProgress();
    }


async function downloadAuditPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });

  // --- 1. GATHER DATA ---
  const auditData = {
    agent: document.getElementById('audit-agent').value || 'N/A',
    evaluator: document.getElementById('audit-evaluator').value || 'N/A',
    ticket: document.getElementById('audit-ticket').value || 'N/A',
    date: document.getElementById('audit-date').value ? new Date(document.getElementById('audit-date').value).toLocaleDateString() : new Date().toLocaleDateString(),
    score: document.getElementById('audit-score').textContent,
    maxScore: document.querySelector('#audit-score + span').textContent.substring(1),
    percent: document.getElementById('audit-percent').textContent,
    notes: document.getElementById('audit-notes').value,
        categories: []
      };
    
      document.querySelectorAll('#audit-form-content .glass-card').forEach(categoryCard => {
        const category = {
          name: categoryCard.querySelector('h3').textContent,
          color: getComputedStyle(categoryCard.querySelector('h3')).backgroundColor,
          items: []
        };
        categoryCard.querySelectorAll('.py-4.border-b').forEach(itemDiv => {
          const isRating = itemDiv.querySelector('.rating-group');
          const criterion = itemDiv.querySelector('.font-semibold').textContent;
          const comment = itemDiv.querySelector('textarea.audit-comment').value;
          
          let value = 'N/A';
          if (isRating) {
            const selectedBtn = itemDiv.querySelector('.rating-btn.selected');
            if (selectedBtn) value = `${selectedBtn.textContent}/5`;
          } else {
            const selectedBtn = itemDiv.querySelector('.compliance-btn.selected');
            if (selectedBtn) value = selectedBtn.textContent;
          }
          category.items.push({ criterion, value, comment });
        });
        auditData.categories.push(category);
      });
    
      // --- 2. RENDER PDF ---
      const PAGE_WIDTH = doc.internal.pageSize.getWidth();
      const PAGE_HEIGHT = doc.internal.pageSize.getHeight();
      const margin = 40;
      let y = 0;
      
      const wattle = '#ccdc54';
      const outerSpace = '#0f172a';
    
      const checkPageBreak = (elementHeight) => {
        if (y + elementHeight > PAGE_HEIGHT - margin) {
          doc.addPage();
          y = margin;
        }
      };
    
      // --- Accents (Wattle is dominant) ---
      doc.setFillColor(wattle);
      doc.triangle(PAGE_WIDTH, 0, PAGE_WIDTH, 80, PAGE_WIDTH - 80, 0, 'F');
      doc.setFillColor(outerSpace);
      doc.triangle(PAGE_WIDTH, 80, PAGE_WIDTH, 90, PAGE_WIDTH - 15, 80, 'F');
    
      // --- Header ---
      y = margin + 15; 
      doc.setFontSize(22);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(outerSpace);
      doc.text('Quality Audit Report', margin, y);
      y += 20;
      // --- Score Box ---
  doc.setFillColor(248, 250, 252);
  doc.roundedRect(margin, y, PAGE_WIDTH - (margin * 2), 50, 5, 5, 'F');
  const scoreBoxY = y;
  doc.setFontSize(11);
  doc.setTextColor('#64748b');
  doc.text('Score', margin + 15, scoreBoxY + 22);
  doc.setFontSize(24);
  doc.setFont('helvetica', 'bold');
  doc.setTextColor(outerSpace);
  doc.text(`${auditData.score} / ${auditData.maxScore}`, margin + 15, scoreBoxY + 42);
  doc.setFontSize(11);
  doc.setTextColor('#10b981');
  doc.text(`${auditData.percent}% Quality`, margin + 100, scoreBoxY + 39);
  y += 65;

  // --- Info Row ---
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(8);
  doc.setTextColor('#64748b');
  const infoY = y;
  const col1X = margin;
  const col2X = margin + 150;
  const col3X = margin + 300;
  const col4X = margin + 420;
  doc.text('AGENT:', col1X, infoY);
  doc.text('EVALUATOR:', col2X, infoY);
  doc.text('TICKET/CALL ID:', col3X, infoY);
  doc.text('DATE:', col4X, infoY);
  
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(10);
  doc.setTextColor(outerSpace);
  doc.text(auditData.agent, col1X + 40, infoY);
  doc.text(auditData.evaluator, col2X + 60, infoY);
  doc.text(auditData.ticket, col3X + 75, infoY);
  doc.text(auditData.date, col4X + 35, infoY);
  y += 25;

  // --- Form Content ---
  auditData.categories.forEach(category => {
    checkPageBreak(40);
    doc.setFillColor(category.color);
    doc.rect(margin, y, PAGE_WIDTH - (margin * 2), 22, 'F');
    doc.setFontSize(10);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(outerSpace); // Black text for visibility
    doc.text(category.name.toUpperCase(), margin + 10, y + 15);
    y += 22;

    category.items.forEach(item => {
        const commentLines = doc.splitTextToSize(item.comment || '(No comment)', PAGE_WIDTH - (margin * 2) - 80);
        const itemHeight = 20 + (commentLines.length * 10);
        checkPageBreak(itemHeight);
        
        y += 18;
        doc.setFontSize(9);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(outerSpace);
        doc.text(item.criterion, margin + 5, y);
        
        doc.setFont('helvetica', 'normal');
        doc.text(item.value, PAGE_WIDTH - margin - 5, y, { align: 'right' });

        if (item.comment) {
            y += 12;
            doc.setFontSize(8);
            doc.setTextColor('#64748b');
            doc.text(commentLines, margin + 5, y);
            y += (commentLines.length - 1) * 10;
        }
        y += 5;
        doc.setDrawColor('#e2e8f0');
        doc.line(margin, y, PAGE_WIDTH - margin, y);
    });
    y += 15;
  });

  if (auditData.notes) {
      const notesLines = doc.splitTextToSize(auditData.notes, PAGE_WIDTH - (margin * 2));
      const notesHeight = 30 + (notesLines.length * 12);
      checkPageBreak(notesHeight);
      y += 10;
      doc.setFontSize(10);
      doc.setFont('helvetica', 'bold');
      doc.setTextColor(outerSpace);
      doc.text('OVERALL NOTES / COACHING POINTS', margin, y);
      y += 15;
      doc.setFontSize(9);
      doc.setFont('helvetica', 'normal');
      doc.setTextColor('#334155');
      doc.text(notesLines, margin, y);
  }

  doc.setPage(doc.internal.getNumberOfPages());
  doc.setFillColor(wattle);
  doc.triangle(0, PAGE_HEIGHT, 0, PAGE_HEIGHT - 80, 80, PAGE_HEIGHT, 'F');
  doc.setFillColor(outerSpace);
  doc.triangle(0, PAGE_HEIGHT - 80, 0, PAGE_HEIGHT - 90, 15, PAGE_HEIGHT - 80, 'F');

  doc.save(`Quality_Audit_${auditData.agent.replace(/\s+/g, '_')}.pdf`);
}

    
    document.addEventListener('DOMContentLoaded', initAuditForm);

  </script>


<script>
    // ===== SCHEDULE DATA & LOGIC =====
    const scheduleData = {
      "Agent 1": { initials: "A1", role: "AGENT", hoursPerWeek: 40, shifts: {}, status: 'active' },
      "Agent 2": { initials: "A2", role: "AGENT", hoursPerWeek: 40, shifts: {}, status: 'pending' },
      "Backup 1": { initials: "B1", role: "Team Lead", hoursPerWeek: 0, shifts: {}, status: 'active' },
      "Backup 2": { initials: "B2", role: "Team Lead", hoursPerWeek: 0, shifts: {}, status: 'active' },
      "Project Mgr.": { initials: "PM", role: "Management", hoursPerWeek: 0, shifts: {}, status: 'active' }
    };

    const roleColors = {
      "AGENT": "cyan-500",
      "Team Lead": "emerald-500",
      "Management": "purple-500"
    };

    function populateSchedules() {
      const year = 2026;
      const month = 0; // January
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dayOfWeek = date.getDay(); // 0=Sun, 1=Mon, ..., 6=Sat
        const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

        // Agent 1 Schedule
        if (dayOfWeek > 0 && dayOfWeek < 6) scheduleData["Agent 1"].shifts[dateString] = "7PM - 4AM";
        else scheduleData["Agent 1"].shifts[dateString] = "OFF";

        // Agent 2 (Pending) and Backup 1 (Covering)
        if (dayOfWeek > 1 && dayOfWeek < 7) { // Tue, Wed, Thu, Fri, Sat
            scheduleData["Agent 2"].shifts[dateString] = "4AM - 1PM";
            scheduleData["Backup 1"].shifts[dateString] = {
                shift: "4AM - 1PM",
                covering: "Agent 2"
            };
        } else { // Sun, Mon
            scheduleData["Agent 2"].shifts[dateString] = "OFF";
        }
        
        // Explicitly handle Backup 1's OFF days (Jan 24 & 25)
        if (date.getDate() === 24 || date.getDate() === 25) {
            scheduleData["Backup 1"].shifts[dateString] = "OFF";
        } else if (scheduleData["Backup 1"].shifts[dateString] === undefined) {
            if (dayOfWeek >= 2 && dayOfWeek <= 6) {
               scheduleData["Backup 1"].shifts[dateString] = "ON-CALL";
            } else {
               scheduleData["Backup 1"].shifts[dateString] = "OFF";
            }
        }

        // Backup 2 Schedule
        if (dayOfWeek > 0 && dayOfWeek < 6) scheduleData["Backup 2"].shifts[dateString] = "ON-CALL";
        else scheduleData["Backup 2"].shifts[dateString] = "OFF";

        // Project Manager Schedule
        if (dayOfWeek > 0) scheduleData["Project Mgr."].shifts[dateString] = "MANAGER";
        else scheduleData["Project Mgr."].shifts[dateString] = "OFF";
      }
    }

    function renderSchedule(baseDate) {
      const monday = new Date(baseDate);
      const dayOfWeek = monday.getDay();
      const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
      monday.setDate(monday.getDate() + diff);

      const tbody = document.getElementById('schedule-tbody');
      if (!tbody) return;
      tbody.innerHTML = '';

      for (const employeeName in scheduleData) {
        const employee = scheduleData[employeeName];
        const roleColor = roleColors[employee.role] || 'slate-500';
        const row = document.createElement('div');
        row.className = 'grid grid-cols-8 border-b border-slate-100 hover:bg-slate-50 transition-colors';
        
        let hoursText = employee.hoursPerWeek > 0 ? `${employee.hoursPerWeek}.00 Hrs/week` : employee.role;

        row.innerHTML = `
          <div class="p-4 border-r border-slate-100 flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-${roleColor} flex items-center justify-center text-white font-bold text-sm">${employee.initials}</div>
            <div>
              <p class="font-semibold text-slate-900 text-sm">${employeeName}</p>
              <p class="text-xs text-slate-500">${hoursText}</p>
            </div>
          </div>
        `;

        for (let i = 0; i < 7; i++) {
          const date = new Date(monday);
          date.setDate(monday.getDate() + i);
          const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
          
          const shiftValue = employee.shifts[dateString] || 'OFF';
          
          const cellDiv = document.createElement('div');
          cellDiv.className = 'p-2 border-r border-slate-100 flex items-center justify-center';
          if (new Date().toDateString() === date.toDateString()) {
              cellDiv.classList.add('bg-blue-50');
          }

          let cellContent;
          const baseClasses = "px-3 py-2 rounded text-xs font-semibold text-center w-full";
          
          if (shiftValue === 'OFF') {
            cellContent = `<div class="bg-slate-100 text-slate-400 ${baseClasses}">OFF</div>`;
          } else if (shiftValue === 'ON-CALL') {
            cellContent = `<div class="bg-emerald-300 text-slate-600 ${baseClasses}">
              <div class="font-bold">ON-CALL</div><div class="text-[10px] opacity-70 mt-1">BACKUP</div>
            </div>`;
          } else if (shiftValue === 'MANAGER') {
            cellContent = `<div class="bg-purple-500 text-white ${baseClasses}">
              <div class="font-bold">MANAGER</div><div class="text-[10px] opacity-90 mt-1">STRATEGY</div>
            </div>`;
          } else if (typeof shiftValue === 'object' && shiftValue.covering) {
            cellContent = `<div class="bg-${roleColor} text-white ${baseClasses}">
              <div class="font-bold">${shiftValue.shift}</div>
              <div class="text-[10px] opacity-90 mt-1">Covering ${shiftValue.covering}</div>
            </div>`;
          } else {
            let bgColor = `bg-${roleColor}`;
            let textColor = 'text-white';
            let border = '';
            if (employee.status === 'pending') {
                bgColor = 'bg-slate-200';
                textColor = 'text-slate-500';
            }
            cellContent = `<div class="${bgColor} ${textColor} ${border} ${baseClasses}">
              <div class="font-bold">${shiftValue}</div><div class="text-[10px] opacity-90 mt-1">${employee.role}</div>
            </div>`;
          }
          cellDiv.innerHTML = cellContent;
          row.appendChild(cellDiv);
        }
        tbody.appendChild(row);
      }
    }

    populateSchedules();
  
    let displayedDate = new Date();

    function renderWeekHeader(baseDate) {
        const today = new Date();
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        const monday = new Date(baseDate);
        const diff = monday.getDay() === 0 ? -6 : 1 - monday.getDay();
        monday.setDate(monday.getDate() + diff);

        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        
        const startMonth = monthNames[monday.getMonth()];
        const startDate = monday.getDate();
        const endMonth = monthNames[sunday.getMonth()];
        const endDate = sunday.getDate();

        let weekRange;
        if (startMonth === endMonth) {
            weekRange = `${startMonth} ${startDate} - ${endDate}`;
        } else {
            weekRange = `${startMonth} ${startDate} - ${endMonth} ${endDate}`;
        }
        document.getElementById('week-range-display').textContent = weekRange;

        document.querySelectorAll('#week-header [data-day]').forEach((cell, index) => {
            const date = new Date(monday);
            date.setDate(monday.getDate() + index);
            const isToday = date.toDateString() === today.toDateString();
            cell.className = 'p-4 text-center border-r border-slate-200';
            if (isToday) cell.classList.add('bg-blue-50');

            cell.innerHTML = `
            <p class="text-xs font-semibold ${isToday ? 'text-blue-600' : 'text-slate-500'} uppercase tracking-wide">
                ${isToday ? 'TODAY' : dayNames[date.getDay()].toUpperCase()}
            </p>
            <p class="text-2xl font-bold ${isToday ? 'text-blue-600' : 'text-slate-900'} mt-1">
                ${date.getDate()}
            </p>`;
        });
    }

    function parseShiftDuration(shiftString) {
      if (!shiftString || shiftString === "OFF" || !shiftString.includes('-')) return 0;
      try {
        const [startStr, endStr] = shiftString.split(' - ');
        const start = { hour: parseInt(startStr.match(/\d+/)[0]), ampm: startStr.match(/[AP]M/)[0] };
        const end = { hour: parseInt(endStr.match(/\d+/)[0]), ampm: endStr.match(/[AP]M/)[0] };
        
        let startHour = start.hour === 12 ? (start.ampm === 'AM' ? 0 : 12) : (start.ampm === 'PM' ? start.hour + 12 : start.hour);
        let endHour = end.hour === 12 ? (end.ampm === 'AM' ? 0 : 12) : (end.ampm === 'PM' ? end.hour + 12 : end.hour);

        if (endHour <= startHour) endHour += 24;
        const duration = endHour - startHour;
        return duration > 1 ? duration - 1 : duration;
      } catch (e) {
        return 0;
      }
    }

    function updateScheduleSummary(baseDate) {
        const monday = new Date(baseDate);
        const diff = monday.getDay() === 0 ? -6 : 1 - monday.getDay();
        monday.setDate(monday.getDate() + diff);

        let totalHours = 0;
        const employeesWithShifts = new Set();
        const backupOnCall = new Set();

        for (let i = 0; i < 7; i++) {
            const date = new Date(monday);
            date.setDate(monday.getDate() + i);
            const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;

            for (const employeeName in scheduleData) {
                const employee = scheduleData[employeeName];
                const shift = employee.shifts[dateString];

                if (shift && shift !== 'OFF') {
                    employeesWithShifts.add(employeeName);

                    let shiftString = shift;
                    if(typeof shift === 'object' && shift.shift) {
                        shiftString = shift.shift;
                    }
                    
                    if (employee.status === 'pending') {
                        // Hours for pending agents are not counted unless someone is covering.
                        // The covering employee's hours will be counted instead.
                    } else if (employee.role === 'AGENT' || (employee.role === 'Team Lead' && typeof shift === 'object' && shift.covering)) {
                         const duration = parseShiftDuration(shiftString);
                        totalHours += duration;
                    }

                    if (employee.role === 'Team Lead' && shift === 'ON-CALL') {
                        backupOnCall.add(employeeName);
                    }
                }
            }
        }
        
        const activeEmployees = new Set();
        employeesWithShifts.forEach(name => {
            if(scheduleData[name].status !== 'pending') {
                activeEmployees.add(name);
            }
        });

        const roleCounts = { "AGENT": 0, "Team Lead": 0, "Management": 0 };
        activeEmployees.forEach(name => {
            const employee = scheduleData[name];
            if(roleCounts[employee.role] !== undefined) {
                 roleCounts[employee.role]++;
            }
        });
        
        document.getElementById('summary-total-hours').textContent = totalHours.toFixed(1);
        document.getElementById('summary-active-employees').textContent = activeEmployees.size;
        document.getElementById('summary-active-subtitle').textContent = `${roleCounts['AGENT']} Agent, ${roleCounts['Team Lead']} TL, ${roleCounts['Management']} PM`;
        document.getElementById('summary-backup-coverage').textContent = backupOnCall.size;
    }

    function nextWeek() {
        displayedDate.setDate(displayedDate.getDate() + 7);
        renderWeekHeader(displayedDate);
        renderSchedule(displayedDate);
        updateScheduleSummary(displayedDate);
    }

    function prevWeek() {
        displayedDate.setDate(displayedDate.getDate() - 7);
        renderWeekHeader(displayedDate);
        renderSchedule(displayedDate);
        updateScheduleSummary(displayedDate);
    }

    function goToToday() {
        displayedDate = new Date();
        renderWeekHeader(displayedDate);
        renderSchedule(displayedDate);
        updateScheduleSummary(displayedDate);
    }

    const originalOnViewChange = window.onViewChange;
    window.onViewChange = function(viewId) {
      if(originalOnViewChange) originalOnViewChange(viewId);
      if (viewId === 'schedule') {
        renderWeekHeader(displayedDate);
        renderSchedule(displayedDate);
        updateScheduleSummary(displayedDate);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (document.getElementById('view-schedule') && !document.getElementById('view-schedule').classList.contains('hidden')) {
        renderWeekHeader(displayedDate);
        renderSchedule(displayedDate);
        updateScheduleSummary(displayedDate);
      }
    });
</script>

<script>
  // ===== LOGIN & RBAC LOGIC =====
  const users = {
    'user@tsukiglass.com': { password: 'password', role: 'agent' },
    'lead@tsukiglass.com': { password: 'password', role: 'lead' },
    'manager@tsukiglass.com': { password: 'password', role: 'admin' }
  };

  let currentUserRole = null;

  function applyRBAC(role) {
    const allButtons = ['btn-dashboard', 'btn-agents', 'btn-knowledge', 'btn-quality', 'btn-schedule', 'btn-settings', 'btn-training'];
    const agentButtons = ['btn-dashboard', 'btn-agents', 'btn-knowledge'];
    const leadButtons = ['btn-dashboard', 'btn-agents', 'btn-knowledge', 'btn-quality', 'btn-schedule', 'btn-training'];
    const systemsLabel = document.getElementById('systems-label');
    
    // Hide all buttons first
    allButtons.forEach(id => {
      const button = document.getElementById(id);
      if (button) button.style.display = 'none';
    });
    if(systemsLabel) systemsLabel.style.display = 'none';


    let visibleButtons = [];
    let defaultView = 'dashboard';

    switch (role) {
      case 'agent':
        visibleButtons = agentButtons;
        defaultView = 'agents';
        if(systemsLabel) systemsLabel.style.display = 'none';
        break;
      case 'lead':
        visibleButtons = leadButtons;
        if(systemsLabel) systemsLabel.style.display = 'block';
        break;
      case 'admin':
        visibleButtons = allButtons;
        if(systemsLabel) systemsLabel.style.display = 'block';
        break;
    }

    // Show buttons based on role
    visibleButtons.forEach(id => {
      const button = document.getElementById(id);
      if (button) button.style.display = 'flex';
    });

    // Set initial view
    setView(defaultView);
  }

  function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const errorEl = document.getElementById('login-error');

    const user = users[email];

    if (user) {
        // Bypass password check for agent role
        if (user.role === 'agent') {
            currentUserRole = user.role;
            
            document.getElementById('view-login').style.display = 'none';
            document.querySelector('aside').style.display = 'flex';
            document.querySelector('main').style.display = 'block';
            
            applyRBAC(currentUserRole);
            errorEl.classList.add('hidden');
        } else if (user.password === password) {
            currentUserRole = user.role;
            
            document.getElementById('view-login').style.display = 'none';
            document.querySelector('aside').style.display = 'flex';
            document.querySelector('main').style.display = 'block';
            
            applyRBAC(currentUserRole);
            errorEl.classList.add('hidden');
        } else {
            errorEl.classList.remove('hidden');
        }
    } else {
        errorEl.classList.remove('hidden');
    }
  }

  function logout() {
      currentUserRole = null;
      
      document.getElementById('view-login').style.display = 'flex';
      document.querySelector('aside').style.display = 'none';
      document.querySelector('main').style.display = 'none';
      
      const systemsLabel = document.getElementById('systems-label');
      if (systemsLabel) {
          systemsLabel.style.display = 'block';
      }

      document.getElementById('email').value = 'user@tsukiglass.com';
      document.getElementById('password').value = '';
  }

  document.addEventListener('DOMContentLoaded', function() {
    const emailInput = document.getElementById('email');
    if (emailInput) {
        emailInput.value = 'user@tsukiglass.com';
    }
    
    document.getElementById('login-form').addEventListener('submit', handleLogin);
    
    initScheduleEditing();
    initAuditForm();
    lucide.createIcons();
  });
</script>
</body>
</html>