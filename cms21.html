<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BPO Dashboard â€” Ops & Knowledge Base</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // General Colors
                        brand: '#CBEB33',
                        brandlight: '#D9F25A',
                        blackpearl: '#04101d', // Dark background for dark mode
                        primary: '#1f2937', // Dark card/surface for dark mode
                        secondary: '#4b5563', // Border/Accent dark mode
                        
                        // Light Mode Colors
                        pear: '#e5e7eb', // Light background
                        waterloo: '#565f6f',
                        wasabi: '#2c370b',
                        
                        // New/Updated Colors
                        'bg-dark-main': '#0f172a',
                        'text-dark-main': '#f1f5f9',
                        'bg-light-main': '#f8fafc',
                        'text-light-main': '#1e293b',
                    }
                }
            }
        };
    </script>
    <style>
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .nav-link.active-link {
            background-color: #D9F25A;
            /* brandlight */
            color: #04101d;
            /* blackpearl */
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }

        /* Loading Spinner Animation */
        .animate-spin-slow {
            animation: spin 2.5s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Table scrollbar hide */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body
    class="min-h-screen bg-bg-light-main text-text-light-main dark:bg-bg-dark-main dark:text-text-dark-main transition-colors duration-500 font-sans pt-20">

    <!-- CRITICAL: REPLACE THIS WITH YOUR DEPLOYED APPS SCRIPT URL -->
    <script>
        const BPO_DASHBOARD_API_URL = "YOUR_APPS_SCRIPT_WEB_APP_URL_HERE";
        
        // Global State
        let allCoachingSessions = [];
        let allIRNTESessions = [];
        let allSOPDocuments = []; // NEW
        let allToolsList = []; // NEW
        
        let coachingSessionToEdit = null;
        let irnteRecordToEdit = null;
    </script>


    <!-- Header Section -->
    <header
        class="flex flex-col md:flex-row justify-between items-start md:items-center px-4 md:px-8 py-4 bg-white dark:bg-primary shadow-xl w-full fixed top-0 left-0 z-20 transition-all duration-500 border-b border-gray-100 dark:border-secondary/50">
        <h1 class="text-3xl font-extrabold text-text-light-main dark:text-text-dark-main transition-colors duration-500 mb-4 md:mb-0">
            <span class="text-brand">Digital Minds</span> BPO Dashboard
        </h1>

        <!-- Navigation Links -->
        <nav class="flex space-x-2 md:space-x-4 overflow-x-auto no-scrollbar pb-1">
            <a href="#" data-page="coaching"
                class="nav-link active-link flex items-center px-4 py-2 rounded-full text-sm transition transform hover:scale-[1.03] hover:bg-brandlight hover:text-blackpearl">
                <i class="fas fa-bullhorn mr-2"></i>Coaching Log
            </a>
            <a href="#" data-page="irnte"
                class="nav-link flex items-center px-4 py-2 rounded-full text-sm transition transform hover:scale-[1.03] hover:bg-brandlight hover:text-blackpearl">
                <i class="fas fa-file-contract mr-2"></i>IR / NTE Log
            </a>
            <a href="#" data-page="sop"
                class="nav-link flex items-center px-4 py-2 rounded-full text-sm transition transform hover:scale-[1.03] hover:bg-brandlight hover:text-blackpearl">
                <i class="fas fa-book-open mr-2"></i>SOP
            </a>
            <a href="#" data-page="tools"
                class="nav-link flex items-center px-4 py-2 rounded-full text-sm transition transform hover:scale-[1.03] hover:bg-brandlight hover:text-blackpearl">
                <i class="fas fa-wrench mr-2"></i>Tools
            </a>
            <!-- Theme Toggle -->
            <button id="themeToggle"
                class="p-2 rounded-full text-text-light-main dark:text-text-dark-main bg-gray-100 dark:bg-secondary hover:bg-brand hover:text-blackpearl transition-all duration-300 transform hover:scale-105"
                aria-label="Toggle Dark Mode">
            </button>
        </nav>
    </header>

    <main class="max-w-8xl mx-auto p-4 md:p-8 space-y-8">

        <!-- Global Loading/Status Modal -->
        <div id="loadingModal"
            class="hidden fixed inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center z-50">
            <div class="relative flex items-center justify-center">
                <div
                    class="w-16 h-16 border-4 border-gray-300 dark:border-secondary border-t-brand rounded-full animate-spin">
                </div>
                <div
                    class="absolute w-10 h-10 border-4 border-gray-200 dark:border-gray-700 border-b-brandlight rounded-full animate-spin-slow">
                </div>
            </div>
            <p id="loadingText" class="mt-4 text-brand text-lg font-semibold">Processing...</p>
        </div>

        <!-- Coaching Log Section -->
        <div class="page-section active" id="coaching">
            <h2 class="text-3xl font-extrabold mb-6">Coaching Log Management</h2>
            <!-- Existing Coaching content... -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 mb-6">
                <input type="text" id="coachingSearch" placeholder="Search by Employee, Coach, or Topic..."
                    class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brand focus:border-brand dark:bg-primary dark:border-secondary dark:text-text-dark-main transition duration-150"
                    onkeyup="handleCoachingSearch()">
                <button onclick="openCoachingModal()"
                    class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-300 transform hover:scale-[1.03] text-lg">
                    <i class="fas fa-plus-circle mr-3"></i>New Coaching Session
                </button>
            </div>
            <div class="bg-white dark:bg-primary rounded-2xl shadow-2xl overflow-hidden transition-colors duration-500 border border-gray-100 dark:border-secondary relative">
                <div id="coachingLoadingSpinner"
                    class="absolute inset-0 bg-white/80 dark:bg-primary/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl hidden">
                    <!-- Spinner content goes here -->
                    <i class="fas fa-spinner fa-spin fa-3x text-brand"></i>
                </div>
                <div class="overflow-x-auto no-scrollbar max-h-[70vh]">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-secondary text-left sticky top-0 z-10 text-gray-700 dark:text-text-dark-main">
                            <tr>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">ID</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Date</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Employee</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Coach</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Topic/Issue</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Status</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="coachingSessionsTable" class="divide-y divide-gray-200 dark:divide-secondary/50">
                            <tr><td colspan="7" class="text-center py-6 text-gray-500 dark:text-gray-400">Loading coaching data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Coaching Modal and Delete Modal placeholders (removed to keep file concise, assumed to exist/be implemented below in script) -->
        </div>

        <!-- IR / NTE Log Section -->
        <div class="page-section" id="irnte">
            <h2 class="text-3xl font-extrabold mb-6">IR / NTE Log Management</h2>
            <!-- Existing IR/NTE content... -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 mb-6">
                <input type="text" id="irnteSearch" placeholder="Search by Employee, Code, or Campaign..."
                    class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brand focus:border-brand dark:bg-primary dark:border-secondary dark:text-text-dark-main transition duration-150"
                    onkeyup="handleIRNTESearch()">
                <button onclick="openIRNTEModal()"
                    class="inline-flex items-center bg-brand hover:bg-brandlight text-blackpearl px-6 py-3 rounded-full shadow-lg font-bold transition duration-300 transform hover:scale-[1.03] text-lg">
                    <i class="fas fa-plus-circle mr-3"></i>File New IR / NTE
                </button>
            </div>
            <div class="bg-white dark:bg-primary rounded-2xl shadow-2xl overflow-hidden transition-colors duration-500 border border-gray-100 dark:border-secondary relative">
                <div id="irnteLoadingSpinner"
                    class="absolute inset-0 bg-white/80 dark:bg-primary/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl hidden">
                    <!-- Spinner content goes here -->
                    <i class="fas fa-spinner fa-spin fa-3x text-brand"></i>
                </div>
                <div class="overflow-x-auto no-scrollbar max-h-[70vh]">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-secondary text-left sticky top-0 z-10 text-gray-700 dark:text-text-dark-main">
                            <tr>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">ID</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Date Filed</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Employee Name</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">NTE/IR Code</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4">Decision (HR)</th>
                                <th class="font-semibold uppercase tracking-wider text-center px-6 py-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="irnteSessionsTable" class="divide-y divide-gray-200 dark:divide-secondary/50">
                            <tr><td colspan="6" class="text-center py-6 text-gray-500 dark:text-gray-400">Loading IR/NTE data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- IR/NTE Modal and Delete Modal placeholders (removed to keep file concise) -->
        </div>
        
        <!-- SOP Documents Section (NEW) -->
        <div class="page-section" id="sop">
            <h2 class="text-3xl font-extrabold mb-6">Standard Operating Procedures (SOP)</h2>
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 mb-6">
                <input type="text" id="sopSearch" placeholder="Search SOP by Document Name or Description..."
                    class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brand focus:border-brand dark:bg-primary dark:border-secondary dark:text-text-dark-main transition duration-150"
                    onkeyup="handleSOPSearch()">
            </div>
            <div class="bg-white dark:bg-primary rounded-2xl shadow-2xl overflow-hidden transition-colors duration-500 border border-gray-100 dark:border-secondary relative">
                <div id="sopLoadingSpinner"
                    class="absolute inset-0 bg-white/80 dark:bg-primary/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl hidden">
                    <!-- Spinner content goes here -->
                    <i class="fas fa-spinner fa-spin fa-3x text-brand"></i>
                </div>
                <div class="overflow-x-auto no-scrollbar max-h-[70vh]">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-secondary text-left sticky top-0 z-10 text-gray-700 dark:text-text-dark-main">
                            <tr>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4 w-1/12">ID</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4 w-4/12">Document Name</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4 w-6/12">Description</th>
                                <th class="font-semibold uppercase tracking-wider text-center px-6 py-4 w-1/12">Link</th>
                            </tr>
                        </thead>
                        <tbody id="sopDocumentsTable" class="divide-y divide-gray-200 dark:divide-secondary/50">
                            <tr><td colspan="4" class="text-center py-6 text-gray-500 dark:text-gray-400">Loading SOP data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tools List Section (NEW) -->
        <div class="page-section" id="tools">
            <h2 class="text-3xl font-extrabold mb-6">Quick Tools & Work Instructions</h2>
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 mb-6">
                <input type="text" id="toolsSearch" placeholder="Search Tools by Name or Description..."
                    class="p-3 border border-gray-300 rounded-lg w-full max-w-lg focus:ring-brand focus:border-brand dark:bg-primary dark:border-secondary dark:text-text-dark-main transition duration-150"
                    onkeyup="handleToolsSearch()">
            </div>
            <div class="bg-white dark:bg-primary rounded-2xl shadow-2xl overflow-hidden transition-colors duration-500 border border-gray-100 dark:border-secondary relative">
                <div id="toolsLoadingSpinner"
                    class="absolute inset-0 bg-white/80 dark:bg-primary/80 backdrop-blur-sm flex justify-center items-center z-40 rounded-xl hidden">
                    <!-- Spinner content goes here -->
                    <i class="fas fa-spinner fa-spin fa-3x text-brand"></i>
                </div>
                <div class="overflow-x-auto no-scrollbar max-h-[70vh]">
                    <table class="min-w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-secondary text-left sticky top-0 z-10 text-gray-700 dark:text-text-dark-main">
                            <tr>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4 w-1/12">ID</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4 w-3/12">Tool Name</th>
                                <th class="font-semibold uppercase tracking-wider px-6 py-4 w-5/12">Description</th>
                                <th class="font-semibold uppercase tracking-wider text-center px-6 py-4 w-1/12">URL</th>
                                <th class="font-semibold uppercase tracking-wider text-center px-6 py-4 w-1/12">WI Link</th>
                            </tr>
                        </thead>
                        <tbody id="toolsListTable" class="divide-y divide-gray-200 dark:divide-secondary/50">
                            <tr><td colspan="5" class="text-center py-6 text-gray-500 dark:text-gray-400">Loading Tools data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>
    
    <!-- Modals for Coaching and IR/NTE (Included for completeness but content omitted for brevity) -->
    <!-- You should keep your existing Modal definitions here (e.g., #coachingCrudModal, #irnteCrudModal) -->


    <script>
        feather.replace(); // Initialize feather icons

        // Helper function to handle global loading state
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text || "Processing...";
            document.getElementById('loadingModal').classList.remove('hidden');
            document.getElementById('loadingModal').classList.add('flex');
        }

        function hideLoading() {
            document.getElementById('loadingModal').classList.add('hidden');
            document.getElementById('loadingModal').classList.remove('flex');
        }
        
        // Helper to format date strings
        function formatDate(dateString) {
            if (!dateString) return "N/A";
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return dateString;
                return `${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getDate()).padStart(2, '0')}/${date.getFullYear()}`;
            } catch (e) {
                return dateString;
            }
        }

        // Helper to render a link icon
        function renderUrlIcon(url, title = 'Open Link') {
            const isValidUrl = url && url.length > 5 && url !== '#';
            const iconClass = isValidUrl ? 'text-brand hover:text-brandlight' : 'text-gray-400 cursor-default';
            return `<a href="${isValidUrl ? url : '#'}" target="_blank" class="${iconClass} transition" onclick="${!isValidUrl ? 'event.preventDefault()' : ''}" title="${title}">
                        <i class="fas fa-external-link-alt"></i>
                    </a>`;
        }

        /* ------------------ THEME TOGGLE ------------------ */

        const toggleBtn = document.getElementById('themeToggle');

        function setTheme(isDark) {
            if (isDark) {
                document.documentElement.classList.add("dark");
                localStorage.setItem("theme", "dark");
                toggleBtn.innerHTML = feather.icons.sun.toSvg({ class: 'w-5 h-5' });
            } else {
                document.documentElement.classList.remove("dark");
                localStorage.setItem("theme", "light");
                toggleBtn.innerHTML = feather.icons.moon.toSvg({ class: 'w-5 h-5' });
            }
        }

        if (localStorage.getItem("theme") === "dark" || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            setTheme(true);
        } else {
            setTheme(false);
        }

        toggleBtn.addEventListener('click', () => {
            const isDark = document.documentElement.classList.contains('dark');
            setTheme(!isDark);
        });

        /* ------------------ NAVIGATION & INITIAL LOAD ------------------ */

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('active-link'));
                this.classList.add('active-link');

                document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
                const pageId = this.dataset.page;
                document.getElementById(pageId).classList.add('active');

                // Handle data loading based on the navigated page
                if (pageId === 'coaching') {
                    if (allCoachingSessions.length === 0) {
                        loadCoachingSessions();
                    } else {
                        renderCoachingTable(allCoachingSessions);
                    }
                } else if (pageId === 'irnte') {
                    if (allIRNTESessions.length === 0) {
                        loadIRNTE();
                    } else {
                        renderIRNTETable(allIRNTESessions);
                    }
                } else if (pageId === 'sop') { // NEW
                    if (allSOPDocuments.length === 0) {
                        loadSOP();
                    } else {
                        renderSOPTable(allSOPDocuments);
                    }
                } else if (pageId === 'tools') { // NEW
                    if (allToolsList.length === 0) {
                        loadTools();
                    } else {
                        renderToolsTable(allToolsList);
                    }
                }
            });
        });

        // Initial load check for the default active tab
        document.addEventListener("DOMContentLoaded", () => {
            if (document.getElementById('coaching').classList.contains('active')) {
                loadCoachingSessions();
            }
            // Add checks for other pages if you change the default active tab later
        });


        /* ------------------ CORE DATA FETCHING FUNCTIONS ------------------ */

        async function fetchDashboardData(action, spinnerId, targetArray, renderFunction) {
            const spinner = document.getElementById(spinnerId);
            const tableBody = document.getElementById(spinnerId.replace('LoadingSpinner', 'sTable') || spinnerId.replace('LoadingSpinner', 'ListTable'));
            if (!BPO_DASHBOARD_API_URL || BPO_DASHBOARD_API_URL === "YOUR_APPS_SCRIPT_WEB_APP_URL_HERE") {
                 tableBody.innerHTML = `<tr><td colspan="10" class="text-center py-6 text-red-500 font-semibold">Error: API URL not set. Please update BPO_DASHBOARD_API_URL in the script.</td></tr>`;
                 return;
            }

            spinner.classList.remove('hidden');

            try {
                const fetchUrl = BPO_DASHBOARD_API_URL + '?action=' + action;
                const res = await fetch(fetchUrl);
                const data = await res.json();

                if (data.status === "ERROR" || !Array.isArray(data)) {
                    throw new Error(data.message || "Invalid data structure returned from API.");
                }

                targetArray.splice(0, targetArray.length, ...data); // Replace content of the global array
                renderFunction(targetArray);

            } catch (error) {
                console.error(`Error loading data for ${action}:`, error);
                const errorMessage = `Failed to load data. (Error: ${error.message})`;
                tableBody.innerHTML = `<tr><td colspan="10" class="text-center py-6 text-red-500 dark:text-red-400 font-semibold">${errorMessage}</td></tr>`;
            }
            spinner.classList.add('hidden');
        }

        /* ------------------ SOP FUNCTIONS (NEW) ------------------ */

        function loadSOP() {
            fetchDashboardData('getSOP', 'sopLoadingSpinner', allSOPDocuments, renderSOPTable);
        }

        function renderSOPTable(documentsToRender) {
            const table = document.getElementById("sopDocumentsTable");
            table.innerHTML = "";

            if (!Array.isArray(documentsToRender) || documentsToRender.length === 0) {
                table.innerHTML = `<tr><td colspan="4" class="text-center py-6 text-gray-500 dark:text-gray-400">No SOP documents found.</td></tr>`;
                return;
            }

            documentsToRender.forEach(doc => {
                table.innerHTML += `
                    <tr class="text-gray-700 dark:text-gray-300 border-b dark:border-secondary/50 hover:bg-gray-50 dark:hover:bg-primary/50 transition duration-150">
                        <td class="px-6 py-4">${doc.id || "N/A"}</td>
                        <td class="px-6 py-4 font-medium">${doc.documentName || "N/A"}</td>
                        <td class="px-6 py-4">${doc.description || "No description provided."}</td>
                        <td class="px-6 py-4 text-center">
                            ${renderUrlIcon(doc.driveLink, 'Open Google Drive Document')}
                        </td>
                    </tr>`;
            });
        }

        function handleSOPSearch() {
            const query = document.getElementById('sopSearch').value.toLowerCase().trim();
            if (!query) {
                renderSOPTable(allSOPDocuments);
                return;
            }

            const filteredDocs = allSOPDocuments.filter(doc => {
                return (doc.documentName && doc.documentName.toLowerCase().includes(query)) ||
                    (doc.description && doc.description.toLowerCase().includes(query));
            });

            renderSOPTable(filteredDocs);
        }

        /* ------------------ TOOLS FUNCTIONS (NEW) ------------------ */

        function loadTools() {
            fetchDashboardData('getTools', 'toolsLoadingSpinner', allToolsList, renderToolsTable);
        }

        function renderToolsTable(toolsToRender) {
            const table = document.getElementById("toolsListTable");
            table.innerHTML = "";

            if (!Array.isArray(toolsToRender) || toolsToRender.length === 0) {
                table.innerHTML = `<tr><td colspan="5" class="text-center py-6 text-gray-500 dark:text-gray-400">No tools information found.</td></tr>`;
                return;
            }

            toolsToRender.forEach(tool => {
                table.innerHTML += `
                    <tr class="text-gray-700 dark:text-gray-300 border-b dark:border-secondary/50 hover:bg-gray-50 dark:hover:bg-primary/50 transition duration-150">
                        <td class="px-6 py-4">${tool.id || "N/A"}</td>
                        <td class="px-6 py-4 font-medium">${tool.toolName || "N/A"}</td>
                        <td class="px-6 py-4">${tool.description || "No description provided."}</td>
                        <td class="px-6 py-4 text-center">
                            ${renderUrlIcon(tool.url, 'Open Tool Website')}
                        </td>
                        <td class="px-6 py-4 text-center">
                            ${renderUrlIcon(tool.wiLink, 'Open Work Instruction Document')}
                        </td>
                    </tr>`;
            });
        }

        function handleToolsSearch() {
            const query = document.getElementById('toolsSearch').value.toLowerCase().trim();
            if (!query) {
                renderToolsTable(allToolsList);
                return;
            }

            const filteredTools = allToolsList.filter(tool => {
                return (tool.toolName && tool.toolName.toLowerCase().includes(query)) ||
                    (tool.description && tool.description.toLowerCase().includes(query));
            });

            renderToolsTable(filteredTools);
        }
        
        /* ------------------ Coaching & IR/NTE Placeholder Functions (Retained from previous files) ------------------ */
        
        // ** NOTE: The full implementation of the Coaching/IRNTE CRUD modals and submission handlers are omitted here
        // ** for file size/brevity, but should be included in your final working file. **
        
        // Placeholder for existing coaching functions (replace with your full functions)
        function loadCoachingSessions() { fetchDashboardData('getCoachingSessions', 'coachingLoadingSpinner', allCoachingSessions, renderCoachingTable); }
        function renderCoachingTable(sessions) {
             const table = document.getElementById("coachingSessionsTable");
             table.innerHTML = "";
             if (sessions.length === 0) { table.innerHTML = `<tr><td colspan="7" class="text-center py-6 text-gray-500 dark:text-gray-400">No coaching sessions found.</td></tr>`; return; }
             sessions.forEach(session => {
                 table.innerHTML += `
                     <tr class="text-gray-700 dark:text-gray-300 border-b dark:border-secondary/50 hover:bg-gray-50 dark:hover:bg-primary/50 transition duration-150">
                         <td class="px-6 py-4">${session.id}</td>
                         <td class="px-6 py-4 whitespace-nowrap">${formatDate(session.date)}</td>
                         <td class="px-6 py-4 font-medium">${session.employeeName}</td>
                         <td class="px-6 py-4">${session.coachedBy}</td>
                         <td class="px-6 py-4">${session.topic.substring(0, 50)}...</td>
                         <td class="px-6 py-4">${session.status}</td>
                         <td class="px-6 py-4"><button onclick="openCoachingModal(${session.id})" class="text-brand hover:underline">Edit</button></td>
                     </tr>`;
             });
        }
        function handleCoachingSearch() { /* Implementation retained */ }
        function openCoachingModal(id) { /* Implementation retained */ }

        // Placeholder for existing IR/NTE functions (replace with your full functions)
        function loadIRNTE() { fetchDashboardData('getIRNTE', 'irnteLoadingSpinner', allIRNTESessions, renderIRNTETable); }
        function renderIRNTETable(records) {
             const table = document.getElementById("irnteSessionsTable");
             table.innerHTML = "";
             if (records.length === 0) { table.innerHTML = `<tr><td colspan="6" class="text-center py-6 text-gray-500 dark:text-gray-400">No IR/NTE records found.</td></tr>`; return; }
             records.forEach(record => {
                 table.innerHTML += `
                     <tr class="text-gray-700 dark:text-gray-300 border-b dark:border-secondary/50 hover:bg-gray-50 dark:hover:bg-primary/50 transition duration-150">
                         <td class="px-6 py-4">${record.id}</td>
                         <td class="px-6 py-4 whitespace-nowrap">${formatDate(record.dateFiled)}</td>
                         <td class="px-6 py-4 font-medium">${record.employeeName}</td>
                         <td class="px-6 py-4">${record.codeNumber}</td>
                         <td class="px-6 py-4">${record.decisionHR}</td>
                         <td class="px-6 py-4"><button onclick="openIRNTEModal(${record.id})" class="text-brand hover:underline">Edit</button></td>
                     </tr>`;
             });
        }
        function handleIRNTESearch() { /* Implementation retained */ }
        function openIRNTEModal(id) { /* Implementation retained */ }
    </script>

</body>

</html>
