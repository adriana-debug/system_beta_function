<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KPI Dashboard</title>
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // Enables dark mode based on the 'dark' class on <html>
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'], // Using Inter for a modern look
                    },
                    colors: {
                        'google-blue': '#4285F4',
                        'google-green': '#34A853',
                        'google-red': '#EA4335',
                        'google-yellow': '#FBBC05',
                        'primary-dark': '#1e293b', // slate-800
                        'secondary-dark': '#334155', // slate-700
                        'bg-light': '#f8fafc', // slate-50
                        'text-light': '#0f172a', // slate-900
                    },
                },
            },
        };
    </script>
    <style>
        /* Custom scrollbar for better aesthetics in dark mode */
        body::-webkit-scrollbar {
            width: 8px;
        }

        body::-webkit-scrollbar-thumb {
            background-color: #94a3b8; /* slate-400 */
            border-radius: 4px;
        }

        .dark body::-webkit-scrollbar-thumb {
            background-color: #64748b; /* slate-600 */
        }

        .active-tab {
            border-bottom-width: 3px;
            font-weight: 600;
        }

        .active-tab-content {
            display: block !important;
        }

        .table-tab {
            display: none;
        }

        /* NEW: Sticky Table Header CSS */
        #details-tab thead {
            position: sticky;
            top: 0;
            z-index: 10; /* Ensure the header is above the scrolling content */
        }
    </style>
</head>

<body class="bg-bg-light text-text-light dark:bg-primary-dark dark:text-gray-100 transition-colors duration-300 min-h-screen font-sans">

    <!-- Global Loading Indicator -->
    <div id="global-loading" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-google-blue"></div>
    </div>

    <!-- Main Application Container -->
    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="flex justify-between items-center pb-6 border-b border-gray-200 dark:border-secondary-dark mb-6">
            <h1 id="header-title" class="text-3xl sm:text-4xl font-extrabold text-google-blue dark:text-white transition-colors duration-300">
                KPI Dashboard
            </h1>
            <!-- Dark Mode Toggle -->
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-secondary-dark transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-google-blue">
                <span id="theme-icon" class="material-symbols-outlined text-gray-700 dark:text-gray-300 text-2xl">dark_mode</span>
            </button>
        </header>

        <!-- Tab Navigation -->
        <nav class="flex space-x-4 border-b border-gray-200 dark:border-secondary-dark mb-6">
            <button data-target="summary-tab" class="tab-button active-tab pb-3 text-lg text-gray-600 dark:text-gray-300 border-google-blue dark:border-google-blue hover:text-google-blue transition-all duration-200" onclick="showTab('summary-tab')">
                Summary
            </button>
            <button data-target="details-tab" class="tab-button pb-3 text-lg text-gray-600 dark:text-gray-300 border-transparent hover:border-google-blue hover:text-google-blue transition-all duration-200" onclick="showTab('details-tab')">
                Detailed Records
            </button>
        </nav>

        <!-- Content Area: Summary Tab -->
        <div id="summary-tab" class="table-tab active-tab-content">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Key Performance Indicators</h2>
            <div id="kpi-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- KPI Cards will be injected here -->
            </div>
        </div>

        <!-- Content Area: Details Tab (Modified for Sticky Header) -->
        <div id="details-tab" class="table-tab">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200">All Data Records</h2>
            
            <!-- Added max-h-96 and overflow-y-auto to enable vertical scrolling and trigger sticky header -->
            <div class="bg-white dark:bg-secondary-dark rounded-xl shadow-lg p-4 overflow-x-auto overflow-y-auto max-h-96">
                
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
                    <thead class="bg-gray-50 dark:bg-secondary-dark/70">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Metric</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Value</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Category</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Date</th>
                            <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-white dark:bg-secondary-dark divide-y divide-gray-200 dark:divide-gray-600">
                        <!-- Table rows will be injected here -->
                    </tbody>
                </table>
                <div id="empty-table-message" class="py-10 text-center text-gray-500 dark:text-gray-400 hidden">
                    No records found.
                </div>
            </div>
        </div>

        <!-- Custom Modal for Alerts/Confirmations (Replaces alert() and confirm()) -->
        <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-primary-dark rounded-xl shadow-2xl w-full max-w-sm m-4 p-6 transition-transform transform scale-100">
                <h3 id="modal-title" class="text-xl font-bold mb-3 text-google-blue dark:text-white"></h3>
                <p id="modal-message" class="text-gray-700 dark:text-gray-300 mb-6"></p>
                <div id="modal-actions" class="flex justify-end space-x-3">
                    <!-- Buttons injected by JS -->
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        // Global utilities
        const body = document.body;
        const globalLoading = document.getElementById('global-loading');
        const modal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalActions = document.getElementById('modal-actions');

        // --- Mock Data ---
        // Added extra records to ensure the table scrolls and the sticky header is visible.
        const mockRecords = [
            { id: 1, metric: 'Revenue', value: 125000, category: 'Finance', date: '2025-10-01' },
            { id: 2, metric: 'New Users', value: 3200, category: 'Acquisition', date: '2025-10-02' },
            { id: 3, metric: 'Conversion Rate', value: 4.5, category: 'Engagement', date: '2025-10-03' },
            { id: 4, metric: 'Support Tickets', value: 85, category: 'Service', date: '2025-10-04' },
            { id: 5, metric: 'Monthly Active Users', value: 95000, category: 'Engagement', date: '2025-10-05' },
            { id: 6, metric: 'Churn Rate', value: 1.2, category: 'Finance', date: '2025-10-06' },
            { id: 7, metric: 'Site Visits', value: 180000, category: 'Acquisition', date: '2025-10-07' },
            { id: 8, metric: 'Average Order Value', value: 55, category: 'Finance', date: '2025-10-08' },
            { id: 9, metric: 'Bounce Rate', value: 45.2, category: 'Engagement', date: '2025-10-09' },
            { id: 10, metric: 'Closed Tickets', value: 550, category: 'Service', date: '2025-10-10' },
            { id: 11, metric: 'Email CTR', value: 8.9, category: 'Acquisition', date: '2025-10-11' },
            { id: 12, metric: 'Customer Acquisition Cost (CAC)', value: 15.5, category: 'Finance', date: '2025-10-12' },
            { id: 13, metric: 'Daily Active Users (DAU)', value: 12000, category: 'Engagement', date: '2025-10-13' },
            { id: 14, metric: 'Monthly Recurring Revenue (MRR)', value: 80000, category: 'Finance', date: '2025-10-14' },
            { id: 15, metric: 'Net Promoter Score (NPS)', value: 55, category: 'Service', date: '2025-10-15' },
        ];

        const mockKPIs = [
            { title: 'Total Revenue', value: '$125k', trend: 'up', percentage: '+15.2%', icon: 'fa-sack-dollar', color: 'google-green' },
            { title: 'Monthly Users', value: '95K', trend: 'up', percentage: '+4.5%', icon: 'fa-users', color: 'google-blue' },
            { title: 'Conversion Rate', value: '4.5%', trend: 'down', percentage: '-0.3%', icon: 'fa-percent', color: 'google-red' },
            { title: 'Open Tickets', value: '85', trend: 'flat', percentage: '0%', icon: 'fa-ticket', color: 'google-yellow' },
        ];

        // --- UI Utility Functions ---

        /**
         * Shows the custom modal for alerts or confirmations.
         * @param {string} title - The title of the modal.
         * @param {string} message - The message content.
         * @param {string} type - 'alert' or 'confirm'.
         * @param {function} [onConfirm] - Callback for confirmation type.
         */
        function showCustomModal(title, message, type = 'alert', onConfirm = null) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalActions.innerHTML = '';
            
            // Close button (for alert and confirm)
            const closeBtn = document.createElement('button');
            closeBtn.textContent = type === 'alert' ? 'Close' : 'Cancel';
            closeBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-150';
            closeBtn.onclick = () => modal.classList.add('hidden');
            modalActions.appendChild(closeBtn);

            if (type === 'confirm' && onConfirm) {
                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = 'Confirm Delete';
                confirmBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-google-red text-white hover:bg-red-700 transition duration-150 shadow-md hover:shadow-lg';
                confirmBtn.onclick = () => {
                    modal.classList.add('hidden');
                    onConfirm();
                };
                modalActions.appendChild(confirmBtn);
            }
            
            modal.classList.remove('hidden');
        }

        function showGlobalLoading() {
            globalLoading.classList.remove('hidden');
        }

        function hideGlobalLoading() {
            globalLoading.classList.add('hidden');
        }

        // --- Theme Toggle Logic ---
        function setupThemeToggle() {
            const toggleButton = document.getElementById('theme-toggle');
            const toggleIcon = document.getElementById('theme-icon');

            // Initialize theme based on local storage or system preference
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                body.parentElement.classList.add('dark');
                toggleIcon.textContent = 'light_mode';
            } else {
                body.parentElement.classList.remove('dark');
                toggleIcon.textContent = 'dark_mode';
            }

            toggleButton.addEventListener('click', () => {
                body.parentElement.classList.toggle('dark');
                const isDark = body.parentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                toggleIcon.textContent = isDark ? 'light_mode' : 'dark_mode';
            });
        }

        // --- Tab Switching Logic ---

        function showTab(targetId) {
            // Update Tab Content
            document.querySelectorAll('.table-tab').forEach(tab => {
                tab.classList.remove('active-tab-content');
            });
            const targetTab = document.getElementById(targetId);
            if (targetTab) {
                targetTab.classList.add('active-tab-content');
            }

            // Update Tab Buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active-tab');
                if (btn.dataset.target === targetId) {
                    btn.classList.add('active-tab');
                }
            });
        }

        // --- Data Rendering Functions ---

        function renderKPICards() {
            const container = document.getElementById('kpi-cards-container');
            container.innerHTML = '';

            mockKPIs.forEach(kpi => {
                const isUp = kpi.trend === 'up';
                const trendIcon = isUp ? 'trending_up' : (kpi.trend === 'down' ? 'trending_down' : 'trending_flat');
                const trendColor = isUp ? 'text-google-green' : (kpi.trend === 'down' ? 'text-google-red' : 'text-google-yellow');
                const backgroundColor = kpi.color === 'google-green' ? 'bg-google-green/10' :
                                        kpi.color === 'google-blue' ? 'bg-google-blue/10' :
                                        kpi.color === 'google-red' ? 'bg-google-red/10' :
                                        'bg-google-yellow/10';

                const cardHTML = `
                    <div class="bg-white dark:bg-secondary-dark p-5 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border-t-4 border-${kpi.color}">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">${kpi.title}</p>
                            <span class="p-2 rounded-full ${backgroundColor} text-lg ${trendColor}">
                                <i class="fa-solid ${kpi.icon}"></i>
                            </span>
                        </div>
                        <p class="text-3xl font-bold mt-2 text-gray-900 dark:text-white">${kpi.value}</p>
                        <div class="flex items-center mt-3 space-x-2">
                            <span class="material-symbols-outlined ${trendColor} text-xl">${trendIcon}</span>
                            <span class="text-sm font-semibold ${trendColor}">${kpi.percentage}</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">vs. last period</span>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHTML;
            });
        }

        /**
         * Renders the data table rows.
         */
        function renderDataTable() {
            const tableBody = document.getElementById('data-table-body');
            const emptyMessage = document.getElementById('empty-table-message');
            tableBody.innerHTML = '';

            if (mockRecords.length === 0) {
                emptyMessage.classList.remove('hidden');
                return;
            } else {
                emptyMessage.classList.add('hidden');
            }

            mockRecords.forEach(record => {
                const valueText = typeof record.value === 'number' ? (
                    record.metric.includes('Revenue') || record.metric.includes('MRR') ? `$${record.value.toLocaleString()}` :
                    record.metric.includes('Rate') || record.metric.includes('Bounce') ? `${record.value}%` :
                    record.value.toLocaleString()
                ) : record.value;

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-secondary-dark/50 transition-colors duration-150';
                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-200">${record.metric}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${valueText}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-google-blue/10 text-google-blue dark:bg-google-blue/20">
                            ${record.category}
                        </span>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">${record.date}</td>
                    <td class="px-3 py-3 whitespace-nowrap text-right text-sm font-medium">
                        <button onclick="handleDelete(${record.id}, '${record.metric}')" 
                                class="text-google-red hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition duration-150 p-1 rounded-full hover:bg-google-red/10">
                            <i class="fa-solid fa-trash-can text-sm"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // --- Action Handlers (Mocked) ---

        /**
         * Handles the delete action for a record using the custom modal.
         * @param {number} id - The ID of the record to delete.
         * @param {string} metric - The metric name for display.
         */
        window.handleDelete = function(id, metric) {
            const onConfirmDelete = async () => {
                showGlobalLoading();
                // Simulate an API call delay
                await new Promise(resolve => setTimeout(resolve, 800));

                const index = mockRecords.findIndex(r => r.id === id);
                if (index > -1) {
                    mockRecords.splice(index, 1);
                    renderDataTable();
                    hideGlobalLoading();
                    showCustomModal('Success', `${metric} record (ID: ${id}) has been successfully deleted.`, 'alert');
                } else {
                    hideGlobalLoading();
                    showCustomModal('Error', `Could not find record with ID: ${id}.`, 'alert');
                }
            };

            showCustomModal(
                'Confirm Deletion',
                `Are you sure you want to delete the record for **${metric}**? This action cannot be undone.`,
                'confirm',
                onConfirmDelete
            );
        };
        
        // Expose showTab globally
        window.showTab = showTab;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            setupThemeToggle();
            renderKPICards();
            renderDataTable();
            showTab('summary-tab'); // Ensure the Summary tab is active on load
        });
    </script>
</body>

</html>
