<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>BPO Dashboard — Coaching</title>
    </head>
<body>
    <div>
        
        <header>
            <div>
                <div>
                    <button id="drawer-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Digital Minds BPO</h1>
                </div>
                <button id="dark-mode-toggle-mobile">
                    <i class="fas fa-moon"></i>
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </header>

        <aside id="mobile-drawer"> 
            <div>
                <img src="dmi_logo.png" alt="Logo">
                <h1>Digital Minds BPO</h1>
            </div>
            <nav>
                <a href="#" data-page="dashboard" class="nav-link active-link">
                    <i class="fas fa-chart-line"></i>
                    Dashboard
                </a>
                <a href="#" data-page="coaching" class="nav-link">
                    <i class="fas fa-clipboard-list"></i>
                    Coaching Log
                </a>
                <a href="#" data-page="irnte" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i>
                    IR / NTE
                </a>
                <a href="#" data-page="sop" class="nav-link">
                    <i class="fas fa-book-open"></i>
                    SOP Documents
                </a>
                <a href="#" data-page="tools" class="nav-link">
                    <i class="fas fa-tools"></i>
                    Tools
                </a>
                <a href="kb.html" target="_blank">
                    <i class="fas fa-database"></i>
                    Knowledge Base
                </a>
            </nav>
            <div>
                <div>
                    <span>Dark Mode</span>
                    <button id="dark-mode-toggle-desktop">
                        <i class="fas fa-toggle-off"></i>
                        <i class="fas fa-toggle-on"></i>
                    </button>
                </div>
                <button>Logout</button>
            </div>
        </aside>

        <main> 
            
            <section id="dashboard" class="page-section active">
                <h1>Dashboard</h1>
                <div>
                    <div>
                        <p>Key Performance Indicator 1</p>
                        <div>95.4%</div>
                        <p>↑ 2.1% from last month</p>
                    </div>
                    <div>
                        <i class="fas fa-chart-bar"></i>
                        <span>Detailed Performance Charts Here</span>
                    </div>
                </div>
            </section>
            
            <section id="coaching" class="page-section">
                <div>
                    <h1>Coaching Log</h1>
                    <a href="https://www.adrianavenido.com/coaching-form-log.html" target="_blank">
                        <i class="fas fa-plus-circle"></i>Update Coaching Log
                    </a>
                </div>

                <div>
                    <h2>Past Coaching Sessions</h2>

                    <div>
                        <input type="text" id="coachingSearch" placeholder="Search by Employee, Coach, or Employee No..." 
                            onkeyup="handleSearch()">
                    </div>

                    <div id="coachingLoadingSpinner">
                        <div>
                            <svg></svg>
                            <p id="coachingLoadingText">Loading data...</p>
                        </div>
                    </div>
                    <div>
                        <table>
                            <thead> <tr>
                                    <th>Date</th>
                                    <th>Coach</th>
                                    <th>Employee</th>
                                    <th>Employee No.</th>
                                    <th>Performance Observed</th>
                                    <th>Acknowledge</th>
                                    <th>Signed Document</th>
                                </tr>
                            </thead>
                            <tbody id="coachingSessionsTable">
                                <tr>
                                    <td colspan="7">Loading coaching data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section id="irnte" class="page-section">
                <div>
                    <h1>IR / NTE Log</h1>
                    <a href="ir.html" target="_blank">
                        <i class="fas fa-file-alt"></i>File New IR / NTE
                    </a>
                </div>

                <div>
                    <h2>Past IR / NTE Records</h2>

                    <div>
                        <input type="text" id="irnteSearch" placeholder="Search by Employee, Campaign, or NTE/IR Code..." 
                            onkeyup="handleIRNTESearch()">
                    </div>

                    <div id="irnteLoadingSpinner">
                        <div>
                            <svg></svg>
                            <p id="irnteLoadingText">Loading data...</p>
                        </div>
                    </div>
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th> 
                                    <th>Date Filed</th>
                                    <th>Employee</th>
                                    <th>Employee No.</th> 
                                    <th>Campaign</th>
                                    <th>NTE/IR Code</th>
                                    <th>Violation Category</th>
                                    <th>Decision (HR)</th>
                                    <th>NTE Docs</th> 
                                    <th>NOD Docs</th>
                                </tr>
                            </thead>
                            <tbody id="irnteSessionsTable">
                                <tr>
                                    <td colspan="10">Loading IR/NTE data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section id="sop" class="page-section">
                <div>
                    <h1>SOP Documents</h1>
                    <a href="#" target="_blank">
                        <i class="fas fa-file-alt"></i>New SOP Entry
                    </a>
                </div>
                <div>
                    <h2>Standard Operating Procedures</h2>

                    <div>
                        <input type="text" id="sopSearch" placeholder="Search by Document Name, Campaign, or Description..." 
                            onkeyup="handleSOPSearch()">
                    </div>

                    <div id="sopLoadingSpinner">
                        <div>
                            <svg></svg>
                            <p id="sopLoadingText">Loading SOP data...</p>
                        </div>
                    </div>
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Document Name</th>
                                    <th>Campaign</th> <th>Description</th>
                                    <th>Link</th>
                                </tr>
                            </thead>
                            <tbody id="sopTable">
                                <tr>
                                    <td colspan="5">Loading SOP data...</td> </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="tools" class="page-section">
                <div>
                    <h1>Campaigns Tools List</h1> 
                    <a href="#" target="_blank">
                        <i class="fas fa-tools"></i>New Tool Entry
                    </a>
                </div>
                <div>
                    <h2>Applications and Resources</h2>

                    <div>
                        <input type="text" id="toolsSearch" placeholder="Search by Tool Name, Campaign, or Description..." 
                            onkeyup="handleToolsSearch()">
                    </div>

                    <div id="toolsLoadingSpinner">
                        <div>
                            <svg></svg>
                            <p id="toolsLoadingText">Loading Tools data...</p>
                        </div>
                    </div>
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tool Name</th>
                                    <th>Campaign</th> <th>Description</th>
                                    <th>URL</th>
                                    <th>Work Instruction</th>
                                </tr>
                            </thead>
                            <tbody id="toolsTable">
                                <tr>
                                    <td colspan="6">Loading Tools data...</td> </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="drawer-overlay"></div>

    <div id="loadingModal">
        <div></div>
        <p id="loadingText">Loading...</p>
    </div>

    <script>
        // 🛑 CRITICAL: API URLs are kept untouched.
        const COACHING_API_URL = "https://script.google.com/macros/s/AKfycbzh35p0nz1Xtb1Gaksxk7KR2DxlNfjk-imi2I3KbTt-MY2raDI5QrcpjSA_5dv0TJN6/exec";
        const IRNTE_API_URL = "https://script.google.com/macros/s/AKfycbz8wi_hsT5s0nGMXpc2sMsVG6Xue9eoadKoZUXLpIXTkY1WO0V3cg1B5ilqfVcwrruW/exec"; 
        const SOP_TOOLS_API_URL = "https://script.google.com/macros/s/AKfycbwn0GPogd4Cy3TiEPR462FId4nP1DTy2r8Aciqxp389JS6lopKgV5j9u1My_g1YyE7t/exec"; 
        
        let allCoachingSessions = []; 
        let allIRNTESessions = []; 
        let allSOPSessions = [];
        let allToolsSessions = [];

        // Helper function to format the date (MM/DD/YYYY) - Unchanged
        function formatDate(dateString) {
            if (!dateString) return "N/A";
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return dateString;
                }
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const year = date.getFullYear();

                return `${month}/${day}/${year}`;
            } catch (e) {
                return dateString;
            }
        }
        
        // --- DATA RENDERING FUNCTIONS ---
        // RENDER FUNCTION: Coaching
        function renderCoachingTable(sessionsToRender) {
            const table = document.getElementById("coachingSessionsTable");
            table.innerHTML = ""; 

            if (!Array.isArray(sessionsToRender) || sessionsToRender.length === 0) {
                table.innerHTML = `<tr><td colspan="7">No sessions match your criteria.</td></tr>`;
                return;
            }

            sessionsToRender.sort((a, b) => new Date(b.date) - new Date(a.date));

            sessionsToRender.forEach(session => {
                const formattedDate = formatDate(session.date); 
                const fileUrl = session.signedform && session.signedform.length > 5 && session.signedform !== '#' ? session.signedform : "#"; 
                const performanceText = session.performance || "N/A";
                const displayPerformance = performanceText.substring(0, 50) + (performanceText.length > 50 ? "..." : "");

                table.innerHTML += `
                    <tr>
                        <td>${formattedDate}</td>
                        <td>${session.coach || "N/A"}</td>
                        <td>${session.employee || "N/A"}</td>
                        <td>${session.employeenumber || "N/A"}</td>
                        <td title="${performanceText}">
                            ${displayPerformance}
                        </td>
                        <td>
                            <span>${session.acknowledge || "Pending"}</span>
                        </td>
                        <td>
                            <a href="${fileUrl}" target="_blank" 
                                title="${fileUrl === '#' ? 'File link not available' : 'Open Signed Document'}">
                                <i class="fab fa-google-drive"></i>
                            </a>
                        </td>
                    </tr>`;
            });
        }
        
        // RENDER FUNCTION: IR/NTE
        function renderIRNTETable(sessionsToRender) {
            const table = document.getElementById("irnteSessionsTable");
            table.innerHTML = ""; 

            if (!Array.isArray(sessionsToRender) || sessionsToRender.length === 0) {
                table.innerHTML = `<tr><td colspan="10">No IR / NTE records match your criteria.</td></tr>`;
                return;
            }

            sessionsToRender.sort((a, b) => new Date(b.dateFiled) - new Date(a.dateFiled));

            sessionsToRender.forEach(session => {
                const dateFiled = formatDate(session.dateFiled); 
                const nteUrl = session.nteAttachment && session.nteAttachment.length > 5 && session.nteAttachment !== '#' ? session.nteAttachment : "#"; 
                const nodUrl = session.nodAttachment && session.nodAttachment.length > 5 && session.nodAttachment !== '#' ? session.nodAttachment : "#"; 
                
                table.innerHTML += `
                    <tr>
                        <td>${session.id || "N/A"}</td>
                        <td>${dateFiled}</td>
                        <td>${session.employeeName || "N/A"}</td>
                        <td>${session.employeeNumber || "N/A"}</td> 
                        <td>${session.campaign || "N/A"}</td>
                        <td>${session.codeNumber || "N/A"}</td>
                        <td>
                            ${session.category || "N/A"}
                        </td>
                        <td>${session.decisionHR || "Pending"}</td>
                        <td>
                            <a href="${nteUrl}" target="_blank" 
                                title="${nteUrl === '#' ? 'NTE document not available' : 'Open NTE Document'}">
                                <i class="fab fa-google-drive"></i>
                            </a>
                        </td>
                        <td>
                            <a href="${nodUrl}" target="_blank" 
                                title="${nodUrl === '#' ? 'NOD document not available' : 'Open NOD Document'}">
                                <i class="fab fa-google-drive"></i>
                            </a>
                        </td>
                    </tr>`;
            });
        }
        
        // RENDER FUNCTION: SOP
        function renderSOPTable(sessionsToRender) {
            const table = document.getElementById("sopTable");
            table.innerHTML = ""; 

            if (!Array.isArray(sessionsToRender) || sessionsToRender.length === 0) {
                table.innerHTML = `<tr><td colspan="5">No SOP documents match your criteria.</td></tr>`;
                return;
            }

            sessionsToRender.forEach(session => {
                const linkUrl = session.driveLink && session.driveLink.length > 5 && session.driveLink !== '#' ? session.driveLink : "#"; 
                const descriptionText = session.description || "No description provided.";
                
                table.innerHTML += `
                    <tr>
                        <td>${session.id || "N/A"}</td>
                        <td>${session.documentName || "N/A"}</td>
                        <td>${session.campaign || "N/A"}</td> 
                        <td>${descriptionText}</td>
                        <td>
                            <a href="${linkUrl}" target="_blank" 
                                title="${linkUrl === '#' ? 'Document link not available' : 'Open SOP Document'}">
                                <i class="fab fa-google-drive"></i>
                            </a>
                        </td>
                    </tr>`;
            });
        }

        // RENDER FUNCTION: Tools
        function renderToolsTable(sessionsToRender) {
            const table = document.getElementById("toolsTable");
            table.innerHTML = ""; 

            if (!Array.isArray(sessionsToRender) || sessionsToRender.length === 0) {
                table.innerHTML = `<tr><td colspan="6">No Tools records match your criteria.</td></tr>`;
                return;
            }

            sessionsToRender.forEach(session => {
                const url = session.url && session.url.length > 5 && session.url !== '#' ? session.url : "#"; 
                const wiLink = session.wiLink && session.wiLink.length > 5 && session.wiLink !== '#' ? session.wiLink : "#"; 
                const descriptionText = session.description || "No description provided.";
                
                table.innerHTML += `
                    <tr>
                        <td>${session.id || "N/A"}</td>
                        <td>${session.toolName || "N/A"}</td>
                        <td>${session.campaign || "N/A"}</td> 
                        <td>${descriptionText}</td>
                        <td>
                            <a href="${url}" target="_blank" 
                                title="${url === '#' ? 'URL not available' : 'Open Tool Website'}">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        </td>
                        <td>
                            <a href="${wiLink}" target="_blank" 
                                title="${wiLink === '#' ? 'Work Instruction not available' : 'Open Work Instruction'}">
                                <i class="fab fa-google-drive"></i>
                            </a>
                        </td>
                    </tr>`;
            });
        }
        
        // --- DATA FETCHING AND FILTERING FUNCTIONS (CRUD Logic) ---

        // Coaching Log Functions (Filter)
        function handleSearch() {
            const query = document.getElementById('coachingSearch').value.toLowerCase().trim();
            if (!query) {
                renderCoachingTable(allCoachingSessions); 
                return;
            }
            const filteredSessions = allCoachingSessions.filter(session => {
                return (session.employee && session.employee.toLowerCase().includes(query)) ||
                       (session.coach && session.coach.toLowerCase().includes(query)) ||
                       (session.employeenumber && String(session.employeenumber).toLowerCase().includes(query)) ||
                       (session.performance && session.performance.toLowerCase().includes(query)) ||
                       (session.date && formatDate(session.date).includes(query));
            });
            renderCoachingTable(filteredSessions);
        }

        // Coaching Log Functions (Read)
        async function loadCoachingSessions() {
            const spinner = document.getElementById('coachingLoadingSpinner');
            const table = document.getElementById("coachingSessionsTable");
            table.innerHTML = `<tr><td colspan="7">Loading coaching data...</td></tr>`;
            // spinner.classList.remove('hidden'); // UI Logic removed
            
            try {
                const res = await fetch(COACHING_API_URL);
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}.`);
                }
                allCoachingSessions = await res.json();
                renderCoachingTable(allCoachingSessions);

            } catch (error) {
                console.error("Error loading coaching sessions:", error);
                const errorMessage = `Failed to load data. Please ensure your Apps Script for Coaching is deployed with 'Anyone' access and the API_URL is correct. (Error: ${error.message})`;
                table.innerHTML = `<tr><td colspan="7">${errorMessage}</td></tr>`;
            }
            // spinner.classList.add('hidden'); // UI Logic removed
        }

        // IR/NTE Log Functions (Filter)
        function handleIRNTESearch() {
            const query = document.getElementById('irnteSearch').value.toLowerCase().trim();
            
            if (!query) {
                renderIRNTETable(allIRNTESessions); 
                return;
            }

            const filteredSessions = allIRNTESessions.filter(session => {
                return (session.id && String(session.id).toLowerCase().includes(query)) ||
                       (session.employeeNumber && String(session.employeeNumber).toLowerCase().includes(query)) ||
                       (session.employeeName && session.employeeName.toLowerCase().includes(query)) ||
                       (session.campaign && session.campaign.toLowerCase().includes(query)) ||
                       (session.codeNumber && String(session.codeNumber).toLowerCase().includes(query)) ||
                       (session.category && session.category.toLowerCase().includes(query)) ||
                       (session.complaints && session.complaints.toLowerCase().includes(query)) ||
                       (session.decisionHR && session.decisionHR.toLowerCase().includes(query)) ||
                       (session.dateFiled && formatDate(session.dateFiled).includes(query));
            });

            renderIRNTETable(filteredSessions);
        }

        // IR/NTE Log Functions (Read)
        async function loadIRNTE() {
            const spinner = document.getElementById('irnteLoadingSpinner');
            const table = document.getElementById("irnteSessionsTable");

            table.innerHTML = `<tr><td colspan="10">Loading IR/NTE data...</td></tr>`;
            // spinner.classList.remove('hidden'); // UI Logic removed
            
            try {
                const fetchUrl = IRNTE_API_URL + '?action=getIRNTE';
                const res = await fetch(fetchUrl);

                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}. Check your Apps Script deployment and URL.`);
                }
                
                allIRNTESessions = await res.json();
                
                if (allIRNTESessions.error) {
                    throw new Error(allIRNTESessions.error);
                }

                renderIRNTETable(allIRNTESessions);

            } catch (error) {
                console.error("Error loading IR/NTE records:", error);
                
                const errorMessage = `Failed to load IR/NTE data. Check Apps Script ID/Name and Deployment. (Error: ${error.message})`;

                table.innerHTML = `<tr><td colspan="10">${errorMessage}</td></tr>`;
            }
            // spinner.classList.add('hidden'); // UI Logic removed
        }

        // SOP Documents Functions (Filter)
        function handleSOPSearch() {
            const query = document.getElementById('sopSearch').value.toLowerCase().trim();
            
            if (!query) {
                renderSOPTable(allSOPSessions); 
                return;
            }

            const filteredSessions = allSOPSessions.filter(session => {
                return (session.documentName && session.documentName.toLowerCase().includes(query)) ||
                       (session.description && session.description.toLowerCase().includes(query)) ||
                       (session.campaign && session.campaign.toLowerCase().includes(query)) ||
                       (session.id && String(session.id).toLowerCase().includes(query));
            });

            renderSOPTable(filteredSessions);
        }

        // SOP Documents Functions (Read)
        async function loadSOP() {
            const spinner = document.getElementById('sopLoadingSpinner');
            const table = document.getElementById("sopTable");

            table.innerHTML = `<tr><td colspan="5">Loading SOP data...</td></tr>`;
            // spinner.classList.remove('hidden'); // UI Logic removed
            
            try {
                const fetchUrl = SOP_TOOLS_API_URL + '?action=getSOP';
                const res = await fetch(fetchUrl);

                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}. Check SOP/Tools Apps Script URL.`);
                }
                
                allSOPSessions = await res.json();
                
                if (allSOPSessions.error) {
                    throw new Error(allSOPSessions.error);
                }

                renderSOPTable(allSOPSessions);

            } catch (error) {
                console.error("Error loading SOP records:", error);
                
                const errorMessage = `Failed to load SOP data. Check the SOP_TOOLS_API_URL and Apps Script deployment. (Error: ${error.message})`;

                table.innerHTML = `<tr><td colspan="5">${errorMessage}</td></tr>`;
            }
            // spinner.classList.add('hidden'); // UI Logic removed
        }

        // Tools List Functions (Filter)
        function handleToolsSearch() {
            const query = document.getElementById('toolsSearch').value.toLowerCase().trim();
            
            if (!query) {
                renderToolsTable(allToolsSessions); 
                return;
            }

            const filteredSessions = allToolsSessions.filter(session => {
                return (session.toolName && session.toolName.toLowerCase().includes(query)) ||
                       (session.description && session.description.toLowerCase().includes(query)) ||
                       (session.campaign && session.campaign.toLowerCase().includes(query)) ||
                       (session.id && String(session.id).toLowerCase().includes(query));
            });

            renderToolsTable(filteredSessions);
        }

        // Tools List Functions (Read)
        async function loadTools() {
            const spinner = document.getElementById('toolsLoadingSpinner');
            const table = document.getElementById("toolsTable");

            table.innerHTML = `<tr><td colspan="6">Loading Tools data...</td></tr>`;
            // spinner.classList.remove('hidden'); // UI Logic removed
            
            try {
                const fetchUrl = SOP_TOOLS_API_URL + '?action=getTools';
                const res = await fetch(fetchUrl);

                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}. Check SOP/Tools Apps Script URL.`);
                }
                
                allToolsSessions = await res.json();
                
                if (allToolsSessions.error) {
                    throw new Error(allToolsSessions.error);
                }

                renderToolsTable(allToolsSessions);

            } catch (error) {
                console.error("Error loading Tools records:", error);
                
                const errorMessage = `Failed to load Tools data. Check the SOP_TOOLS_API_URL and Apps Script deployment. (Error: ${error.message})`;

                table.innerHTML = `<tr><td colspan="6">${errorMessage}</td></tr>`;
            }
            // spinner.classList.add('hidden'); // UI Logic removed
        }


        // --- UI FUNCTIONALITY (Removed to bare structure) ---
        
        // Function to handle page navigation (Simplified)
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                // Removed all UI class manipulation

                document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
                const pageId = this.dataset.page;
                document.getElementById(pageId).classList.add('active');
                
                // Simplified data loading logic 
                if (pageId === 'coaching') {
                    if (allCoachingSessions.length === 0) {
                        loadCoachingSessions();
                    } else {
                        renderCoachingTable(allCoachingSessions);
                    }
                } else if (pageId === 'irnte') {
                    if (allIRNTESessions.length === 0) {
                        loadIRNTE();
                    } else {
                        renderIRNTETable(allIRNTESessions);
                    }
                } else if (pageId === 'sop') {
                    if (allSOPSessions.length === 0) {
                        loadSOP();
                    } else {
                        renderSOPTable(allSOPSessions);
                    }
                } else if (pageId === 'tools') {
                    if (allToolsSessions.length === 0) {
                        loadTools();
                    } else {
                        renderToolsTable(allToolsSessions);
                    }
                }
            });
        });

        // Initial load check
        document.addEventListener("DOMContentLoaded", () => {
            const activeLink = document.querySelector('.nav-link.active-link');
            if (activeLink) {
                const pageId = activeLink.dataset.page;
                if (pageId === 'coaching') {
                     loadCoachingSessions();
                } else if (pageId === 'irnte') {
                     loadIRNTE();
                } else if (pageId === 'sop') {
                     loadSOP();
                } else if (pageId === 'tools') {
                     loadTools();
                }
            }
        });
    </script>
</body>
</html>