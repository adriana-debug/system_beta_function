<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPO Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#CBEB33',
                        brandlight: '#D9F25A'
                    }
                }
            }
        }
    </script>

    <style>
        /* Style for Page Navigation: Hides all non-active pages by default */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Styles for Attendance Tab component */
        .tab {
            color: black;
            transition: background-color 0.2s, color 0.2s;
        }

        .tab:hover {
            background-color: #f0f9c0;
            /* brandlight hover */
            color: black;
        }

        .tab.active {
            border-bottom: 2px solid #cce416;
            /* brand color */
            background-color: #f0f9c0;
            color: black;
        }
    </style>
</head>

<body class="bg-gray-50 text-slate-800">
    <div class="flex min-h-screen">

        <aside class="w-64 bg-white shadow-xl flex flex-col">
            <div class="p-6 flex flex-col items-center gap-2">
                <img src="dmi_logo.png" alt="Digital Minds BPO Logo" class="w-20 h-20 rounded-full object-cover mb-2">
                <h1 class="text-xl font-bold text-slate-900 text-center">Digital Minds BPO</h1>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <a href="#" data-page="dashboard"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-tachometer-alt mr-3 text-slate-700"></i> Dashboard
                </a>

                <a href="#" data-page="campaigns"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-bullhorn mr-3 text-slate-700"></i> Campaigns
                </a>

                <a href="#" data-page="headcount"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-users mr-3 text-slate-700"></i> Headcount
                </a>

                <a href="#" data-page="attendance-calendar"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-calendar-check mr-3 text-slate-700"></i> Attendance Calendar
                </a>

                <a href="#" data-page="billing"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-file-invoice-dollar mr-3 text-slate-700"></i> Billing
                </a>

                <a href="#" data-page="scorecards"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-clipboard-list mr-3 text-slate-700"></i> Scorecards
                </a>

                <a href="#" data-page="coaching"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-clipboard-list mr-3 text-slate-700"></i> Coaching Logs
                </a>

                <a href="#" data-page="reports"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-chart-pie mr-3 text-slate-700"></i> Reports
                </a>

                <p class="text-xs text-gray-400 mt-6 uppercase px-4">Macro</p>
                <a href="#" data-page="macro"
                    class="nav-link flex items-center px-4 py-3 rounded-lg hover:bg-brandlight transition">
                    <i class="fas fa-bolt mr-3 text-slate-700"></i> Macros
                </a>
            </nav>

            <div class="p-4">
                <button
                    class="w-full py-2 bg-brand hover:bg-brandlight rounded-lg font-semibold text-slate-900 transition">Logout</button>
            </div>
        </aside>

        <main class="flex-1 ml-0 md:ml-0 p-6">

            <section id="dashboard" class="page-section active">
                <h1 class="text-3xl font-bold mb-4">Dashboard</h1>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-2">Welcome Back, Admin</h2>
                    <p class="text-gray-600">Here’s an overview of your CRM campaigns and agent performance today.</p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Tickets Handled</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">1,250</p>
                        <p class="text-sm text-green-600 mt-1">↑ 5% from last month</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">FCR %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#d8ec42]">87%</p>
                        <p class="text-sm text-red-600 mt-1">↓ 2% from last month</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Avg Response Time</h3>
                        <p class="text-3xl font-bold mt-2 text-[#e2f171]">2h 15m</p>
                        <p class="text-sm text-green-600 mt-1">↓ 10% from last month</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">CSAT %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">92%</p>
                        <p class="text-sm text-green-600 mt-1">↑ 3% from last month</p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6 overflow-x-auto">
                    <h2 class="text-xl font-semibold mb-4">Campaign Summary</h2>
                    <table class="min-w-full text-sm border-collapse">
                        <thead class="bg-gray-100 text-gray-700">
                            <tr>
                                <th class="text-left px-4 py-3">Campaign</th>
                                <th class="text-left px-4 py-3">Line of Business</th>
                                <th class="text-left px-4 py-3">Total Agents</th>
                                <th class="text-left px-4 py-3">Tickets Handled</th>
                                <th class="text-left px-4 py-3">FCR %</th>
                                <th class="text-left px-4 py-3">CSAT %</th>
                                <th class="text-left px-4 py-3">Avg Response Time</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-2 font-semibold">Campaign A</td>
                                <td class="px-4 py-2">Retail</td>
                                <td class="px-4 py-2">40</td>
                                <td class="px-4 py-2">450</td>
                                <td class="px-4 py-2">88%</td>
                                <td class="px-4 py-2">91%</td>
                                <td class="px-4 py-2">2h 10m</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-semibold">Campaign B</td>
                                <td class="px-4 py-2">Banking</td>
                                <td class="px-4 py-2">35</td>
                                <td class="px-4 py-2">380</td>
                                <td class="px-4 py-2">85%</td>
                                <td class="px-4 py-2">93%</td>
                                <td class="px-4 py-2">2h 30m</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 font-semibold">Campaign C</td>
                                <td class="px-4 py-2">Telecom</td>
                                <td class="px-4 py-2">45</td>
                                <td class="px-4 py-2">420</td>
                                <td class="px-4 py-2">90%</td>
                                <td class="px-4 py-2">89%</td>
                                <td class="px-4 py-2">1h 50m</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Campaign Trends</h2>
                    <div class="h-64 bg-gray-100 flex items-center justify-center text-gray-400">
                        Chart placeholder (Tickets / FCR / CSAT)
                    </div>
                </div>
            </section>

            <section id="campaigns" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Campaigns</h1>

                <div class="relative">
                    <div class="h-56 relative rounded-2xl overflow-hidden flex items-center">
                        <div class="absolute inset-0">
                            <div class="w-full h-full bg-brand"></div>
                            <svg class="absolute inset-0 w-full h-full opacity-10" viewBox="0 0 1440 320"
                                xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <pattern id="dots" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
                                        <circle cx="20" cy="20" r="6" fill="#A6B91A" />
                                    </pattern>
                                </defs>
                                <rect width="1440" height="320" fill="url(#dots)" />
                            </svg>
                            <svg class="absolute bottom-0 left-0 w-full h-28" viewBox="0 0 1440 320"
                                xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path fill="#CBE31B" fill-opacity="0.5"
                                    d="M0,224L48,202.7C96,181,192,139,288,154.7C384,171,480,245,576,240C672,235,768,149,864,117.3C960,85,1056,107,1152,117.3C1248,128,1344,128,1392,128L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
                                </path>
                            </svg>
                        </div>
                        <div class="absolute top-4 right-6 flex items-center gap-4 z-10">
                            <input type="text" placeholder="Search..."
                                class="px-4 py-2 rounded-full outline-none text-gray-700 shadow-md bg-white/90 w-56" />
                        </div>
                    </div>

                    <div class="relative w-[95%] max-w-6xl mx-auto -mt-16 z-20">
                        <div
                            class="bg-white/70 backdrop-blur-safe rounded-4xl p-6 flex flex-col md:flex-row items-center gap-6 border border-white/20 shadow-lg">
                            <img src="sb.png" alt="Profile"
                                class="w-24 h-24 rounded-full border-4 border-white shadow-lg object-cover">
                            <div class="flex-1 text-center md:text-left">
                                <h2 class="text-2xl font-semibold text-slate-900">Digital Minds BPO</h2>
                                <p class="text-sm text-slate-600">admin@dmibpo.com</p>
                            </div>
                            <div class="flex flex-wrap justify-center md:justify-end gap-3">
                                <button
                                    class="px-6 py-2 rounded-full bg-white/60 hover:bg-white text-slate-900 font-medium transition">OVERVIEW</button>
                                <button
                                    class="px-6 py-2 rounded-full bg-white/60 hover:bg-white text-slate-900 font-medium transition">TEAMS</button>
                                <button
                                    class="px-6 py-2 rounded-full bg-white/60 hover:bg-white text-slate-900 font-medium transition">PROJECTS</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-4 md:px-8 mt-10 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <section class="bg-white rounded-xl shadow p-6">
                        <h3 class="font-semibold mb-4">Platform Settings</h3>
                        <p class="text-xs text-gray-400 mb-2">ACCOUNT</p>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span>Email me when someone follows me</span>
                                <input type="checkbox" class="h-5 w-5" />
                            </label>
                            <label class="flex items-center justify-between">
                                <span>Email me when someone answers on my post</span>
                                <input type="checkbox" class="h-5 w-5" />
                            </label>
                            <label class="flex items-center justify-between">
                                <span>Email me when someone mentions me</span>
                                <input type="checkbox" class="h-5 w-5" />
                            </label>
                        </div>
                    </section>

                    <section class="bg-white rounded-xl shadow p-6">
                        <h3 class="font-semibold mb-4">Profile Information</h3>
                        <p class="text-sm mb-4">Hi, I’m Esthera Jackson. Decisions: If you can’t decide, the answer is
                            no...
                        </p>
                        <div class="text-sm space-y-2">
                            <p><strong>Full Name:</strong> Esthera Jackson</p>
                            <p><strong>Mobile:</strong> (44) 123 1234 123</p>
                            <p><strong>Email:</strong> esthera@simmmpple.com</p>
                            <p><strong>Location:</strong> United States</p>
                            <p><strong>Social:</strong>
                                <span class="inline-flex gap-3 ml-2 text-slate-700">
                                    <i class="fab fa-facebook-f"></i>
                                    <i class="fab fa-instagram"></i>
                                    <i class="fab fa-twitter"></i>
                                </span>
                            </p>
                        </div>
                    </section>

                    <section class="bg-white rounded-xl shadow p-6">
                        <h3 class="font-semibold mb-4">Conversations</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="https://via.placeholder.com/40" class="rounded-full" />
                                    <div>
                                        <p class="font-medium">Sophie B.</p>
                                        <p class="text-sm text-gray-500">Hi! I need more information...</p>
                                    </div>
                                </div>
                                <a href="#" class="text-slate-700 text-sm font-semibold">REPLY</a>
                            </div>
                        </div>
                    </section>
                </div>
            </section>

            <section id="attendance-calendar" class="page-section">
                <div class="bg-white rounded-xl shadow-lg p-6">

                    <div class="mb-6 border-b border-gray-300">
                        <nav class="flex space-x-4">
                            <button id="weekly-tab" onclick="switchAttendanceTab('weekly')"
                                class="tab py-3 px-5 text-sm font-semibold rounded-t-lg active focus:outline-none">Weekly
                                View</button>
                            <button id="monthly-tab" onclick="switchAttendanceTab('monthly')"
                                class="tab py-3 px-5 text-sm font-semibold rounded-t-lg focus:outline-none">Monthly
                                View</button>
                            <button id="custom-tab" onclick="switchAttendanceTab('custom')"
                                class="tab py-3 px-5 text-sm font-semibold rounded-t-lg focus:outline-none">Custom</button>
                        </nav>
                    </div>

                    <div>
                        <div id="weekly-content" class="tab-content">
                        </div>

                        <div id="monthly-content" class="tab-content hidden">
                        </div>

                        <div id="custom-content" class="tab-content hidden">
                            <div class="text-center text-gray-400 py-10">
                                <p>Loading custom calendar...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="billing" class="page-section px-6 py-4">
                <h1 class="text-3xl font-bold mb-4">Billing</h1>
                <p class="text-gray-600 mb-6">Overview of billing metrics, trends, and campaign comparison.</p>

                <div class="flex space-x-3 mb-6">
                    <button onclick="openDownloadModal()"
                        class="bg-[#cce416] hover:bg-[#d8ec42] text-black px-4 py-2 rounded shadow font-medium flex items-center space-x-2">
                        <i class="fas fa-file-excel"></i><span>Download Excel</span>
                    </button>
                    <button onclick="openDownloadModal()"
                        class="bg-[#cce416] hover:bg-[#d8ec42] text-black px-4 py-2 rounded shadow font-medium flex items-center space-x-2">
                        <i class="fas fa-file-pdf"></i><span>Download PDF</span>
                    </button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Active Agents</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">120</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 3%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Total Headcount</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">145</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-red-600 font-semibold">↓ 2%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Lost Hours</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">125</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-red-600 font-semibold">↑ 5%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Covered Absences %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">95%</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 5%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Billed Hours</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">1,020 hrs</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 4%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Overhead (Supervisors)</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">25 hrs</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-yellow-600 font-semibold">↔ 1%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Agent Coverage %</h3>
                        <p class="text-3xl font-bold mt-2 text-[#e2f171]">87.5%</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-green-600 font-semibold">↑ 2%</span> from last month
                        </p>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-4">
                        <h3 class="font-bold text-gray-700 mb-1">Agent Coverage Hours</h3>
                        <p class="text-3xl font-bold mt-2 text-[#cce416]">1,050 hrs</p>
                        <p class="text-sm text-gray-500 mt-1">
                            <span class="text-red-600 font-semibold">↓ 1%</span> from last month
                        </p>
                    </div>
                </div>

                <div class="bg-white shadow rounded-xl p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-2">Lost Hours & Headcount Trend</h3>
                    <div class="h-64 flex items-center justify-center text-gray-400 border-2 border-dashed rounded-lg">
                        <span>Chart will go here</span>
                    </div>
                </div>

                <div class="bg-white shadow rounded-xl p-4 mb-6">
                    <h3 class="text-lg font-semibold mb-2">Campaign Comparison</h3>
                    <div class="h-64 flex items-center justify-center text-gray-400 border-2 border-dashed rounded-lg">
                        <span>Chart will go here</span>
                    </div>
                </div>

                <section id="metrics-description" class="mb-10">
                    <h2 class="text-2xl font-bold mb-4">KPI Metrics & Calculations</h2>

                    <div class="space-y-4">
                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Active Agents</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Total number of agents actively handling tasks, logged
                                    in, and productive during the measurement period.</p>
                                <p><strong>Calculation:</strong>
                                    <code>Count of agents currently logged in and marked as Productive</code>
                                </p>
                                <p><strong>Example:</strong> If 120 agents are currently logged in, the count is
                                    **120**.</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Total Headcount</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Total number of employees (both billable agents and
                                    non-billable overhead like supervisors/managers) in the team or campaign.</p>
                                <p><strong>Calculation:</strong> <code>Total Active Agents + Total Overhead Staff</code>
                                </p>
                                <p><strong>Example:</strong> 120 active agents + 25 overhead staff = **145 total
                                    headcount**.</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Lost Hours</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> The total number of scheduled hours that were lost due
                                    to unscheduled absenteeism, tardiness, or other non-productive activities.</p>
                                <p><strong>Calculation:</strong> <code>Total Scheduled Hours - Total Hours Worked</code>
                                </p>
                                <p><strong>Example:</strong> 1,145 scheduled hours - 1,020 hours worked = **125 lost
                                    hours**.</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Covered Absences %</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> The percentage of all agent absences (Lost Hours) that
                                    were successfully covered by backup agents or scheduling adjustments.</p>
                                <p><strong>Calculation:</strong>
                                    <code>(Total Absences Covered ÷ Total Absences) × 100</code>
                                </p>
                                <p><strong>Example:</strong> 118 covered hours ÷ 125 lost hours × 100 = **94.4%**
                                    (~95%).</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Billed Hours</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> The total cumulative hours worked by all **billable
                                    agents** that are submitted to the client for invoicing.</p>
                                <p><strong>Calculation:</strong>
                                    <code>Sum of all agents’ approved billable hours for the period</code>
                                </p>
                                <p><strong>Example:</strong> Total sum of agent timesheets is **1,020 hrs**.</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Overhead (Supervisors)</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> Total hours worked by non-billable staff, such as
                                    supervisors, managers, trainers, etc., that contribute to operational cost.</p>
                                <p><strong>Calculation:</strong>
                                    <code>Sum of supervisors’ logged hours for the period</code>
                                </p>
                                <p><strong>Example:</strong> 5 supervisors × 5 hours/day × 5 days = **125 hours** (~25
                                    hrs in the card if displaying average).</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Agent Coverage %</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> The percentage of scheduled agents who were available,
                                    present, and actively productive during their shifts.</p>
                                <p><strong>Calculation:</strong>
                                    <code>(Active Agents ÷ Total Scheduled Agents) × 100</code>
                                </p>
                                <p><strong>Example:</strong> 120 active agents ÷ 145 scheduled agents × 100 = **82.75%**
                                    (~87.5% if based on hours).</p>
                            </div>
                        </details>

                        <details class="bg-white rounded-xl shadow p-4">
                            <summary class="cursor-pointer font-semibold text-gray-700">Agent Coverage Hours</summary>
                            <div class="mt-2 text-gray-600 text-sm">
                                <p><strong>Definition:</strong> The total number of hours covered by productive agents,
                                    including billable time and scheduled non-billable time (like breaks/training)
                                    included in coverage.</p>
                                <p><strong>Calculation:</strong> <code>Total Scheduled Hours - Lost Hours</code></p>
                                <p><strong>Example:</strong> 1,175 scheduled hours - 125 lost hours = **1,050 hrs**.</p>
                            </div>
                        </details>
                    </div>
                </section>
            </section>

            <section id="headcount" class="page-section">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-3xl font-bold">Headcount</h1>
                    <button onclick="openCrudModal('NEW')"
                        class="px-4 py-2 bg-brand text-black rounded hover:bg-brandlight"> + Add Employee </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-slate-900">Agent Headcount</h2>
                        <div class="flex space-x-2">
                            <input type="text" id="searchHeadcount" oninput="filterHeadcount()"
                                placeholder="Search agents..."
                                class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand">
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left border-collapse">
                            <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
                                <tr>
                                    <th class="px-4 py-3">Emp No</th>
                                    <th class="px-4 py-3">Name</th>
                                    <th class="px-4 py-3">Phone</th>
                                    <th class="px-4 py-3">Emergency Contact</th>
                                    <th class="px-4 py-3">Department</th>
                                    <th class="px-4 py-3">DOJ</th>
                                    <th class="px-4 py-3">LWD</th>
                                    <th class="px-4 py-3">Status</th>
                                    <th class="px-4 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="headcountTableBody" class="divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="scorecards" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Scorecards</h1>
                <div class="bg-white rounded-xl shadow-md p-6 h-96 flex items-center justify-center text-gray-400">
                    Scorecard visualization and data will be added here.
                </div>
            </section>

            <section id="reports" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Reports</h1>
                <div class="bg-white rounded-xl shadow-md p-6 h-96 flex items-center justify-center text-gray-400">
                    Reports dashboard and generation forms will be added here.
                </div>
                <button onclick="openRequestReportModal()"
                    class="mt-4 px-4 py-2 bg-brand text-black rounded hover:bg-brandlight">Request Custom
                    Report</button>
            </section>

            <section id="coaching" class="page-section">
                <div class="flex items-center justify-between mb-6">
                    <h1 class="text-3xl font-bold text-slate-900">Coaching Sessions</h1>
                    <button onclick="openModal(false)"
                        class="px-4 py-2 bg-brand text-black rounded hover:bg-brandlight transition font-semibold">
                        + New Session
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-slate-900">Coaching Log</h2>
                        <input type="text" id="searchCoaching" oninput="filterCoachingSessions()"
                            placeholder="Search employee name or number..."
                            class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand w-64">
                    </div>

                    <div class="overflow-x-auto">
                        <div id="coachingTableStatus" class="p-4 text-center text-gray-500 hidden"></div>
                        <table class="min-w-full text-sm text-left border-collapse">
                            <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
                                <tr>
                                    <th class="px-4 py-3">Date</th>
                                    <th class="px-4 py-3">Coach</th>
                                    <th class="px-4 py-3">Employee</th>
                                    <th class="px-4 py-3">Employee No</th>
                                    <th class="px-4 py-3">Performance</th>
                                    <th class="px-4 py-3 hidden md:table-cell">Coaching Provided</th>
                                    <th class="px-4 py-3 hidden md:table-cell">Action Plan</th>
                                    <th class="px-4 py-3 hidden md:table-cell">Agent Acknowledge</th>
                                    <th class="px-4 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sessionsTable" class="divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <div id="modalBg"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-8 relative max-h-[90vh] overflow-y-auto">
                    <button onclick="closeModal()"
                        class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                    <h3 id="modalTitle" class="text-2xl font-bold mb-6 text-slate-900">Record New Coaching Session</h3>

                    <form id="coachingForm" data-edit-id="">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="date" class="block text-sm font-medium text-gray-700">Date</label>
                                <input type="date" id="date" name="date" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2">
                            </div>
                            <div>
                                <label for="coach" class="block text-sm font-medium text-gray-700">Coach</label>
                                <input type="text" id="coach" name="coach" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="employee" class="block text-sm font-medium text-gray-700">Employee Name</label>
                                <input type="text" id="employee" name="employee" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2">
                            </div>
                            <div>
                                <label for="employeenumber" class="block text-sm font-medium text-gray-700">Employee Number</label>
                                <input type="text" id="employeenumber" name="employeenumber" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="agentacknowledged" class="block text-sm font-medium text-gray-700">Agent Acknowledge</label>
                                <select id="agentacknowledged" name="agentacknowledged" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2">
                                    <option value="Pending">Pending</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                        </div>

                        <div class="space-y-4 mb-6">
                            <div>
                                <label for="performance" class="block text-sm font-medium text-gray-700">Performance Notes</label>
                                <textarea id="performance" name="performance" rows="2" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2"></textarea>
                            </div>
                            <div>
                                <label for="coachingprovided" class="block text-sm font-medium text-gray-700">Coaching Provided</label>
                                <textarea id="coachingprovided" name="coachingprovided" rows="2" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2"></textarea>
                            </div>
                            <div>
                                <label for="actionplan" class="block text-sm font-medium text-gray-700">Action Plan</label>
                                <textarea id="actionplan" name="actionplan" rows="2" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand p-2"></textarea>
                            </div>
                        </div>

                        <div class="flex justify-end mt-4 space-x-2">
                            <button type="button" onclick="closeModal()"
                                class="px-6 py-2 rounded bg-gray-200 hover:bg-gray-300 font-medium">Cancel</button>
                            <button type="submit" id="coachingSubmitButton"
                                class="px-6 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold transition">Save Session</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="loadingModal"
                class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-[100]">
                <div class="bg-white p-6 rounded-lg shadow-xl flex items-center space-x-3">
                    <svg class="animate-spin h-5 w-5 text-brand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <p id="loadingText" class="text-gray-700 font-medium">Loading...</p>
                </div>
            </div>

            <section id="macro" class="page-section">
                <h1 class="text-3xl font-bold mb-4">Macros/Automation</h1>
                <div class="bg-white rounded-xl shadow-md p-6 h-96 flex items-center justify-center text-gray-400">
                    Macro creation and management interface.
                </div>
            </section>

        </main>
    </div>

    <div id="crudModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-lg p-6 relative">
            <button onclick="closeCrudModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            <h3 id="crudModalTitle" class="text-xl font-bold mb-4">Modal Title</h3>
            <div id="crudModalBody" class="space-y-4">
            </div>
            <div class="flex justify-end mt-6 space-x-2">
                <button onclick="closeCrudModal()"
                    class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
                <button id="crudModalAction"
                    class="px-4 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold">Confirm</button>
            </div>
        </div>
    </div>

    <div id="downloadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-sm p-6 relative">
            <button onclick="closeDownloadModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="text-xl font-bold mb-4">Download Report</h3>
            <div class="space-y-4">
                <label class="block">
                    <span class="text-gray-700">Select Date Range:</span>
                    <input type="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" />
                </label>
                <label class="block">
                    <span class="text-gray-700">Select Format:</span>
                    <select class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        <option>Excel (.xlsx)</option>
                        <option>PDF (.pdf)</option>
                        <option>CSV (.csv)</option>
                    </select>
                </label>
            </div>
            <div class="flex justify-end mt-6">
                <button onclick="downloadReport()"
                    class="px-4 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold">Download</button>
            </div>
        </div>
    </div>

    <div id="requestReportModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 relative">
            <button onclick="closeRequestReportModal()"
                class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            <h3 class="text-xl font-bold mb-4">Request Custom Report</h3>
            <div class="space-y-4">
                <label class="block">
                    <span class="text-gray-700">Report Name:</span>
                    <input type="text" id="reportName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" />
                </label>
                <label class="block">
                    <span class="text-gray-700">Description / Requirements:</span>
                    <textarea id="reportDescription" rows="4"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                </label>
            </div>
            <div class="flex justify-end mt-6">
                <button onclick="submitReportRequest()"
                    class="px-4 py-2 rounded bg-brand hover:bg-brandlight text-black font-semibold">Submit
                    Request</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize main page navigation and other components when the DOM is fully loaded.
            initializePageNavigation();
            initializeAttendanceTabs();
            renderHeadcountTable();
        });


        /* -------------------------------------------
         * 1. GLOBAL UTILITY & API ENDPOINTS
         * ------------------------------------------- */

        const API_ENDPOINTS = {
            ATTENDANCE: "https://script.google.com/macros/s/AKfycbzrN_zWK3AtRd5gO5XG-nA5WYIvcDPnlUJ73PFmNghOzRfXs8r6he97FYxzmcoYXHihwg/exec",
            COACHING_LOGS: "https://script.google.com/macros/s/AKfycbwCKmWP6XnOaaxoPJRNktq_kWUzlbW85tIYhr1L6W2WxmUHeXUj_1a_BKzEIRDt6wu0/exec"
        };

        const API_URL_CRUD = "/api/headcount"; // Headcount API

        // Global Loading Functions (Used for Headcount CRUD)
        function showLoading(message = "Loading...") {
            if (document.getElementById('loadingText')) {
                document.getElementById('loadingText').innerText = message;
                document.getElementById('loadingModal').classList.remove('hidden');
            }
        }
        function hideLoading() {
            if (document.getElementById('loadingModal')) {
                document.getElementById('loadingModal').classList.add('hidden');
            }
        }
        
        // Local Loading Functions (Used for Coaching Logs table)
        function showLocalLoading(message) {
            const statusEl = document.getElementById('coachingTableStatus');
            if (statusEl) {
                statusEl.innerHTML = `<i class="fas fa-spinner fa-spin mr-2 text-brand"></i>${message}`;
                statusEl.classList.remove('hidden');
                document.getElementById('sessionsTable').classList.add('hidden');
            }
        }
        function hideLocalLoading() {
            const statusEl = document.getElementById('coachingTableStatus');
            if (statusEl) {
                statusEl.classList.add('hidden');
                document.getElementById('sessionsTable').classList.remove('hidden');
            }
        }
        function showLocalError(message) {
            const statusEl = document.getElementById('coachingTableStatus');
            if (statusEl) {
                statusEl.innerHTML = `<i class="fas fa-exclamation-triangle mr-2 text-red-500"></i>${message}`;
                statusEl.classList.remove('hidden');
                document.getElementById('sessionsTable').classList.add('hidden');
            }
        }


        /* -------------------------------------------
         * 2. MAIN PAGE NAVIGATION LOGIC
         * ------------------------------------------- */

        function initializePageNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const pageSections = document.querySelectorAll('.page-section');
            const defaultPageId = 'dashboard';

            function navigateTo(pageId) {
                // Update link styles (highlight active link)
                navLinks.forEach(link => {
                    if (link.dataset.page === pageId) {
                        link.classList.add('bg-brandlight');
                    } else {
                        link.classList.remove('bg-brandlight');
                    }
                });

                // Show/Hide page sections
                pageSections.forEach(section => {
                    if (section.id === pageId) {
                        section.classList.add('active');
                        // Special handling for the coaching page
                        if (pageId === 'coaching' && typeof window.loadSessions === 'function') {
                            window.loadSessions();
                        }
                    } else {
                        section.classList.remove('active');
                    }
                });
            }

            // Set up click listeners for all sidebar links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.dataset.page);
                });
            });

            // Set default page on load
            navigateTo(defaultPageId);
        }


        /* -------------------------------------------
         * 3. ATTENDANCE TABS & DATA LOGIC
         * ------------------------------------------- */

        function initializeAttendanceTabs() {
            const tabs = document.querySelectorAll("#attendance-calendar .tab");
            const contents = {
                'weekly-tab': document.getElementById('weekly-content'),
                'monthly-tab': document.getElementById('monthly-content'),
                'custom-tab': document.getElementById('custom-content')
            };

            function switchTab(tabId) {
                tabs.forEach(t => t.classList.remove("active"));
                document.getElementById(tabId).classList.add("active");

                Object.keys(contents).forEach(key => {
                    const content = contents[key];
                    if (key === tabId) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
            }

            // Global function for the onclick events in the HTML
            window.switchAttendanceTab = function (tabName) {
                switchTab(tabName + '-tab');
            }

            // Initialize to show weekly view by default
            switchTab('weekly-tab');
        }

        // Placeholder Attendance Data Functions (kept for future implementation)
        const ATTENDANCE_BASE_URL = API_ENDPOINTS.ATTENDANCE;
        // ... (other attendance placeholder functions)


        /* -------------------------------------------
         * 4. HEADCOUNT CRUD AND TABLE LOGIC
         * ------------------------------------------- */

        const sampleAgents = [
            { emp: 'DMI-0001', name: 'Jane Doe', phone: '09171234567', emergency: '09181234567', dept: 'Support', doj: '2024-01-10', lwd: '', status: 'Active' },
            { emp: 'DMI-0002', name: 'John Smith', phone: '09172345678', emergency: '09182345678', dept: 'Sales', doj: '2024-02-05', lwd: '', status: 'Active' },
            { emp: 'DMI-0003', name: 'Maria Cruz', phone: '09173456789', emergency: '09183456789', dept: 'Support', doj: '2023-11-15', lwd: '2024-09-25', status: 'On Leave' },
        ];
        
        function renderHeadcountTable() {
            const tableBody = document.getElementById('headcountTableBody');
            if (!tableBody) return;

            tableBody.innerHTML = sampleAgents.map(agent => `
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3">${agent.emp}</td>
                <td class="px-4 py-3">${agent.name}</td>
                <td class="px-4 py-3">${agent.phone}</td>
                <td class="px-4 py-3">${agent.emergency}</td>
                <td class="px-4 py-3">${agent.dept}</td>
                <td class="px-4 py-3">${agent.doj || '-'}</td>
                <td class="px-4 py-3">${agent.lwd || '-'}</td>
                <td class="px-4 py-3">
                    <span class="px-2 py-1 rounded-full text-xs font-semibold ${agent.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${agent.status}</span>
                </td>
                <td class="px-4 py-3 text-center space-x-2">
                    <button onclick="openCrudModal('view','${agent.emp}')" class="text-blue-500 hover:underline">View</button>
                    <button onclick="openCrudModal('edit','${agent.emp}')" class="text-green-500 hover:underline">Edit</button>
                    <button onclick="openCrudModal('delete','${agent.emp}')" class="text-red-500 hover:underline">Delete</button>
                </td>
            </tr>
        `).join('');
        }
        
        // Search/Filter function (placeholder)
        window.filterHeadcount = function() {
            const searchInput = document.getElementById('searchHeadcount').value.toLowerCase();
            const rows = document.getElementById('headcountTableBody').getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const rowText = rows[i].textContent.toLowerCase();
                rows[i].style.display = rowText.includes(searchInput) ? '' : 'none';
            }
        }

        // Headcount CRUD Modal Functions
        const crudModal = document.getElementById('crudModal');
        const crudModalTitle = document.getElementById('crudModalTitle');
        const crudModalBody = document.getElementById('crudModalBody');
        const crudModalAction = document.getElementById('crudModalAction');

        window.openCrudModal = function (action, id) {
            crudModal.classList.remove('hidden');
            crudModalBody.innerHTML = ''; // Clear previous content

            let agent = sampleAgents.find(a => a.emp === id);

            // Reset action button style
            crudModalAction.classList.remove('bg-red-500', 'hover:bg-red-600', 'text-white');
            crudModalAction.classList.add('bg-brand', 'hover:bg-brandlight', 'text-black');

            switch (action) {
                case 'NEW':
                    crudModalTitle.textContent = "Add New Employee";
                    crudModalBody.innerHTML = generateFormHtml({});
                    crudModalAction.textContent = "Create Employee";
                    crudModalAction.onclick = () => saveCrudModal('POST');
                    break;
                case 'view':
                    crudModalTitle.textContent = `View Employee: ${agent.name}`;
                    crudModalBody.innerHTML = generateViewHtml(agent);
                    crudModalAction.textContent = "Close";
                    crudModalAction.onclick = closeCrudModal; // Closes the modal
                    crudModalAction.classList.add('hidden'); // Hide the main action button for view
                    document.querySelector('#crudModal .flex-end button[onclick="closeCrudModal()"]').classList.remove('hidden');
                    break;
                case 'edit':
                    crudModalTitle.textContent = `Edit Employee: ${agent.name}`;
                    crudModalBody.innerHTML = generateFormHtml(agent);
                    crudModalAction.textContent = "Save Changes";
                    crudModalAction.onclick = () => saveCrudModal('PUT', id);
                    crudModalAction.classList.remove('hidden');
                    break;
                case 'delete':
                    crudModalTitle.textContent = "Confirm Deletion";
                    crudModalBody.innerHTML = `<p>Are you sure you want to delete <strong>${agent.name} (${id})</strong>?</p>`;
                    crudModalAction.textContent = "Delete";
                    crudModalAction.classList.remove('bg-brand');
                    crudModalAction.classList.add('bg-red-500', 'hover:bg-red-600', 'text-white');
                    crudModalAction.onclick = () => deleteCrudModal(id);
                    crudModalAction.classList.remove('hidden');
                    break;
            }
        }

        window.closeCrudModal = function () {
            crudModal.classList.add('hidden');
            // Reset delete button style
            crudModalAction.classList.remove('bg-red-500', 'hover:bg-red-600', 'text-white');
            crudModalAction.classList.add('bg-brand', 'hover:bg-brandlight', 'text-black');
            crudModalAction.classList.remove('hidden'); // Ensure action button is visible on next open
        }
        
        function generateFormHtml(data) { /* ... (generateFormHtml function from original script) ... */
             return `
            <form id="crudForm">
                <label class="block text-sm font-medium text-gray-700">Name:</label><input type="text" name="name" value="${data.name || ''}" class="w-full border p-2 rounded mb-2">
                <label class="block text-sm font-medium text-gray-700">Department:</label><input type="text" name="dept" value="${data.dept || ''}" class="w-full border p-2 rounded mb-2">
                <label class="block text-sm font-medium text-gray-700">Phone:</label><input type="text" name="phone" value="${data.phone || ''}" class="w-full border p-2 rounded mb-2">
                <label class="block text-sm font-medium text-gray-700">DOJ:</label><input type="date" name="doj" value="${data.doj || ''}" class="w-full border p-2 rounded mb-2">
            </form>
            `;
        }

        function generateViewHtml(data) { /* ... (generateViewHtml function from original script) ... */
            return `
            <p><strong>Employee ID:</strong> ${data.emp}</p>
            <p><strong>Name:</strong> ${data.name}</p>
            <p><strong>Department:</strong> ${data.dept}</p>
            <p><strong>Status:</strong> ${data.status}</p>
            <p><strong>Phone:</strong> ${data.phone}</p>
            <p><strong>Emergency:</strong> ${data.emergency}</p>
            <p><strong>Date of Join:</strong> ${data.doj}</p>
            <p><strong>Last Working Day:</strong> ${data.lwd || '-'}</p>
        `;
        }

        async function saveCrudModal(method, id = null) { /* ... (saveCrudModal function from original script) ... */
            showLoading(method === 'POST' ? "Creating employee..." : "Updating employee...");
            const formData = new FormData(document.getElementById('crudForm'));
            const data = Object.fromEntries(formData.entries());
            data.emp = id || 'DMI-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'); // Simple ID generation

            try {
                // Placeholder API call
                const response = await fetch(API_URL_CRUD, {
                    method: 'POST', // Use POST for both PUT/POST with a method override for simplicity
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ _method: id ? 'PUT' : 'POST', id, ...data })
                });

                if (response.ok) {
                    alert(`Employee ${id ? 'updated' : 'created'} successfully!`);
                    // Simulate array update (for a real app, this should update the actual data source)
                    const index = sampleAgents.findIndex(a => a.emp === id);
                    if (index > -1) {
                         Object.assign(sampleAgents[index], data); // Update existing
                    } else {
                        sampleAgents.push(data); // Add new
                    }
                    renderHeadcountTable();
                    closeCrudModal();
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                alert(`Error processing request: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        async function deleteCrudModal(id) { /* ... (deleteCrudModal function from original script) ... */
            showLoading("Deleting employee...");
            try {
                // Placeholder API call
                const response = await fetch(API_URL_CRUD, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ _method: 'DELETE', id })
                });

                if (response.ok) {
                    alert(`Employee ${id} deleted successfully!`);
                    // Simulate array update
                    const index = sampleAgents.findIndex(a => a.emp === id);
                    if (index > -1) {
                        sampleAgents.splice(index, 1);
                    }
                    renderHeadcountTable();
                    closeCrudModal();
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                alert(`Error processing deletion: ${error.message}`);
            } finally {
                hideLoading();
            }
        }


        /* -------------------------------------------
         * 5. COACHING LOGS LOGIC (REFORMATTED)
         * ------------------------------------------- */

        const COACHING_API_URL = API_ENDPOINTS.COACHING_LOGS;
        const form = document.getElementById("coachingForm");

        if (form) {
            window.openModal = function (editing = false) {
                document.getElementById('modalBg').classList.remove('hidden');
                document.getElementById("modalTitle").innerText = editing ? "Edit Coaching Session" : "Add Coaching Session";
                // Reset form fields and view state
                form.reset();
                delete form.dataset.editId;
                [...form.elements].forEach(el => el.disabled = false);
                document.getElementById('coachingSubmitButton').classList.remove('hidden');
            }

            window.closeModal = function () {
                document.getElementById('modalBg').classList.add('hidden');
                form.reset();
                delete form.dataset.editId;
                [...form.elements].forEach(el => el.disabled = false);
                document.getElementById('coachingSubmitButton').classList.remove('hidden');
            }

            window.filterCoachingSessions = function () {
                // Placeholder for filtering logic
                console.log("Filtering coaching sessions...");
            }

            // Load sessions
            window.loadSessions = async function () {
                showLocalLoading("Fetching coaching sessions...");
                try {
                    const res = await fetch(COACHING_API_URL);
                    
                    // Bug Fix: Explicitly check for response ok status
                    if (!res.ok) {
                        const errorText = await res.text();
                        throw new Error(`Server status ${res.status}: ${errorText.substring(0, 100)}...`);
                    }

                    const sessions = await res.json();
                    const table = document.getElementById("sessionsTable");
                    
                    if (table) {
                        table.innerHTML = "";
                        if (sessions.length === 0) {
                             showLocalError("No coaching sessions found.");
                             return;
                        }
                        
                        hideLocalLoading();

                        sessions.forEach(session => {
                            // Escape single quotes for inline JS function call
                            const sessionData = JSON.stringify(session).replace(/'/g, '&#39;'); 
                            
                            // Use short previews for long text fields
                            const performancePreview = session.performance ? (session.performance.length > 50 ? session.performance.substring(0, 50) + '...' : session.performance) : '-';
                            const coachingPreview = session.coachingprovided ? (session.coachingprovided.length > 50 ? session.coachingprovided.substring(0, 50) + '...' : session.coachingprovided) : '-';
                            const actionPreview = session.actionplan ? (session.actionplan.length > 50 ? session.actionplan.substring(0, 50) + '...' : session.actionplan) : '-';

                            table.innerHTML += `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-4 py-2">${session.date || '-'}</td>
                                    <td class="px-4 py-2">${session.coach || '-'}</td>
                                    <td class="px-4 py-2">${session.employee || '-'}</td>
                                    <td class="px-4 py-2">${session.employeenumber || '-'}</td>
                                    <td class="px-4 py-2">${performancePreview}</td>
                                    <td class="px-4 py-2 hidden md:table-cell">${coachingPreview}</td>
                                    <td class="px-4 py-2 hidden md:table-cell">${actionPreview}</td>
                                    <td class="px-4 py-2 hidden md:table-cell">${session.agentacknowledged || 'Pending'}</td>
                                    <td class="px-4 py-2 text-center space-x-2">
                                        <button class="text-blue-600 hover:underline" onclick='viewSession(${sessionData})'>View</button>
                                        <button class="text-green-600 hover:underline" onclick='editSession(${sessionData})'>Edit</button>
                                        <button class="text-red-600 hover:underline" onclick='deleteSession(${session.id || session.ID})'>Delete</button>
                                    </td>
                                </tr>
                            `;
                        });
                    }
                } catch (error) {
                    console.error("Error loading coaching sessions:", error);
                    showLocalError(`Failed to load sessions. Error: ${error.message}`);
                }
            }

            // Make functions global so they work with inline onclick events
            window.viewSession = function (session) {
                openModal(false);
                document.getElementById("modalTitle").innerText = `View Coaching Session (${session.employeenumber})`;

                // Populate form fields, disable them, and hide the submit button
                const fieldMap = {
                    'employee': session.employee,
                    'employeenumber': session.employeenumber, // Added Employee Number
                    'agentacknowledged': session.agentacknowledged,
                    'coachingprovided': session.coachingprovided,
                    'actionplan': session.actionplan,
                    'performance': session.performance,
                    'date': session.date,
                    'coach': session.coach
                };
                
                Object.keys(fieldMap).forEach(key => {
                    const el = form.elements.namedItem(key);
                    if (el) {
                        el.value = fieldMap[key] || '';
                        el.disabled = true;
                    }
                });

                document.getElementById('coachingSubmitButton').classList.add('hidden');
            }

            window.editSession = function (session) {
                openModal(true);
                document.getElementById("modalTitle").innerText = `Edit Coaching Session (${session.employeenumber})`;

                // Populate form fields
                 const fieldMap = {
                    'employee': session.employee,
                    'employeenumber': session.employeenumber, // Added Employee Number
                    'agentacknowledged': session.agentacknowledged,
                    'coachingprovided': session.coachingprovided,
                    'actionplan': session.actionplan,
                    'performance': session.performance,
                    'date': session.date,
                    'coach': session.coach
                };
                
                Object.keys(fieldMap).forEach(key => {
                    const el = form.elements.namedItem(key);
                    if (el) {
                        el.value = fieldMap[key] || '';
                    }
                });
                
                form.dataset.editId = session.ID || session.id;
            }

            window.deleteSession = async function (id) {
                if (!confirm("Are you sure you want to permanently delete this coaching session?")) return;
                showLocalLoading("Deleting session...");
                try {
                    const response = await fetch(COACHING_API_URL, {
                        method: "POST",
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ _method: "DELETE", id: id })
                    });
                    
                    // Bug Fix: Explicitly check for response ok status
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Server status ${response.status}: ${errorText.substring(0, 100)}...`);
                    }

                    alert("Session deleted successfully.");
                } catch (error) {
                    alert("Error deleting session: " + error.message);
                    showLocalError(`Failed to delete session: ${error.message}`);
                }
                await loadSessions();
            }

            form.addEventListener("submit", async function (e) {
                e.preventDefault();
                const isEdit = this.dataset.editId;
                showLocalLoading(isEdit ? "Updating session..." : "Saving new session...");
                const formData = Object.fromEntries(new FormData(this).entries());

                try {
                    const payload = isEdit ? { _method: "PUT", id: isEdit, ...formData } : formData;
                    
                    const response = await fetch(COACHING_API_URL, {
                        method: "POST", 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    // Bug Fix: Explicitly check for response ok status
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Server status ${response.status}: ${errorText.substring(0, 100)}...`);
                    }

                    alert(`Session ${isEdit ? 'updated' : 'saved'} successfully.`);
                } catch (error) {
                    alert(`Error processing session: ${error.message}`);
                    showLocalError(`Failed to save session: ${error.message}`);
                } finally {
                    closeModal();
                    loadSessions();
                }
            });
        }


        /* -------------------------------------------
         * 6. OTHER MODAL FUNCTIONS
         * ------------------------------------------- */

        // Download Modal Functions
        const downloadModal = document.getElementById('downloadModal');
        window.openDownloadModal = function() {
            downloadModal.classList.remove('hidden');
        }
        window.closeDownloadModal = function() {
            downloadModal.classList.add('hidden');
        }
        window.downloadReport = function() {
            alert("Download initiated! (Placeholder)");
            closeDownloadModal();
        }

        // Report Request Modal Functions
        const requestReportModal = document.getElementById('requestReportModal');
        window.openRequestReportModal = function() {
            requestReportModal.classList.remove('hidden');
        }
        window.closeRequestReportModal = function() {
            requestReportModal.classList.add('hidden');
        }
        window.submitReportRequest = function() {
            const name = document.getElementById('reportName').value;
            const desc = document.getElementById('reportDescription').value;
            alert(`Report Requested:\nName: ${name}\nDescription: ${desc}`);
            closeRequestReportModal();
        }


        /* -------------------------------------------
         * 7. FINAL INITIALIZATION (ONLOAD)
         * ------------------------------------------- */

        window.onload = async () => {
            // 1. Load attendance-related data (Clusters and initial dashboard data)
            const now = new Date();
            if (document.getElementById("monthSelector")) {
                document.getElementById("monthSelector").value = now.getMonth() + 1;
            }
            // loadAttendanceData(); // Commented out as required HTML elements are missing

            // 2. Load coaching logs data only if the initial page is 'coaching' or a subsequent navigation occurs.
            // Initial call is handled by initializePageNavigation if 'coaching' is the default page or on click.
        };

    </script>
</body>

</html>